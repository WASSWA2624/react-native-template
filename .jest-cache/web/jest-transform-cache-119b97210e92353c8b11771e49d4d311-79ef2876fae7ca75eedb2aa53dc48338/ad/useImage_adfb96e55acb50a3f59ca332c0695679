a589e3a69e4c3357330ffd03c939fa4c
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _react = require("react");
var useImage = function useImage(_ref) {
  var source = _ref.source,
    fallback = _ref.fallback,
    onLoad = _ref.onLoad,
    onError = _ref.onError;
  var _useState = (0, _react.useState)(true),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    isLoading = _useState2[0],
    setIsLoading = _useState2[1];
  var _useState3 = (0, _react.useState)(false),
    _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
    hasError = _useState4[0],
    setHasError = _useState4[1];
  var _useState5 = (0, _react.useState)(source),
    _useState6 = (0, _slicedToArray2.default)(_useState5, 2),
    currentSource = _useState6[0],
    setCurrentSource = _useState6[1];
  var currentSourceRef = (0, _react.useRef)(source);
  var fallbackRef = (0, _react.useRef)(fallback);
  var onErrorRef = (0, _react.useRef)(onError);
  (0, _react.useEffect)(function () {
    fallbackRef.current = fallback;
    onErrorRef.current = onError;
  }, [fallback, onError]);
  (0, _react.useEffect)(function () {
    if (source !== currentSourceRef.current) {
      currentSourceRef.current = source;
      setCurrentSource(source);
      setIsLoading(true);
      setHasError(false);
    }
  }, [source]);
  var handleLoad = (0, _react.useCallback)(function (event) {
    setIsLoading(false);
    setHasError(false);
    if (onLoad) {
      onLoad(event);
    }
  }, [onLoad]);
  var handleError = (0, _react.useCallback)(function (event) {
    setIsLoading(false);
    var prevSource = currentSourceRef.current;
    var prevSourceStr = typeof prevSource === 'string' ? prevSource : prevSource == null ? void 0 : prevSource.uri;
    var fallback = fallbackRef.current;
    var fallbackStr = typeof fallback === 'string' ? fallback : fallback == null ? void 0 : fallback.uri;
    if (fallback && prevSourceStr !== fallbackStr) {
      currentSourceRef.current = fallback;
      setCurrentSource(fallback);
      setHasError(false);
      setIsLoading(true);
      if (onErrorRef.current) {
        onErrorRef.current(event);
      }
    } else {
      setHasError(true);
      if (onErrorRef.current) {
        onErrorRef.current(event);
      }
    }
  }, []);
  return {
    isLoading: isLoading,
    hasError: hasError,
    currentSource: currentSource,
    handleLoad: handleLoad,
    handleError: handleError
  };
};
var _default = exports.default = useImage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwidXNlSW1hZ2UiLCJfcmVmIiwic291cmNlIiwiZmFsbGJhY2siLCJvbkxvYWQiLCJvbkVycm9yIiwiX3VzZVN0YXRlIiwidXNlU3RhdGUiLCJfdXNlU3RhdGUyIiwiX3NsaWNlZFRvQXJyYXkyIiwiZGVmYXVsdCIsImlzTG9hZGluZyIsInNldElzTG9hZGluZyIsIl91c2VTdGF0ZTMiLCJfdXNlU3RhdGU0IiwiaGFzRXJyb3IiLCJzZXRIYXNFcnJvciIsIl91c2VTdGF0ZTUiLCJfdXNlU3RhdGU2IiwiY3VycmVudFNvdXJjZSIsInNldEN1cnJlbnRTb3VyY2UiLCJjdXJyZW50U291cmNlUmVmIiwidXNlUmVmIiwiZmFsbGJhY2tSZWYiLCJvbkVycm9yUmVmIiwidXNlRWZmZWN0IiwiY3VycmVudCIsImhhbmRsZUxvYWQiLCJ1c2VDYWxsYmFjayIsImV2ZW50IiwiaGFuZGxlRXJyb3IiLCJwcmV2U291cmNlIiwicHJldlNvdXJjZVN0ciIsInVyaSIsImZhbGxiYWNrU3RyIiwiX2RlZmF1bHQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsidXNlSW1hZ2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEltYWdlIEhvb2tcclxuICogU2hhcmVkIGxvZ2ljIGZvciBJbWFnZSBjb21wb25lbnQgKGxvYWRpbmcsIGVycm9yIGhhbmRsaW5nKVxyXG4gKiBGaWxlOiB1c2VJbWFnZS5qc1xyXG4gKi9cclxuaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZVJlZiB9IGZyb20gJ3JlYWN0JztcclxuXHJcbi8qKlxyXG4gKiBDdXN0b20gaG9vayBmb3IgSW1hZ2UgY29tcG9uZW50IGxvZ2ljXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBwcm9wcyAtIEltYWdlIHByb3BzXHJcbiAqIEBwYXJhbSB7c3RyaW5nfE9iamVjdH0gcHJvcHMuc291cmNlIC0gSW1hZ2Ugc291cmNlIFVSSSAoc3RyaW5nIG9yIHt1cmk6IHN0cmluZ30pXHJcbiAqIEBwYXJhbSB7c3RyaW5nfE9iamVjdH0gcHJvcHMuZmFsbGJhY2sgLSBGYWxsYmFjayBpbWFnZSBzb3VyY2VcclxuICogQHBhcmFtIHtGdW5jdGlvbn0gcHJvcHMub25Mb2FkIC0gTG9hZCBoYW5kbGVyXHJcbiAqIEBwYXJhbSB7RnVuY3Rpb259IHByb3BzLm9uRXJyb3IgLSBFcnJvciBoYW5kbGVyXHJcbiAqIEByZXR1cm5zIHtPYmplY3R9IEltYWdlIHN0YXRlIGFuZCBoYW5kbGVyc1xyXG4gKi9cclxuY29uc3QgdXNlSW1hZ2UgPSAoeyBzb3VyY2UsIGZhbGxiYWNrLCBvbkxvYWQsIG9uRXJyb3IgfSkgPT4ge1xyXG4gIGNvbnN0IFtpc0xvYWRpbmcsIHNldElzTG9hZGluZ10gPSB1c2VTdGF0ZSh0cnVlKTtcclxuICBjb25zdCBbaGFzRXJyb3IsIHNldEhhc0Vycm9yXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICBjb25zdCBbY3VycmVudFNvdXJjZSwgc2V0Q3VycmVudFNvdXJjZV0gPSB1c2VTdGF0ZShzb3VyY2UpO1xyXG4gIGNvbnN0IGN1cnJlbnRTb3VyY2VSZWYgPSB1c2VSZWYoc291cmNlKTtcclxuICBjb25zdCBmYWxsYmFja1JlZiA9IHVzZVJlZihmYWxsYmFjayk7XHJcbiAgY29uc3Qgb25FcnJvclJlZiA9IHVzZVJlZihvbkVycm9yKTtcclxuXHJcbiAgLy8gVXBkYXRlIHJlZnMgd2hlbiBwcm9wcyBjaGFuZ2VcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgZmFsbGJhY2tSZWYuY3VycmVudCA9IGZhbGxiYWNrO1xyXG4gICAgb25FcnJvclJlZi5jdXJyZW50ID0gb25FcnJvcjtcclxuICB9LCBbZmFsbGJhY2ssIG9uRXJyb3JdKTtcclxuXHJcbiAgLy8gVXBkYXRlIGN1cnJlbnRTb3VyY2Ugd2hlbiBzb3VyY2UgcHJvcCBjaGFuZ2VzXHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIGlmIChzb3VyY2UgIT09IGN1cnJlbnRTb3VyY2VSZWYuY3VycmVudCkge1xyXG4gICAgICBjdXJyZW50U291cmNlUmVmLmN1cnJlbnQgPSBzb3VyY2U7XHJcbiAgICAgIHNldEN1cnJlbnRTb3VyY2Uoc291cmNlKTtcclxuICAgICAgc2V0SXNMb2FkaW5nKHRydWUpO1xyXG4gICAgICBzZXRIYXNFcnJvcihmYWxzZSk7XHJcbiAgICB9XHJcbiAgfSwgW3NvdXJjZV0pO1xyXG5cclxuICBjb25zdCBoYW5kbGVMb2FkID0gdXNlQ2FsbGJhY2soXHJcbiAgICAoZXZlbnQpID0+IHtcclxuICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKTtcclxuICAgICAgc2V0SGFzRXJyb3IoZmFsc2UpO1xyXG4gICAgICBpZiAob25Mb2FkKSB7XHJcbiAgICAgICAgb25Mb2FkKGV2ZW50KTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIFtvbkxvYWRdXHJcbiAgKTtcclxuXHJcbiAgY29uc3QgaGFuZGxlRXJyb3IgPSB1c2VDYWxsYmFjayhcclxuICAgIChldmVudCkgPT4ge1xyXG4gICAgICBzZXRJc0xvYWRpbmcoZmFsc2UpO1xyXG4gICAgICAvLyBOb3JtYWxpemUgc291cmNlcyBmb3IgY29tcGFyaXNvbiAoaGFuZGxlIGJvdGggc3RyaW5nIGFuZCBvYmplY3QgZm9ybWF0cylcclxuICAgICAgY29uc3QgcHJldlNvdXJjZSA9IGN1cnJlbnRTb3VyY2VSZWYuY3VycmVudDtcclxuICAgICAgY29uc3QgcHJldlNvdXJjZVN0ciA9IHR5cGVvZiBwcmV2U291cmNlID09PSAnc3RyaW5nJyA/IHByZXZTb3VyY2UgOiBwcmV2U291cmNlPy51cmk7XHJcbiAgICAgIGNvbnN0IGZhbGxiYWNrID0gZmFsbGJhY2tSZWYuY3VycmVudDtcclxuICAgICAgY29uc3QgZmFsbGJhY2tTdHIgPSB0eXBlb2YgZmFsbGJhY2sgPT09ICdzdHJpbmcnID8gZmFsbGJhY2sgOiBmYWxsYmFjaz8udXJpO1xyXG4gICAgICBcclxuICAgICAgaWYgKGZhbGxiYWNrICYmIHByZXZTb3VyY2VTdHIgIT09IGZhbGxiYWNrU3RyKSB7XHJcbiAgICAgICAgLy8gU3dpdGNoIHRvIGZhbGxiYWNrIHN5bmNocm9ub3VzbHlcclxuICAgICAgICBjdXJyZW50U291cmNlUmVmLmN1cnJlbnQgPSBmYWxsYmFjaztcclxuICAgICAgICBzZXRDdXJyZW50U291cmNlKGZhbGxiYWNrKTtcclxuICAgICAgICBzZXRIYXNFcnJvcihmYWxzZSk7XHJcbiAgICAgICAgc2V0SXNMb2FkaW5nKHRydWUpO1xyXG4gICAgICAgIGlmIChvbkVycm9yUmVmLmN1cnJlbnQpIHtcclxuICAgICAgICAgIG9uRXJyb3JSZWYuY3VycmVudChldmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHNldEhhc0Vycm9yKHRydWUpO1xyXG4gICAgICAgIGlmIChvbkVycm9yUmVmLmN1cnJlbnQpIHtcclxuICAgICAgICAgIG9uRXJyb3JSZWYuY3VycmVudChldmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgW11cclxuICApO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgaXNMb2FkaW5nLFxyXG4gICAgaGFzRXJyb3IsXHJcbiAgICBjdXJyZW50U291cmNlLFxyXG4gICAgaGFuZGxlTG9hZCxcclxuICAgIGhhbmRsZUVycm9yLFxyXG4gIH07XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCB1c2VJbWFnZTtcclxuXHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBS0EsSUFBQUEsTUFBQSxHQUFBQyxPQUFBO0FBV0EsSUFBTUMsUUFBUSxHQUFHLFNBQVhBLFFBQVFBLENBQUFDLElBQUEsRUFBOEM7RUFBQSxJQUF4Q0MsTUFBTSxHQUFBRCxJQUFBLENBQU5DLE1BQU07SUFBRUMsUUFBUSxHQUFBRixJQUFBLENBQVJFLFFBQVE7SUFBRUMsTUFBTSxHQUFBSCxJQUFBLENBQU5HLE1BQU07SUFBRUMsT0FBTyxHQUFBSixJQUFBLENBQVBJLE9BQU87RUFDbkQsSUFBQUMsU0FB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