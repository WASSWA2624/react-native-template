{"version":3,"names":["_storage","require","TOKEN_KEYS","ACCESS_TOKEN","REFRESH_TOKEN","getAccessToken","exports","_ref","_asyncToGenerator2","default","secure","getItem","apply","arguments","getRefreshToken","_ref2","setTokens","_ref3","accessToken","refreshToken","results","Promise","all","setItem","every","Boolean","_x","_x2","clearTokens","_ref4","removeItem","decodeBase64","value","base64","replace","padding","length","repeat","normalized","globalThis","atob","_unused","Buffer","from","toString","getJwtPayload","token","parts","split","decoded","JSON","parse","_unused2","isTokenExpired","payload","expSeconds","exp","Number","isFinite","expMs","Date","now"],"sources":["token.manager.js"],"sourcesContent":["/**\r\n * Token Manager\r\n * Handles JWT token lifecycle\r\n * File: token.manager.js\r\n */\r\nimport { secure } from '@services/storage';\r\n\r\nconst TOKEN_KEYS = {\r\n  ACCESS_TOKEN: 'access_token',\r\n  REFRESH_TOKEN: 'refresh_token',\r\n};\r\n\r\nconst getAccessToken = async () => {\r\n  return await secure.getItem(TOKEN_KEYS.ACCESS_TOKEN);\r\n};\r\n\r\nconst getRefreshToken = async () => {\r\n  return await secure.getItem(TOKEN_KEYS.REFRESH_TOKEN);\r\n};\r\n\r\nconst setTokens = async (accessToken, refreshToken) => {\r\n  const results = await Promise.all([\r\n    secure.setItem(TOKEN_KEYS.ACCESS_TOKEN, accessToken),\r\n    secure.setItem(TOKEN_KEYS.REFRESH_TOKEN, refreshToken),\r\n  ]);\r\n  return results.every(Boolean);\r\n};\r\n\r\nconst clearTokens = async () => {\r\n  await Promise.all([\r\n    secure.removeItem(TOKEN_KEYS.ACCESS_TOKEN),\r\n    secure.removeItem(TOKEN_KEYS.REFRESH_TOKEN),\r\n  ]);\r\n};\r\n\r\nconst decodeBase64 = (value) => {\r\n  if (typeof value !== 'string') return null;\r\n\r\n  // base64url -> base64\r\n  const base64 = value.replace(/-/g, '+').replace(/_/g, '/');\r\n  const padding = base64.length % 4 === 0 ? '' : '='.repeat(4 - (base64.length % 4));\r\n  const normalized = `${base64}${padding}`;\r\n\r\n  if (typeof globalThis?.atob === 'function') {\r\n    try {\r\n      return globalThis.atob(normalized);\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Jest/Node fallback\r\n  // eslint-disable-next-line no-undef\r\n  if (typeof Buffer !== 'undefined') {\r\n    // eslint-disable-next-line no-undef\r\n    return Buffer.from(normalized, 'base64').toString('utf8');\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst getJwtPayload = (token) => {\r\n  if (typeof token !== 'string') return null;\r\n  const parts = token.split('.');\r\n  if (parts.length < 2) return null;\r\n\r\n  const decoded = decodeBase64(parts[1]);\r\n  if (!decoded) return null;\r\n\r\n  try {\r\n    return JSON.parse(decoded);\r\n  } catch {\r\n    return null;\r\n  }\r\n};\r\n\r\nconst isTokenExpired = (token) => {\r\n  if (!token) return true;\r\n\r\n  const payload = getJwtPayload(token);\r\n  const expSeconds = payload?.exp;\r\n  if (typeof expSeconds !== 'number' || !Number.isFinite(expSeconds)) return true;\r\n\r\n  const expMs = expSeconds * 1000;\r\n  return Date.now() >= expMs;\r\n};\r\n\r\nexport { getAccessToken, getRefreshToken, setTokens, clearTokens, isTokenExpired };\r\n\r\n"],"mappings":";;;;;;AAKA,IAAAA,QAAA,GAAAC,OAAA;AAEA,IAAMC,UAAU,GAAG;EACjBC,YAAY,EAAE,cAAc;EAC5BC,aAAa,EAAE;AACjB,CAAC;AAED,IAAMC,cAAc,GAAAC,OAAA,CAAAD,cAAA;EAAA,IAAAE,IAAA,OAAAC,kBAAA,CAAAC,OAAA,EAAG,aAAY;IACjC,aAAaC,eAAM,CAACC,OAAO,CAACT,UAAU,CAACC,YAAY,CAAC;EACtD,CAAC;EAAA,gBAFKE,cAAcA,CAAA;IAAA,OAAAE,IAAA,CAAAK,KAAA,OAAAC,SAAA;EAAA;AAAA,GAEnB;AAED,IAAMC,eAAe,GAAAR,OAAA,CAAAQ,eAAA;EAAA,IAAAC,KAAA,OAAAP,kBAAA,CAAAC,OAAA,EAAG,aAAY;IAClC,aAAaC,eAAM,CAACC,OAAO,CAACT,UAAU,CAACE,aAAa,CAAC;EACvD,CAAC;EAAA,gBAFKU,eAAeA,CAAA;IAAA,OAAAC,KAAA,CAAAH,KAAA,OAAAC,SAAA;EAAA;AAAA,GAEpB;AAED,IAAMG,SAAS,GAAAV,OAAA,CAAAU,SAAA;EAAA,IAAAC,KAAA,OAAAT,kBAAA,CAAAC,OAAA,EAAG,WAAOS,WAAW,EAAEC,YAAY,EAAK;IACrD,IAAMC,OAAO,SAASC,OAAO,CAACC,GAAG,CAAC,CAChCZ,eAAM,CAACa,OAAO,CAACrB,UAAU,CAACC,YAAY,EAAEe,WAAW,CAAC,EACpDR,eAAM,CAACa,OAAO,CAACrB,UAAU,CAACE,aAAa,EAAEe,YAAY,CAAC,CACvD,CAAC;IACF,OAAOC,OAAO,CAACI,KAAK,CAACC,OAAO,CAAC;EAC/B,CAAC;EAAA,gBANKT,SAASA,CAAAU,EAAA,EAAAC,GAAA;IAAA,OAAAV,KAAA,CAAAL,KAAA,OAAAC,SAAA;EAAA;AAAA,GAMd;AAED,IAAMe,WAAW,GAAAtB,OAAA,CAAAsB,WAAA;EAAA,IAAAC,KAAA,OAAArB,kBAAA,CAAAC,OAAA,EAAG,aAAY;IAC9B,MAAMY,OAAO,CAACC,GAAG,CAAC,CAChBZ,eAAM,CAACoB,UAAU,CAAC5B,UAAU,CAACC,YAAY,CAAC,EAC1CO,eAAM,CAACoB,UAAU,CAAC5B,UAAU,CAACE,aAAa,CAAC,CAC5C,CAAC;EACJ,CAAC;EAAA,gBALKwB,WAAWA,CAAA;IAAA,OAAAC,KAAA,CAAAjB,KAAA,OAAAC,SAAA;EAAA;AAAA,GAKhB;AAED,IAAMkB,YAAY,GAAG,SAAfA,YAAYA,CAAIC,KAAK,EAAK;EAC9B,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE,OAAO,IAAI;EAG1C,IAAMC,MAAM,GAAGD,KAAK,CAACE,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAACA,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC;EAC1D,IAAMC,OAAO,GAAGF,MAAM,CAACG,MAAM,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,GAAG,CAACC,MAAM,CAAC,CAAC,GAAIJ,MAAM,CAACG,MAAM,GAAG,CAAE,CAAC;EAClF,IAAME,UAAU,GAAG,GAAGL,MAAM,GAAGE,OAAO,EAAE;EAExC,IAAI,QAAOI,UAAU,oBAAVA,UAAU,CAAEC,IAAI,MAAK,UAAU,EAAE;IAC1C,IAAI;MACF,OAAOD,UAAU,CAACC,IAAI,CAACF,UAAU,CAAC;IACpC,CAAC,CAAC,OAAAG,OAAA,EAAM;MACN,OAAO,IAAI;IACb;EACF;EAIA,IAAI,OAAOC,MAAM,KAAK,WAAW,EAAE;IAEjC,OAAOA,MAAM,CAACC,IAAI,CAACL,UAAU,EAAE,QAAQ,CAAC,CAACM,QAAQ,CAAC,MAAM,CAAC;EAC3D;EAEA,OAAO,IAAI;AACb,CAAC;AAED,IAAMC,aAAa,GAAG,SAAhBA,aAAaA,CAAIC,KAAK,EAAK;EAC/B,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE,OAAO,IAAI;EAC1C,IAAMC,KAAK,GAAGD,KAAK,CAACE,KAAK,CAAC,GAAG,CAAC;EAC9B,IAAID,KAAK,CAACX,MAAM,GAAG,CAAC,EAAE,OAAO,IAAI;EAEjC,IAAMa,OAAO,GAAGlB,YAAY,CAACgB,KAAK,CAAC,CAAC,CAAC,CAAC;EACtC,IAAI,CAACE,OAAO,EAAE,OAAO,IAAI;EAEzB,IAAI;IACF,OAAOC,IAAI,CAACC,KAAK,CAACF,OAAO,CAAC;EAC5B,CAAC,CAAC,OAAAG,QAAA,EAAM;IACN,OAAO,IAAI;EACb;AACF,CAAC;AAED,IAAMC,cAAc,GAAA/C,OAAA,CAAA+C,cAAA,GAAG,SAAjBA,cAAcA,CAAIP,KAAK,EAAK;EAChC,IAAI,CAACA,KAAK,EAAE,OAAO,IAAI;EAEvB,IAAMQ,OAAO,GAAGT,aAAa,CAACC,KAAK,CAAC;EACpC,IAAMS,UAAU,GAAGD,OAAO,oBAAPA,OAAO,CAAEE,GAAG;EAC/B,IAAI,OAAOD,UAAU,KAAK,QAAQ,IAAI,CAACE,MAAM,CAACC,QAAQ,CAACH,UAAU,CAAC,EAAE,OAAO,IAAI;EAE/E,IAAMI,KAAK,GAAGJ,UAAU,GAAG,IAAI;EAC/B,OAAOK,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIF,KAAK;AAC5B,CAAC","ignoreList":[]}