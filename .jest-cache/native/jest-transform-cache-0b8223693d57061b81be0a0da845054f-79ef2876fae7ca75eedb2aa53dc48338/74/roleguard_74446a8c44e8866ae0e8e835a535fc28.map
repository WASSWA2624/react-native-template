{"version":3,"names":["useEffect","useRef","useMemo","useSelector","useRouter","selectUser","ROLE_GUARD_ERRORS","cov_2k9t5ug8vj","s","NO_USER","NO_ROLE","INSUFFICIENT_ROLE","useRoleGuard","options","f","_ref","b","requiredRoles","_ref$redirectPath","redirectPath","router","user","requiredRolesArray","Array","isArray","hasAccess","length","userRole","role","userRoles","roles","normalizedUserRoles","some","requiredRole","includes","errorCode","hasRedirected","current","replace"],"sources":["role.guard.js"],"sourcesContent":["/**\r\n * Role Guard Hook\r\n * \r\n * Checks user roles and redirects if access denied.\r\n * \r\n * @param {Object} options - Configuration options\r\n * @param {string|string[]} options.requiredRoles - Required role(s) for access\r\n * @param {string} [options.redirectPath='/home'] - Path to redirect to if access denied\r\n * @returns {Object} Access state object with { hasAccess, errorCode }\r\n * \r\n * @example\r\n * const { hasAccess, errorCode } = useRoleGuard({ requiredRoles: 'ADMIN' });\r\n * const { hasAccess, errorCode } = useRoleGuard({ requiredRoles: ['ADMIN', 'MODERATOR'], redirectPath: '/unauthorized' });\r\n */\r\n\r\nimport { useEffect, useRef, useMemo } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { useRouter } from 'expo-router';\r\nimport { selectUser } from '@store/selectors';\r\n\r\n// Error codes\r\nexport const ROLE_GUARD_ERRORS = {\r\n  NO_USER: 'NO_USER',\r\n  NO_ROLE: 'NO_ROLE',\r\n  INSUFFICIENT_ROLE: 'INSUFFICIENT_ROLE',\r\n};\r\n\r\nexport function useRoleGuard(options) {\r\n  const { requiredRoles, redirectPath = '/home' } = options || {};\r\n  \r\n  const router = useRouter();\r\n  const user = useSelector(selectUser);\r\n  \r\n  // Normalize requiredRoles to array\r\n  const requiredRolesArray = useMemo(() => {\r\n    if (!requiredRoles) {\r\n      return [];\r\n    }\r\n    return Array.isArray(requiredRoles) ? requiredRoles : [requiredRoles];\r\n  }, [requiredRoles]);\r\n  \r\n  // Check if user has required role(s)\r\n  const hasAccess = useMemo(() => {\r\n    // No user means no access\r\n    if (!user) {\r\n      return false;\r\n    }\r\n    \r\n    // No required roles means access granted\r\n    if (requiredRolesArray.length === 0) {\r\n      return true;\r\n    }\r\n    \r\n    // Get user role (user.role or user.roles array)\r\n    const userRole = user.role;\r\n    const userRoles = user.roles || (userRole ? [userRole] : []);\r\n    \r\n    // Check if user has at least one of the required roles\r\n    const normalizedUserRoles = Array.isArray(userRoles) ? userRoles : [userRoles];\r\n    return requiredRolesArray.some((requiredRole) =>\r\n      normalizedUserRoles.includes(requiredRole)\r\n    );\r\n  }, [user, requiredRolesArray]);\r\n  \r\n  // Determine error code\r\n  const errorCode = useMemo(() => {\r\n    if (!user) {\r\n      return ROLE_GUARD_ERRORS.NO_USER;\r\n    }\r\n    if (!hasAccess && requiredRolesArray.length > 0) {\r\n      return ROLE_GUARD_ERRORS.INSUFFICIENT_ROLE;\r\n    }\r\n    return null;\r\n  }, [user, hasAccess, requiredRolesArray]);\r\n  \r\n  // Use ref to track if redirect has been performed to prevent multiple redirects\r\n  const hasRedirected = useRef(false);\r\n  \r\n  useEffect(() => {\r\n    if (hasAccess) {\r\n      // Reset redirect flag when access granted\r\n      hasRedirected.current = false;\r\n    } else if (!hasRedirected.current && requiredRolesArray.length > 0) {\r\n      // Only redirect if access denied and haven't redirected yet\r\n      hasRedirected.current = true;\r\n      router.replace(redirectPath);\r\n    }\r\n  }, [hasAccess, redirectPath, router, requiredRolesArray.length]);\r\n  \r\n  return {\r\n    hasAccess,\r\n    errorCode,\r\n  };\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]}