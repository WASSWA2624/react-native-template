{"version":3,"names":["secure","TOKEN_KEYS","cov_18757ek0nb","s","ACCESS_TOKEN","REFRESH_TOKEN","getAccessToken","_ref","_asyncToGenerator","f","getItem","apply","arguments","getRefreshToken","_ref2","setTokens","_ref3","accessToken","refreshToken","results","Promise","all","setItem","every","Boolean","_x","_x2","clearTokens","_ref4","removeItem","decodeBase64","value","b","base64","replace","padding","length","repeat","normalized","globalThis","atob","_unused","Buffer","from","toString","getJwtPayload","token","parts","split","decoded","JSON","parse","_unused2","isTokenExpired","payload","expSeconds","exp","Number","isFinite","expMs","Date","now"],"sources":["token.manager.js"],"sourcesContent":["/**\r\n * Token Manager\r\n * Handles JWT token lifecycle\r\n * File: token.manager.js\r\n */\r\nimport { secure } from '@services/storage';\r\n\r\nconst TOKEN_KEYS = {\r\n  ACCESS_TOKEN: 'access_token',\r\n  REFRESH_TOKEN: 'refresh_token',\r\n};\r\n\r\nconst getAccessToken = async () => {\r\n  return await secure.getItem(TOKEN_KEYS.ACCESS_TOKEN);\r\n};\r\n\r\nconst getRefreshToken = async () => {\r\n  return await secure.getItem(TOKEN_KEYS.REFRESH_TOKEN);\r\n};\r\n\r\nconst setTokens = async (accessToken, refreshToken) => {\r\n  const results = await Promise.all([\r\n    secure.setItem(TOKEN_KEYS.ACCESS_TOKEN, accessToken),\r\n    secure.setItem(TOKEN_KEYS.REFRESH_TOKEN, refreshToken),\r\n  ]);\r\n  return results.every(Boolean);\r\n};\r\n\r\nconst clearTokens = async () => {\r\n  await Promise.all([\r\n    secure.removeItem(TOKEN_KEYS.ACCESS_TOKEN),\r\n    secure.removeItem(TOKEN_KEYS.REFRESH_TOKEN),\r\n  ]);\r\n};\r\n\r\nconst decodeBase64 = (value) => {\r\n  if (typeof value !== 'string') return null;\r\n\r\n  // base64url -> base64\r\n  const base64 = value.replace(/-/g, '+').replace(/_/g, '/');\r\n  const padding = base64.length % 4 === 0 ? '' : '='.repeat(4 - (base64.length % 4));\r\n  const normalized = `${base64}${padding}`;\r\n\r\n  if (typeof globalThis?.atob === 'function') {\r\n    try {\r\n      return globalThis.atob(normalized);\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Jest/Node fallback\r\n  // eslint-disable-next-line no-undef\r\n  if (typeof Buffer !== 'undefined') {\r\n    // eslint-disable-next-line no-undef\r\n    return Buffer.from(normalized, 'base64').toString('utf8');\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst getJwtPayload = (token) => {\r\n  if (typeof token !== 'string') return null;\r\n  const parts = token.split('.');\r\n  if (parts.length < 2) return null;\r\n\r\n  const decoded = decodeBase64(parts[1]);\r\n  if (!decoded) return null;\r\n\r\n  try {\r\n    return JSON.parse(decoded);\r\n  } catch {\r\n    return null;\r\n  }\r\n};\r\n\r\nconst isTokenExpired = (token) => {\r\n  if (!token) return true;\r\n\r\n  const payload = getJwtPayload(token);\r\n  const expSeconds = payload?.exp;\r\n  if (typeof expSeconds !== 'number' || !Number.isFinite(expSeconds)) return true;\r\n\r\n  const expMs = expSeconds * 1000;\r\n  return Date.now() >= expMs;\r\n};\r\n\r\nexport { getAccessToken, getRefreshToken, setTokens, clearTokens, isTokenExpired };\r\n\r\n"],"mappings":"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","ignoreList":[]}