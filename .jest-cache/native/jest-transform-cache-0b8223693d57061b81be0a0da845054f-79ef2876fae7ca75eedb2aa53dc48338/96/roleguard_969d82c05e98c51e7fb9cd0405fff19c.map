{"version":3,"names":["_react","require","_reactRedux","_expoRouter","_selectors","ROLE_GUARD_ERRORS","exports","NO_USER","NO_ROLE","INSUFFICIENT_ROLE","useRoleGuard","options","_ref","requiredRoles","_ref$redirectPath","redirectPath","router","useRouter","user","useSelector","selectUser","requiredRolesArray","useMemo","Array","isArray","hasAccess","length","userRole","role","userRoles","roles","normalizedUserRoles","some","requiredRole","includes","errorCode","hasRedirected","useRef","useEffect","current","replace"],"sources":["role.guard.js"],"sourcesContent":["/**\r\n * Role Guard Hook\r\n * \r\n * Checks user roles and redirects if access denied.\r\n * \r\n * @param {Object} options - Configuration options\r\n * @param {string|string[]} options.requiredRoles - Required role(s) for access\r\n * @param {string} [options.redirectPath='/home'] - Path to redirect to if access denied\r\n * @returns {Object} Access state object with { hasAccess, errorCode }\r\n * \r\n * @example\r\n * const { hasAccess, errorCode } = useRoleGuard({ requiredRoles: 'ADMIN' });\r\n * const { hasAccess, errorCode } = useRoleGuard({ requiredRoles: ['ADMIN', 'MODERATOR'], redirectPath: '/unauthorized' });\r\n */\r\n\r\nimport { useEffect, useRef, useMemo } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { useRouter } from 'expo-router';\r\nimport { selectUser } from '@store/selectors';\r\n\r\n// Error codes\r\nexport const ROLE_GUARD_ERRORS = {\r\n  NO_USER: 'NO_USER',\r\n  NO_ROLE: 'NO_ROLE',\r\n  INSUFFICIENT_ROLE: 'INSUFFICIENT_ROLE',\r\n};\r\n\r\nexport function useRoleGuard(options) {\r\n  const { requiredRoles, redirectPath = '/home' } = options || {};\r\n  \r\n  const router = useRouter();\r\n  const user = useSelector(selectUser);\r\n  \r\n  // Normalize requiredRoles to array\r\n  const requiredRolesArray = useMemo(() => {\r\n    if (!requiredRoles) {\r\n      return [];\r\n    }\r\n    return Array.isArray(requiredRoles) ? requiredRoles : [requiredRoles];\r\n  }, [requiredRoles]);\r\n  \r\n  // Check if user has required role(s)\r\n  const hasAccess = useMemo(() => {\r\n    // No user means no access\r\n    if (!user) {\r\n      return false;\r\n    }\r\n    \r\n    // No required roles means access granted\r\n    if (requiredRolesArray.length === 0) {\r\n      return true;\r\n    }\r\n    \r\n    // Get user role (user.role or user.roles array)\r\n    const userRole = user.role;\r\n    const userRoles = user.roles || (userRole ? [userRole] : []);\r\n    \r\n    // Check if user has at least one of the required roles\r\n    const normalizedUserRoles = Array.isArray(userRoles) ? userRoles : [userRoles];\r\n    return requiredRolesArray.some((requiredRole) =>\r\n      normalizedUserRoles.includes(requiredRole)\r\n    );\r\n  }, [user, requiredRolesArray]);\r\n  \r\n  // Determine error code\r\n  const errorCode = useMemo(() => {\r\n    if (!user) {\r\n      return ROLE_GUARD_ERRORS.NO_USER;\r\n    }\r\n    if (!hasAccess && requiredRolesArray.length > 0) {\r\n      return ROLE_GUARD_ERRORS.INSUFFICIENT_ROLE;\r\n    }\r\n    return null;\r\n  }, [user, hasAccess, requiredRolesArray]);\r\n  \r\n  // Use ref to track if redirect has been performed to prevent multiple redirects\r\n  const hasRedirected = useRef(false);\r\n  \r\n  useEffect(() => {\r\n    if (hasAccess) {\r\n      // Reset redirect flag when access granted\r\n      hasRedirected.current = false;\r\n    } else if (!hasRedirected.current && requiredRolesArray.length > 0) {\r\n      // Only redirect if access denied and haven't redirected yet\r\n      hasRedirected.current = true;\r\n      router.replace(redirectPath);\r\n    }\r\n  }, [hasAccess, redirectPath, router, requiredRolesArray.length]);\r\n  \r\n  return {\r\n    hasAccess,\r\n    errorCode,\r\n  };\r\n}\r\n\r\n"],"mappings":";;;;;AAeA,IAAAA,MAAA,GAAAC,OAAA;AACA,IAAAC,WAAA,GAAAD,OAAA;AACA,IAAAE,WAAA,GAAAF,OAAA;AACA,IAAAG,UAAA,GAAAH,OAAA;AAGO,IAAMI,iBAAiB,GAAAC,OAAA,CAAAD,iBAAA,GAAG;EAC/BE,OAAO,EAAE,SAAS;EAClBC,OAAO,EAAE,SAAS;EAClBC,iBAAiB,EAAE;AACrB,CAAC;AAEM,SAASC,YAAYA,CAACC,OAAO,EAAE;EACpC,IAAAC,IAAA,GAAkDD,OAAO,IAAI,CAAC,CAAC;IAAvDE,aAAa,GAAAD,IAAA,CAAbC,aAAa;IAAAC,iBAAA,GAAAF,IAAA,CAAEG,YAAY;IAAZA,YAAY,GAAAD,iBAAA,cAAG,OAAO,GAAAA,iBAAA;EAE7C,IAAME,MAAM,GAAG,IAAAC,qBAAS,EAAC,CAAC;EAC1B,IAAMC,IAAI,GAAG,IAAAC,uBAAW,EAACC,qBAAU,CAAC;EAGpC,IAAMC,kBAAkB,GAAG,IAAAC,cAAO,EAAC,YAAM;IACvC,IAAI,CAACT,aAAa,EAAE;MAClB,OAAO,EAAE;IACX;IACA,OAAOU,KAAK,CAACC,OAAO,CAACX,aAAa,CAAC,GAAGA,aAAa,GAAG,CAACA,aAAa,CAAC;EACvE,CAAC,EAAE,CAACA,aAAa,CAAC,CAAC;EAGnB,IAAMY,SAAS,GAAG,IAAAH,cAAO,EAAC,YAAM;IAE9B,IAAI,CAACJ,IAAI,EAAE;MACT,OAAO,KAAK;IACd;IAGA,IAAIG,kBAAkB,CAACK,MAAM,KAAK,CAAC,EAAE;MACnC,OAAO,IAAI;IACb;IAGA,IAAMC,QAAQ,GAAGT,IAAI,CAACU,IAAI;IAC1B,IAAMC,SAAS,GAAGX,IAAI,CAACY,KAAK,KAAKH,QAAQ,GAAG,CAACA,QAAQ,CAAC,GAAG,EAAE,CAAC;IAG5D,IAAMI,mBAAmB,GAAGR,KAAK,CAACC,OAAO,CAACK,SAAS,CAAC,GAAGA,SAAS,GAAG,CAACA,SAAS,CAAC;IAC9E,OAAOR,kBAAkB,CAACW,IAAI,CAAC,UAACC,YAAY;MAAA,OAC1CF,mBAAmB,CAACG,QAAQ,CAACD,YAAY,CAAC;IAAA,CAC5C,CAAC;EACH,CAAC,EAAE,CAACf,IAAI,EAAEG,kBAAkB,CAAC,CAAC;EAG9B,IAAMc,SAAS,GAAG,IAAAb,cAAO,EAAC,YAAM;IAC9B,IAAI,CAACJ,IAAI,EAAE;MACT,OAAOb,iBAAiB,CAACE,OAAO;IAClC;IACA,IAAI,CAACkB,SAAS,IAAIJ,kBAAkB,CAACK,MAAM,GAAG,CAAC,EAAE;MAC/C,OAAOrB,iBAAiB,CAACI,iBAAiB;IAC5C;IACA,OAAO,IAAI;EACb,CAAC,EAAE,CAACS,IAAI,EAAEO,SAAS,EAAEJ,kBAAkB,CAAC,CAAC;EAGzC,IAAMe,aAAa,GAAG,IAAAC,aAAM,EAAC,KAAK,CAAC;EAEnC,IAAAC,gBAAS,EAAC,YAAM;IACd,IAAIb,SAAS,EAAE;MAEbW,aAAa,CAACG,OAAO,GAAG,KAAK;IAC/B,CAAC,MAAM,IAAI,CAACH,aAAa,CAACG,OAAO,IAAIlB,kBAAkB,CAACK,MAAM,GAAG,CAAC,EAAE;MAElEU,aAAa,CAACG,OAAO,GAAG,IAAI;MAC5BvB,MAAM,CAACwB,OAAO,CAACzB,YAAY,CAAC;IAC9B;EACF,CAAC,EAAE,CAACU,SAAS,EAAEV,YAAY,EAAEC,MAAM,EAAEK,kBAAkB,CAACK,MAAM,CAAC,CAAC;EAEhE,OAAO;IACLD,SAAS,EAATA,SAAS;IACTU,SAAS,EAATA;EACF,CAAC;AACH","ignoreList":[]}