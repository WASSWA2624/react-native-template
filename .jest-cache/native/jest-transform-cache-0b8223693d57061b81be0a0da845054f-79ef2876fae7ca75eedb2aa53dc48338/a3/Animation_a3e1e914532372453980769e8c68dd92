54247d12c0eea43297d341ffbd12dd0f
var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard").default;
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _classPrivateFieldLooseBase2 = _interopRequireDefault(require("@babel/runtime/helpers/classPrivateFieldLooseBase"));
var _classPrivateFieldLooseKey2 = _interopRequireDefault(require("@babel/runtime/helpers/classPrivateFieldLooseKey"));
var _NativeAnimatedHelper = _interopRequireDefault(require("../../../src/private/animated/NativeAnimatedHelper"));
var ReactNativeFeatureFlags = _interopRequireWildcard(require("../../../src/private/featureflags/ReactNativeFeatureFlags"));
var _AnimatedProps = _interopRequireDefault(require("../nodes/AnimatedProps"));
var startNativeAnimationNextId = 1;
var _nativeID = (0, _classPrivateFieldLooseKey2.default)("nativeID");
var _onEnd = (0, _classPrivateFieldLooseKey2.default)("onEnd");
var _useNativeDriver = (0, _classPrivateFieldLooseKey2.default)("useNativeDriver");
var Animation = exports.default = function () {
  function Animation(config) {
    var _config$isInteraction, _config$iterations;
    (0, _classCallCheck2.default)(this, Animation);
    Object.defineProperty(this, _nativeID, {
      writable: true,
      value: void 0
    });
    Object.defineProperty(this, _onEnd, {
      writable: true,
      value: void 0
    });
    Object.defineProperty(this, _useNativeDriver, {
      writable: true,
      value: void 0
    });
    (0, _classPrivateFieldLooseBase2.default)(this, _useNativeDriver)[_useNativeDriver] = _NativeAnimatedHelper.default.shouldUseNativeDriver(config);
    this.__active = false;
    this.__isInteraction = (_config$isInteraction = config.isInteraction) != null ? _config$isInteraction : !(0, _classPrivateFieldLooseBase2.default)(this, _useNativeDriver)[_useNativeDriver];
    this.__isLooping = config.isLooping;
    this.__iterations = (_config$iterations = config.iterations) != null ? _config$iterations : 1;
    if (__DEV__) {
      this.__debugID = config.debugID;
    }
  }
  return (0, _createClass2.default)(Animation, [{
    key: "start",
    value: function start(fromValue, onUpdate, onEnd, previousAnimation, animatedValue) {
      if (!(0, _classPrivateFieldLooseBase2.default)(this, _useNativeDriver)[_useNativeDriver] && animatedValue.__isNative === true) {
        throw new Error('Attempting to run JS driven animation on animated node ' + 'that has been moved to "native" earlier by starting an ' + 'animation with `useNativeDriver: true`');
      }
      (0, _classPrivateFieldLooseBase2.default)(this, _onEnd)[_onEnd] = onEnd;
      this.__active = true;
    }
  }, {
    key: "stop",
    value: function stop() {
      if ((0, _classPrivateFieldLooseBase2.default)(this, _nativeID)[_nativeID] != null) {
        var nativeID = (0, _classPrivateFieldLooseBase2.default)(this, _nativeID)[_nativeID];
        var identifier = `${nativeID}:stopAnimation`;
        try {
          _NativeAnimatedHelper.default.API.setWaitingForIdentifier(identifier);
          _NativeAnimatedHelper.default.API.stopAnimation(nativeID);
        } finally {
          _NativeAnimatedHelper.default.API.unsetWaitingForIdentifier(identifier);
        }
      }
      this.__active = false;
    }
  }, {
    key: "__getNativeAnimationConfig",
    value: function __getNativeAnimationConfig() {
      throw new Error('This animation type cannot be offloaded to native');
    }
  }, {
    key: "__findAnimatedPropsNodes",
    value: function __findAnimatedPropsNodes(node) {
      var result = [];
      if (node instanceof _AnimatedProps.default) {
        result.push(node);
        return result;
      }
      for (var child of node.__getChildren()) {
        result.push.apply(result, (0, _toConsumableArray2.default)(this.__findAnimatedPropsNodes(child)));
      }
      return result;
    }
  }, {
    key: "__startAnimationIfNative",
    value: function __startAnimationIfNative(animatedValue) {
      var _this = this;
      if (!(0, _classPrivateFieldLooseBase2.default)(this, _useNativeDriver)[_useNativeDriver]) {
        return false;
      }
      var startNativeAnimationWaitId = `${startNativeAnimationNextId}:startAnimation`;
      startNativeAnimationNextId += 1;
      _NativeAnimatedHelper.default.API.setWaitingForIdentifier(startNativeAnimationWaitId);
      try {
        var config = this.__getNativeAnimationConfig();
        animatedValue.__makeNative(config.platformConfig);
        (0, _classPrivateFieldLooseBase2.default)(this, _nativeID)[_nativeID] = _NativeAnimatedHelper.default.generateNewAnimationId();
        _NativeAnimatedHelper.default.API.startAnimatingNode((0, _classPrivateFieldLooseBase2.default)(this, _nativeID)[_nativeID], animatedValue.__getNativeTag(), config, function (result) {
          _this.__notifyAnimationEnd(result);
          var value = result.value,
            offset = result.offset;
          if (value != null) {
            animatedValue.__onAnimatedValueUpdateReceived(value, offset);
            if (!(ReactNativeFeatureFlags.cxxNativeAnimatedEnabled() && ReactNativeFeatureFlags.cxxNativeAnimatedRemoveJsSync())) {
              if (_this.__isLooping === true) {
                return;
              }
            }
            _this.__findAnimatedPropsNodes(animatedValue).forEach(function (node) {
              return node.update();
            });
          }
        });
        return true;
      } catch (e) {
        throw e;
      } finally {
        _NativeAnimatedHelper.default.API.unsetWaitingForIdentifier(startNativeAnimationWaitId);
      }
    }
  }, {
    key: "__notifyAnimationEnd",
    value: function __notifyAnimationEnd(result) {
      var callback = (0, _classPrivateFieldLooseBase2.default)(this, _onEnd)[_onEnd];
      if (callback != null) {
        (0, _classPrivateFieldLooseBase2.default)(this, _onEnd)[_onEnd] = null;
        callback(result);
      }
    }
  }, {
    key: "__getDebugID",
    value: function __getDebugID() {
      if (__DEV__) {
        return this.__debugID;
      }
      return undefined;
    }
  }]);
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfTmF0aXZlQW5pbWF0ZWRIZWxwZXIiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIlJlYWN0TmF0aXZlRmVhdHVyZUZsYWdzIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJfQW5pbWF0ZWRQcm9wcyIsInN0YXJ0TmF0aXZlQW5pbWF0aW9uTmV4dElkIiwiX25hdGl2ZUlEIiwiX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkyIiwiZGVmYXVsdCIsIl9vbkVuZCIsIl91c2VOYXRpdmVEcml2ZXIiLCJBbmltYXRpb24iLCJleHBvcnRzIiwiY29uZmlnIiwiX2NvbmZpZyRpc0ludGVyYWN0aW9uIiwiX2NvbmZpZyRpdGVyYXRpb25zIiwiX2NsYXNzQ2FsbENoZWNrMiIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwid3JpdGFibGUiLCJ2YWx1ZSIsIl9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZTIiLCJOYXRpdmVBbmltYXRlZEhlbHBlciIsInNob3VsZFVzZU5hdGl2ZURyaXZlciIsIl9fYWN0aXZlIiwiX19pc0ludGVyYWN0aW9uIiwiaXNJbnRlcmFjdGlvbiIsIl9faXNMb29waW5nIiwiaXNMb29waW5nIiwiX19pdGVyYXRpb25zIiwiaXRlcmF0aW9ucyIsIl9fREVWX18iLCJfX2RlYnVnSUQiLCJkZWJ1Z0lEIiwiX2NyZWF0ZUNsYXNzMiIsImtleSIsInN0YXJ0IiwiZnJvbVZhbHVlIiwib25VcGRhdGUiLCJvbkVuZCIsInByZXZpb3VzQW5pbWF0aW9uIiwiYW5pbWF0ZWRWYWx1ZSIsIl9faXNOYXRpdmUiLCJFcnJvciIsInN0b3AiLCJuYXRpdmVJRCIsImlkZW50aWZpZXIiLCJBUEkiLCJzZXRXYWl0aW5nRm9ySWRlbnRpZmllciIsInN0b3BBbmltYXRpb24iLCJ1bnNldFdhaXRpbmdGb3JJZGVudGlmaWVyIiwiX19nZXROYXRpdmVBbmltYXRpb25Db25maWciLCJfX2ZpbmRBbmltYXRlZFByb3BzTm9kZXMiLCJub2RlIiwicmVzdWx0IiwiQW5pbWF0ZWRQcm9wcyIsInB1c2giLCJjaGlsZCIsIl9fZ2V0Q2hpbGRyZW4iLCJhcHBseSIsIl90b0NvbnN1bWFibGVBcnJheTIiLCJfX3N0YXJ0QW5pbWF0aW9uSWZOYXRpdmUiLCJfdGhpcyIsInN0YXJ0TmF0aXZlQW5pbWF0aW9uV2FpdElkIiwiX19tYWtlTmF0aXZlIiwicGxhdGZvcm1Db25maWciLCJnZW5lcmF0ZU5ld0FuaW1hdGlvbklkIiwic3RhcnRBbmltYXRpbmdOb2RlIiwiX19nZXROYXRpdmVUYWciLCJfX25vdGlmeUFuaW1hdGlvbkVuZCIsIm9mZnNldCIsIl9fb25BbmltYXRlZFZhbHVlVXBkYXRlUmVjZWl2ZWQiLCJjeHhOYXRpdmVBbmltYXRlZEVuYWJsZWQiLCJjeHhOYXRpdmVBbmltYXRlZFJlbW92ZUpzU3luYyIsImZvckVhY2giLCJ1cGRhdGUiLCJlIiwiY2FsbGJhY2siLCJfX2dldERlYnVnSUQiLCJ1bmRlZmluZWQiXSwic291cmNlcyI6WyJBbmltYXRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIE1ldGEgUGxhdGZvcm1zLCBJbmMuIGFuZCBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93IHN0cmljdC1sb2NhbFxuICogQGZvcm1hdFxuICovXG5cbmltcG9ydCB0eXBlIHtQbGF0Zm9ybUNvbmZpZ30gZnJvbSAnLi4vQW5pbWF0ZWRQbGF0Zm9ybUNvbmZpZyc7XG5pbXBvcnQgdHlwZSBBbmltYXRlZE5vZGUgZnJvbSAnLi4vbm9kZXMvQW5pbWF0ZWROb2RlJztcbmltcG9ydCB0eXBlIEFuaW1hdGVkVmFsdWUgZnJvbSAnLi4vbm9kZXMvQW5pbWF0ZWRWYWx1ZSc7XG5cbmltcG9ydCBOYXRpdmVBbmltYXRlZEhlbHBlciBmcm9tICcuLi8uLi8uLi9zcmMvcHJpdmF0ZS9hbmltYXRlZC9OYXRpdmVBbmltYXRlZEhlbHBlcic7XG5pbXBvcnQgKiBhcyBSZWFjdE5hdGl2ZUZlYXR1cmVGbGFncyBmcm9tICcuLi8uLi8uLi9zcmMvcHJpdmF0ZS9mZWF0dXJlZmxhZ3MvUmVhY3ROYXRpdmVGZWF0dXJlRmxhZ3MnO1xuaW1wb3J0IEFuaW1hdGVkUHJvcHMgZnJvbSAnLi4vbm9kZXMvQW5pbWF0ZWRQcm9wcyc7XG5cbmV4cG9ydCB0eXBlIEVuZFJlc3VsdCA9IHtcbiAgZmluaXNoZWQ6IGJvb2xlYW4sXG4gIHZhbHVlPzogbnVtYmVyLFxuICBvZmZzZXQ/OiBudW1iZXIsXG4gIC4uLlxufTtcbmV4cG9ydCB0eXBlIEVuZENhbGxiYWNrID0gKHJlc3VsdDogRW5kUmVzdWx0KSA9PiB2b2lkO1xuXG5leHBvcnQgdHlwZSBBbmltYXRpb25Db25maWcgPSAkUmVhZE9ubHk8e1xuICBpc0ludGVyYWN0aW9uPzogYm9vbGVhbixcbiAgdXNlTmF0aXZlRHJpdmVyOiBib29sZWFuLFxuICBwbGF0Zm9ybUNvbmZpZz86IFBsYXRmb3JtQ29uZmlnLFxuICBvbkNvbXBsZXRlPzogP0VuZENhbGxiYWNrLFxuICBpdGVyYXRpb25zPzogbnVtYmVyLFxuICBpc0xvb3Bpbmc/OiBib29sZWFuLFxuICBkZWJ1Z0lEPzogP3N0cmluZyxcbiAgLi4uXG59PjtcblxubGV0IHN0YXJ0TmF0aXZlQW5pbWF0aW9uTmV4dElkID0gMTtcblxuLy8gSW1wb3J0YW50IG5vdGU6IHN0YXJ0KCkgYW5kIHN0b3AoKSB3aWxsIG9ubHkgYmUgY2FsbGVkIGF0IG1vc3Qgb25jZS5cbi8vIE9uY2UgYW4gYW5pbWF0aW9uIGhhcyBiZWVuIHN0b3BwZWQgb3IgZmluaXNoZWQgaXRzIGNvdXJzZSwgaXQgd2lsbFxuLy8gbm90IGJlIHJldXNlZC5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFuaW1hdGlvbiB7XG4gICNuYXRpdmVJRDogP251bWJlcjtcbiAgI29uRW5kOiA/RW5kQ2FsbGJhY2s7XG4gICN1c2VOYXRpdmVEcml2ZXI6IGJvb2xlYW47XG5cbiAgX19hY3RpdmU6IGJvb2xlYW47XG4gIF9faXNJbnRlcmFjdGlvbjogYm9vbGVhbjtcbiAgX19pc0xvb3Bpbmc6ID9ib29sZWFuO1xuICBfX2l0ZXJhdGlvbnM6IG51bWJlcjtcbiAgX19kZWJ1Z0lEOiA/c3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogQW5pbWF0aW9uQ29uZmlnKSB7XG4gICAgdGhpcy4jdXNlTmF0aXZlRHJpdmVyID0gTmF0aXZlQW5pbWF0ZWRIZWxwZXIuc2hvdWxkVXNlTmF0aXZlRHJpdmVyKGNvbmZpZyk7XG5cbiAgICB0aGlzLl9fYWN0aXZlID0gZmFsc2U7XG4gICAgdGhpcy5fX2lzSW50ZXJhY3Rpb24gPSBjb25maWcuaXNJbnRlcmFjdGlvbiA/PyAhdGhpcy4jdXNlTmF0aXZlRHJpdmVyO1xuICAgIHRoaXMuX19pc0xvb3BpbmcgPSBjb25maWcuaXNMb29waW5nO1xuICAgIHRoaXMuX19pdGVyYXRpb25zID0gY29uZmlnLml0ZXJhdGlvbnMgPz8gMTtcbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgdGhpcy5fX2RlYnVnSUQgPSBjb25maWcuZGVidWdJRDtcbiAgICB9XG4gIH1cblxuICBzdGFydChcbiAgICBmcm9tVmFsdWU6IG51bWJlcixcbiAgICBvblVwZGF0ZTogKHZhbHVlOiBudW1iZXIpID0+IHZvaWQsXG4gICAgb25FbmQ6ID9FbmRDYWxsYmFjayxcbiAgICBwcmV2aW91c0FuaW1hdGlvbjogP0FuaW1hdGlvbixcbiAgICBhbmltYXRlZFZhbHVlOiBBbmltYXRlZFZhbHVlLFxuICApOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuI3VzZU5hdGl2ZURyaXZlciAmJiBhbmltYXRlZFZhbHVlLl9faXNOYXRpdmUgPT09IHRydWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ0F0dGVtcHRpbmcgdG8gcnVuIEpTIGRyaXZlbiBhbmltYXRpb24gb24gYW5pbWF0ZWQgbm9kZSAnICtcbiAgICAgICAgICAndGhhdCBoYXMgYmVlbiBtb3ZlZCB0byBcIm5hdGl2ZVwiIGVhcmxpZXIgYnkgc3RhcnRpbmcgYW4gJyArXG4gICAgICAgICAgJ2FuaW1hdGlvbiB3aXRoIGB1c2VOYXRpdmVEcml2ZXI6IHRydWVgJyxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGhpcy4jb25FbmQgPSBvbkVuZDtcbiAgICB0aGlzLl9fYWN0aXZlID0gdHJ1ZTtcbiAgfVxuXG4gIHN0b3AoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuI25hdGl2ZUlEICE9IG51bGwpIHtcbiAgICAgIGNvbnN0IG5hdGl2ZUlEID0gdGhpcy4jbmF0aXZlSUQ7XG4gICAgICBjb25zdCBpZGVudGlmaWVyID0gYCR7bmF0aXZlSUR9OnN0b3BBbmltYXRpb25gO1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gVGhpcyBpcyBvbmx5IHJlcXVpcmVkIHdoZW4gc2luZ2xlT3BCYXRjaGluZyBpcyB1c2VkLCBhcyBvdGhlcndpc2VcbiAgICAgICAgLy8gd2UgZmx1c2ggY2FsbHMgaW1tZWRpYXRlbHkgd2hlbiB0aGVyZSdzIG5vIHBlbmRpbmcgcXVldWUuXG4gICAgICAgIE5hdGl2ZUFuaW1hdGVkSGVscGVyLkFQSS5zZXRXYWl0aW5nRm9ySWRlbnRpZmllcihpZGVudGlmaWVyKTtcbiAgICAgICAgTmF0aXZlQW5pbWF0ZWRIZWxwZXIuQVBJLnN0b3BBbmltYXRpb24obmF0aXZlSUQpO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgTmF0aXZlQW5pbWF0ZWRIZWxwZXIuQVBJLnVuc2V0V2FpdGluZ0ZvcklkZW50aWZpZXIoaWRlbnRpZmllcik7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuX19hY3RpdmUgPSBmYWxzZTtcbiAgfVxuXG4gIF9fZ2V0TmF0aXZlQW5pbWF0aW9uQ29uZmlnKCk6ICRSZWFkT25seTx7XG4gICAgcGxhdGZvcm1Db25maWc6ID9QbGF0Zm9ybUNvbmZpZyxcbiAgICAuLi5cbiAgfT4ge1xuICAgIC8vIFN1YmNsYXNzZXMgdGhhdCBoYXZlIGNvcnJlc3BvbmRpbmcgYW5pbWF0aW9uIGltcGxlbWVudGF0aW9uIGRvbmUgaW4gbmF0aXZlXG4gICAgLy8gc2hvdWxkIG92ZXJyaWRlIHRoaXMgbWV0aG9kXG4gICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGFuaW1hdGlvbiB0eXBlIGNhbm5vdCBiZSBvZmZsb2FkZWQgdG8gbmF0aXZlJyk7XG4gIH1cblxuICBfX2ZpbmRBbmltYXRlZFByb3BzTm9kZXMobm9kZTogQW5pbWF0ZWROb2RlKTogQXJyYXk8QW5pbWF0ZWRQcm9wcz4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuXG4gICAgaWYgKG5vZGUgaW5zdGFuY2VvZiBBbmltYXRlZFByb3BzKSB7XG4gICAgICByZXN1bHQucHVzaChub2RlKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBjaGlsZCBvZiBub2RlLl9fZ2V0Q2hpbGRyZW4oKSkge1xuICAgICAgcmVzdWx0LnB1c2goLi4udGhpcy5fX2ZpbmRBbmltYXRlZFByb3BzTm9kZXMoY2hpbGQpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgX19zdGFydEFuaW1hdGlvbklmTmF0aXZlKGFuaW1hdGVkVmFsdWU6IEFuaW1hdGVkVmFsdWUpOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMuI3VzZU5hdGl2ZURyaXZlcikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IHN0YXJ0TmF0aXZlQW5pbWF0aW9uV2FpdElkID0gYCR7c3RhcnROYXRpdmVBbmltYXRpb25OZXh0SWR9OnN0YXJ0QW5pbWF0aW9uYDtcbiAgICBzdGFydE5hdGl2ZUFuaW1hdGlvbk5leHRJZCArPSAxO1xuICAgIE5hdGl2ZUFuaW1hdGVkSGVscGVyLkFQSS5zZXRXYWl0aW5nRm9ySWRlbnRpZmllcihcbiAgICAgIHN0YXJ0TmF0aXZlQW5pbWF0aW9uV2FpdElkLFxuICAgICk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuX19nZXROYXRpdmVBbmltYXRpb25Db25maWcoKTtcbiAgICAgIGFuaW1hdGVkVmFsdWUuX19tYWtlTmF0aXZlKGNvbmZpZy5wbGF0Zm9ybUNvbmZpZyk7XG4gICAgICB0aGlzLiNuYXRpdmVJRCA9IE5hdGl2ZUFuaW1hdGVkSGVscGVyLmdlbmVyYXRlTmV3QW5pbWF0aW9uSWQoKTtcbiAgICAgIE5hdGl2ZUFuaW1hdGVkSGVscGVyLkFQSS5zdGFydEFuaW1hdGluZ05vZGUoXG4gICAgICAgIHRoaXMuI25hdGl2ZUlELFxuICAgICAgICBhbmltYXRlZFZhbHVlLl9fZ2V0TmF0aXZlVGFnKCksXG4gICAgICAgIGNvbmZpZyxcbiAgICAgICAgcmVzdWx0ID0+IHtcbiAgICAgICAgICB0aGlzLl9fbm90aWZ5QW5pbWF0aW9uRW5kKHJlc3VsdCk7XG5cbiAgICAgICAgICAvLyBXaGVuIHVzaW5nIG5hdGl2ZWx5IGRyaXZlbiBhbmltYXRpb25zLCBvbmNlIHRoZSBhbmltYXRpb24gY29tcGxldGVzLFxuICAgICAgICAgIC8vIHdlIG5lZWQgdG8gZW5zdXJlIHRoYXQgdGhlIEpTIHNpZGUgbm9kZXMgYXJlIHN5bmNlZCB3aXRoIHRoZSB1cGRhdGVkXG4gICAgICAgICAgLy8gdmFsdWVzLlxuICAgICAgICAgIGNvbnN0IHt2YWx1ZSwgb2Zmc2V0fSA9IHJlc3VsdDtcbiAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkge1xuICAgICAgICAgICAgYW5pbWF0ZWRWYWx1ZS5fX29uQW5pbWF0ZWRWYWx1ZVVwZGF0ZVJlY2VpdmVkKHZhbHVlLCBvZmZzZXQpO1xuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICEoXG4gICAgICAgICAgICAgICAgUmVhY3ROYXRpdmVGZWF0dXJlRmxhZ3MuY3h4TmF0aXZlQW5pbWF0ZWRFbmFibGVkKCkgJiZcbiAgICAgICAgICAgICAgICBSZWFjdE5hdGl2ZUZlYXR1cmVGbGFncy5jeHhOYXRpdmVBbmltYXRlZFJlbW92ZUpzU3luYygpXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICBpZiAodGhpcy5fX2lzTG9vcGluZyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBPbmNlIHRoZSBKUyBzaWRlIG5vZGUgaXMgc3luY2VkIHdpdGggdGhlIHVwZGF0ZWQgdmFsdWVzLCB0cmlnZ2VyIGFuXG4gICAgICAgICAgICAvLyB1cGRhdGUgb24gdGhlIEFuaW1hdGVkUHJvcHMgbm9kZXMgdG8gY2FsbCBhbnkgcmVnaXN0ZXJlZCBjYWxsYmFja3MuXG4gICAgICAgICAgICB0aGlzLl9fZmluZEFuaW1hdGVkUHJvcHNOb2RlcyhhbmltYXRlZFZhbHVlKS5mb3JFYWNoKG5vZGUgPT5cbiAgICAgICAgICAgICAgbm9kZS51cGRhdGUoKSxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgZTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgTmF0aXZlQW5pbWF0ZWRIZWxwZXIuQVBJLnVuc2V0V2FpdGluZ0ZvcklkZW50aWZpZXIoXG4gICAgICAgIHN0YXJ0TmF0aXZlQW5pbWF0aW9uV2FpdElkLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTm90aWZ5IHRoZSBjb21wbGV0aW9uIGNhbGxiYWNrIHRoYXQgdGhlIGFuaW1hdGlvbiBoYXMgZW5kZWQuIFRoZSBjb21wbGV0aW9uXG4gICAqIGNhbGxiYWNrIHdpbGwgbmV2ZXIgYmUgY2FsbGVkIG1vcmUgdGhhbiBvbmNlLlxuICAgKi9cbiAgX19ub3RpZnlBbmltYXRpb25FbmQocmVzdWx0OiBFbmRSZXN1bHQpOiB2b2lkIHtcbiAgICBjb25zdCBjYWxsYmFjayA9IHRoaXMuI29uRW5kO1xuICAgIGlmIChjYWxsYmFjayAhPSBudWxsKSB7XG4gICAgICB0aGlzLiNvbkVuZCA9IG51bGw7XG4gICAgICBjYWxsYmFjayhyZXN1bHQpO1xuICAgIH1cbiAgfVxuXG4gIF9fZ2V0RGVidWdJRCgpOiA/c3RyaW5nIHtcbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgcmV0dXJuIHRoaXMuX19kZWJ1Z0lEO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBY0EsSUFBQUEscUJBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLHVCQUFBLEdBQUFDLHVCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBRyxjQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7QUFxQkEsSUFBSUksMEJBQTBCLEdBQUcsQ0FBQztBQUFDLElBQUFDLFNBQUEsT0FBQUMsMkJBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFDLE1BQUEsT0FBQUYsMkJBQUEsQ0FBQUMsT0FBQTtBQUFBLElBQUFFLGdCQUFBLE9BQUFILDJCQUFBLENBQUFDLE9BQUE7QUFBQSxJQUtkRyxTQUFTLEdBQUFDLE9BQUEsQ0FBQUosT0FBQTtFQVc1QixTQUFBRyxVQUFZRSxNQUF1QixFQUFFO0lBQUEsSUFBQUMscUJBQUEsRUFBQUMsa0JBQUE7SUFBQSxJQUFBQyxnQkFBQSxDQUFBUixPQUFBLFFBQUFHLFNBQUE7SUFBQU0sTUFBQSxDQUFBQyxjQUFBLE9BQUFaLFNBQUE7TUFBQWEsUUFBQTtNQUFBQyxLQUFBO0lBQUE7SUFBQUgsTUFBQSxDQUFBQyxjQUFBLE9BQUFULE1BQUE7TUFBQVUsUUFBQTtNQUFBQyxLQUFBO0lBQUE7SUFBQUgsTUFBQSxDQUFBQyxjQUFBLE9BQUFSLGdCQUFBO01BQUFTLFFBQUE7TUFBQUMsS0FBQTtJQUFBO0lBQ25DLElBQUFDLDRCQUFBLENBQUFiLE9BQUEsTUFBSSxFQUFBRSxnQkFBQSxF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