967ed7402fd467405ec716581e07a578
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.apiClient = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _config = require("../../config");
var _errors = require("../../errors");
var _i18n = require("../../i18n");
var _storage = require("../storage");
var _csrf = require("../csrf");
var _interceptors = require("./interceptors");
var resolveRequestLocale = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* () {
    try {
      var storedLocale = yield _storage.async.getItem(_i18n.LOCALE_STORAGE_KEY);
      if (typeof storedLocale === 'string') {
        var value = storedLocale.trim();
        if (value) return value;
      }
      return (0, _i18n.getDeviceLocale)();
    } catch (_unused) {
      return (0, _i18n.getDeviceLocale)();
    }
  });
  return function resolveRequestLocale() {
    return _ref.apply(this, arguments);
  };
}();
var apiClient = exports.apiClient = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* (config) {
    var url = config.url,
      _config$method = config.method,
      method = _config$method === void 0 ? 'GET' : _config$method,
      body = config.body,
      _config$headers = config.headers,
      headers = _config$headers === void 0 ? {} : _config$headers,
      _config$timeout = config.timeout,
      timeout = _config$timeout === void 0 ? _config.TIMEOUTS.API_REQUEST : _config$timeout;
    fetch('http://127.0.0.1:7251/ingest/1d28b85e-4e80-4cd6-84bc-0a14f3ba6cec', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        location: 'client.js:33',
        message: 'api_client_enter',
        data: {
          url: url,
          method: method,
          hasBody: Boolean(body),
          timeout: timeout
        },
        timestamp: Date.now(),
        sessionId: 'debug-session',
        runId: 'login-redirect',
        hypothesisId: 'H6'
      })
    }).catch(function () {});
    var authConfig = yield (0, _interceptors.attachAuthHeader)({
      url: url,
      method: method,
      body: body,
      headers: headers
    });
    fetch('http://127.0.0.1:7251/ingest/1d28b85e-4e80-4cd6-84bc-0a14f3ba6cec', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        location: 'client.js:37',
        message: 'api_client_auth_config',
        data: {
          url: authConfig == null ? void 0 : authConfig.url,
          method: authConfig == null ? void 0 : authConfig.method,
          hasHeaders: Boolean(authConfig == null ? void 0 : authConfig.headers)
        },
        timestamp: Date.now(),
        sessionId: 'debug-session',
        runId: 'login-redirect',
        hypothesisId: 'H7'
      })
    }).catch(function () {});
    var csrfHeaders = {};
    if (['POST', 'PUT', 'DELETE', 'PATCH'].includes(method)) {
      try {
        csrfHeaders = yield (0, _csrf.getCsrfHeaders)();
      } catch (csrfError) {
        console.error('[API] Failed to get CSRF token, continuing without it:', csrfError);
      }
    }
    var controller = new AbortController();
    var timeoutId = setTimeout(function () {
      return controller.abort();
    }, timeout);
    try {
      var _response$headers;
      var locale = yield resolveRequestLocale();
      fetch('http://127.0.0.1:7251/ingest/1d28b85e-4e80-4cd6-84bc-0a14f3ba6cec', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          location: 'client.js:45',
          message: 'api_client_before_fetch',
          data: {
            url: authConfig == null ? void 0 : authConfig.url,
            locale: locale
          },
          timestamp: Date.now(),
          sessionId: 'debug-session',
          runId: 'login-redirect',
          hypothesisId: 'H8'
        })
      }).catch(function () {});
      var response = yield fetch(authConfig.url, {
        method: authConfig.method,
        credentials: 'include',
        headers: Object.assign({
          'Content-Type': 'application/json'
        }, locale ? {
          'Accept-Language': locale
        } : {}, authConfig.headers, csrfHeaders),
        body: authConfig.body ? JSON.stringify(authConfig.body) : undefined,
        signal: controller.signal
      });
      clearTimeout(timeoutId);
      fetch('http://127.0.0.1:7251/ingest/1d28b85e-4e80-4cd6-84bc-0a14f3ba6cec', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          location: 'client.js:58',
          message: 'api_client_response',
          data: {
            status: response == null ? void 0 : response.status,
            ok: response == null ? void 0 : response.ok
          },
          timestamp: Date.now(),
          sessionId: 'debug-session',
          runId: 'login-redirect',
          hypothesisId: 'H9'
        })
      }).catch(function () {});
      var contentType = ((_response$headers = response.headers) == null || _response$headers.get == null ? void 0 : _response$headers.get('content-type')) || '';
      var hasJson = contentType.includes('application/json');
      if (!response.ok) {
        var _errorData, _errorData2;
        var errorData = null;
        if (hasJson) {
          try {
            errorData = yield response.json();
          } catch (e) {}
        }
        var error = {
          status: response.status,
          statusText: response.statusText,
          message: ((_errorData = errorData) == null ? void 0 : _errorData.message) || `API request failed: ${response.statusText}`,
          errors: ((_errorData2 = errorData) == null ? void 0 : _errorData2.errors) || []
        };
        throw yield (0, _interceptors.handleAuthError)(error);
      }
      var data = hasJson ? yield response.json() : null;
      return {
        data: data,
        status: response.status
      };
    } catch (error) {
      clearTimeout(timeoutId);
      fetch('http://127.0.0.1:7251/ingest/1d28b85e-4e80-4cd6-84bc-0a14f3ba6cec', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          location: 'client.js:86',
          message: 'api_client_error',
          data: {
            name: (error == null ? void 0 : error.name) || null,
            message: typeof (error == null ? void 0 : error.message) === 'string' ? error.message.slice(0, 120) : null
          },
          timestamp: Date.now(),
          sessionId: 'debug-session',
          runId: 'login-redirect',
          hypothesisId: 'H8'
        })
      }).catch(function () {});
      if (error.name === 'AbortError') {
        throw (0, _errors.handleError)(new Error('Request timeout'), {
          url: url
        });
      }
      throw yield (0, _interceptors.handleAuthError)(error);
    }
  });
  return function apiClient(_x) {
    return _ref2.apply(this, arguments);
  };
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfY29uZmlnIiwicmVxdWlyZSIsIl9lcnJvcnMiLCJfaTE4biIsIl9zdG9yYWdlIiwiX2NzcmYiLCJfaW50ZXJjZXB0b3JzIiwicmVzb2x2ZVJlcXVlc3RMb2NhbGUiLCJfcmVmIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwiZGVmYXVsdCIsInN0b3JlZExvY2FsZSIsImFzeW5jU3RvcmFnZSIsImdldEl0ZW0iLCJMT0NBTEVfU1RPUkFHRV9LRVkiLCJ2YWx1ZSIsInRyaW0iLCJnZXREZXZpY2VMb2NhbGUiLCJfdW51c2VkIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJhcGlDbGllbnQiLCJleHBvcnRzIiwiX3JlZjIiLCJjb25maWciLCJ1cmwiLCJfY29uZmlnJG1ldGhvZCIsIm1ldGhvZCIsImJvZHkiLCJfY29uZmlnJGhlYWRlcnMiLCJoZWFkZXJzIiwiX2NvbmZpZyR0aW1lb3V0IiwidGltZW91dCIsIlRJTUVPVVRTIiwiQVBJX1JFUVVFU1QiLCJmZXRjaCIsIkpTT04iLCJzdHJpbmdpZnkiLCJsb2NhdGlvbiIsIm1lc3NhZ2UiLCJkYXRhIiwiaGFzQm9keSIsIkJvb2xlYW4iLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93Iiwic2Vzc2lvbklkIiwicnVuSWQiLCJoeXBvdGhlc2lzSWQiLCJjYXRjaCIsImF1dGhDb25maWciLCJhdHRhY2hBdXRoSGVhZGVyIiwiaGFzSGVhZGVycyIsImNzcmZIZWFkZXJzIiwiaW5jbHVkZXMiLCJnZXRDc3JmSGVhZGVycyIsImNzcmZFcnJvciIsImNvbnNvbGUiLCJlcnJvciIsImNvbnRyb2xsZXIiLCJBYm9ydENvbnRyb2xsZXIiLCJ0aW1lb3V0SWQiLCJzZXRUaW1lb3V0IiwiYWJvcnQiLCJfcmVzcG9uc2UkaGVhZGVycyIsImxvY2FsZSIsInJlc3BvbnNlIiwiY3JlZGVudGlhbHMiLCJPYmplY3QiLCJhc3NpZ24iLCJ1bmRlZmluZWQiLCJzaWduYWwiLCJjbGVhclRpbWVvdXQiLCJzdGF0dXMiLCJvayIsImNvbnRlbnRUeXBlIiwiZ2V0IiwiaGFzSnNvbiIsIl9lcnJvckRhdGEiLCJfZXJyb3JEYXRhMiIsImVycm9yRGF0YSIsImpzb24iLCJlIiwic3RhdHVzVGV4dCIsImVycm9ycyIsImhhbmRsZUF1dGhFcnJvciIsIm5hbWUiLCJzbGljZSIsImhhbmRsZUVycm9yIiwiRXJyb3IiLCJfeCJdLCJzb3VyY2VzIjpbImNsaWVudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQVBJIENsaWVudFxyXG4gKiBDZW50cmFsaXplZCBmZXRjaCB3cmFwcGVyXHJcbiAqIEZpbGU6IGNsaWVudC5qc1xyXG4gKi9cclxuaW1wb3J0IHsgVElNRU9VVFMgfSBmcm9tICdAY29uZmlnJztcclxuaW1wb3J0IHsgaGFuZGxlRXJyb3IgfSBmcm9tICdAZXJyb3JzJztcclxuaW1wb3J0IHsgZ2V0RGV2aWNlTG9jYWxlLCBMT0NBTEVfU1RPUkFHRV9LRVkgfSBmcm9tICdAaTE4bic7XHJcbmltcG9ydCB7IGFzeW5jIGFzIGFzeW5jU3RvcmFnZSB9IGZyb20gJ0BzZXJ2aWNlcy9zdG9yYWdlJztcclxuaW1wb3J0IHsgZ2V0Q3NyZkhlYWRlcnMsIGNsZWFyQ3NyZlRva2VuIH0gZnJvbSAnQHNlcnZpY2VzL2NzcmYnO1xyXG5pbXBvcnQgeyBhdHRhY2hBdXRoSGVhZGVyLCBoYW5kbGVBdXRoRXJyb3IgfSBmcm9tICcuL2ludGVyY2VwdG9ycyc7XHJcblxyXG5jb25zdCByZXNvbHZlUmVxdWVzdExvY2FsZSA9IGFzeW5jICgpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc3RvcmVkTG9jYWxlID0gYXdhaXQgYXN5bmNTdG9yYWdlLmdldEl0ZW0oTE9DQUxFX1NUT1JBR0VfS0VZKTtcclxuICAgIGlmICh0eXBlb2Ygc3RvcmVkTG9jYWxlID09PSAnc3RyaW5nJykge1xyXG4gICAgICBjb25zdCB2YWx1ZSA9IHN0b3JlZExvY2FsZS50cmltKCk7XHJcbiAgICAgIGlmICh2YWx1ZSkgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGdldERldmljZUxvY2FsZSgpO1xyXG4gIH0gY2F0Y2gge1xyXG4gICAgcmV0dXJuIGdldERldmljZUxvY2FsZSgpO1xyXG4gIH1cclxufTtcclxuXHJcbmNvbnN0IGFwaUNsaWVudCA9IGFzeW5jIChjb25maWcpID0+IHtcclxuICBjb25zdCB7XHJcbiAgICB1cmwsXHJcbiAgICBtZXRob2QgPSAnR0VUJyxcclxuICAgIGJvZHksXHJcbiAgICBoZWFkZXJzID0ge30sXHJcbiAgICB0aW1lb3V0ID0gVElNRU9VVFMuQVBJX1JFUVVFU1QsXHJcbiAgfSA9IGNvbmZpZztcclxuICAvLyAjcmVnaW9uIGFnZW50IGxvZ1xyXG4gIGZldGNoKCdodHRwOi8vMTI3LjAuMC4xOjcyNTEvaW5nZXN0LzFkMjhiODVlLTRlODAtNGNkNi04NGJjLTBhMTRmM2JhNmNlYycse21ldGhvZDonUE9TVCcsaGVhZGVyczp7J0NvbnRlbnQtVHlwZSc6J2FwcGxpY2F0aW9uL2pzb24nfSxib2R5OkpTT04uc3RyaW5naWZ5KHtsb2NhdGlvbjonY2xpZW50LmpzOjMzJyxtZXNzYWdlOidhcGlfY2xpZW50X2VudGVyJyxkYXRhOnt1cmwsbWV0aG9kLGhhc0JvZHk6Qm9vbGVhbihib2R5KSx0aW1lb3V0fSx0aW1lc3RhbXA6RGF0ZS5ub3coKSxzZXNzaW9uSWQ6J2RlYnVnLXNlc3Npb24nLHJ1bklkOidsb2dpbi1yZWRpcmVjdCcsaHlwb3RoZXNpc0lkOidINid9KX0pLmNhdGNoKCgpPT57fSk7XHJcbiAgLy8gI2VuZHJlZ2lvbiBhZ2VudCBsb2dcclxuXHJcbiAgLy8gQXR0YWNoIGF1dGggaGVhZGVyXHJcbiAgY29uc3QgYXV0aENvbmZpZyA9IGF3YWl0IGF0dGFjaEF1dGhIZWFkZXIoeyB1cmwsIG1ldGhvZCwgYm9keSwgaGVhZGVycyB9KTtcclxuICAvLyAjcmVnaW9uIGFnZW50IGxvZ1xyXG4gIGZldGNoKCdodHRwOi8vMTI3LjAuMC4xOjcyNTEvaW5nZXN0LzFkMjhiODVlLTRlODAtNGNkNi04NGJjLTBhMTRmM2JhNmNlYycse21ldGhvZDonUE9TVCcsaGVhZGVyczp7J0NvbnRlbnQtVHlwZSc6J2FwcGxpY2F0aW9uL2pzb24nfSxib2R5OkpTT04uc3RyaW5naWZ5KHtsb2NhdGlvbjonY2xpZW50LmpzOjM3JyxtZXNzYWdlOidhcGlfY2xpZW50X2F1dGhfY29uZmlnJyxkYXRhOnt1cmw6YXV0aENvbmZpZz8udXJsLG1ldGhvZDphdXRoQ29uZmlnPy5tZXRob2QsaGFzSGVhZGVyczpCb29sZWFuKGF1dGhDb25maWc/LmhlYWRlcnMpfSx0aW1lc3RhbXA6RGF0ZS5ub3coKSxzZXNzaW9uSWQ6J2RlYnVnLXNlc3Npb24nLHJ1bklkOidsb2dpbi1yZWRpcmVjdCcsaHlwb3RoZXNpc0lkOidINyd9KX0pLmNhdGNoKCgpPT57fSk7XHJcbiAgLy8gI2VuZHJlZ2lvbiBhZ2VudCBsb2dcclxuXHJcbiAgLy8gR2V0IENTUkYgaGVhZGVycyBmb3Igc3RhdGUtY2hhbmdpbmcgcmVxdWVzdHNcclxuICBsZXQgY3NyZkhlYWRlcnMgPSB7fTtcclxuICBpZiAoWydQT1NUJywgJ1BVVCcsICdERUxFVEUnLCAnUEFUQ0gnXS5pbmNsdWRlcyhtZXRob2QpKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjc3JmSGVhZGVycyA9IGF3YWl0IGdldENzcmZIZWFkZXJzKCk7XHJcbiAgICB9IGNhdGNoIChjc3JmRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignW0FQSV0gRmFpbGVkIHRvIGdldCBDU1JGIHRva2VuLCBjb250aW51aW5nIHdpdGhvdXQgaXQ6JywgY3NyZkVycm9yKTtcclxuICAgICAgLy8gRm9yIG5vdywgY29udGludWUgd2l0aG91dCBDU1JGIHRva2VuIHRvIGFsbG93IGRldmVsb3BtZW50XHJcbiAgICAgIC8vIEluIHByb2R1Y3Rpb24sIHlvdSBtYXkgd2FudCB0byB0aHJvdyBoZXJlXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBDcmVhdGUgYWJvcnQgY29udHJvbGxlciBmb3IgdGltZW91dFxyXG4gIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XHJcbiAgY29uc3QgdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiBjb250cm9sbGVyLmFib3J0KCksIHRpbWVvdXQpO1xyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgbG9jYWxlID0gYXdhaXQgcmVzb2x2ZVJlcXVlc3RMb2NhbGUoKTtcclxuICAgIC8vICNyZWdpb24gYWdlbnQgbG9nXHJcbiAgICBmZXRjaCgnaHR0cDovLzEyNy4wLjAuMTo3MjUxL2luZ2VzdC8xZDI4Yjg1ZS00ZTgwLTRjZDYtODRiYy0wYTE0ZjNiYTZjZWMnLHttZXRob2Q6J1BPU1QnLGhlYWRlcnM6eydDb250ZW50LVR5cGUnOidhcHBsaWNhdGlvbi9qc29uJ30sYm9keTpKU09OLnN0cmluZ2lmeSh7bG9jYXRpb246J2NsaWVudC5qczo0NScsbWVzc2FnZTonYXBpX2NsaWVudF9iZWZvcmVfZmV0Y2gnLGRhdGE6e3VybDphdXRoQ29uZmlnPy51cmwsbG9jYWxlfSx0aW1lc3RhbXA6RGF0ZS5ub3coKSxzZXNzaW9uSWQ6J2RlYnVnLXNlc3Npb24nLHJ1bklkOidsb2dpbi1yZWRpcmVjdCcsaHlwb3RoZXNpc0lkOidIOCd9KX0pLmNhdGNoKCgpPT57fSk7XHJcbiAgICAvLyAjZW5kcmVnaW9uIGFnZW50IGxvZ1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChhdXRoQ29uZmlnLnVybCwge1xyXG4gICAgICBtZXRob2Q6IGF1dGhDb25maWcubWV0aG9kLFxyXG4gICAgICBjcmVkZW50aWFsczogJ2luY2x1ZGUnLCAvLyBJbmNsdWRlIGNvb2tpZXMgZm9yIHNlc3Npb25cclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgLi4uKGxvY2FsZSA/IHsgJ0FjY2VwdC1MYW5ndWFnZSc6IGxvY2FsZSB9IDoge30pLFxyXG4gICAgICAgIC4uLmF1dGhDb25maWcuaGVhZGVycyxcclxuICAgICAgICAuLi5jc3JmSGVhZGVycyxcclxuICAgICAgfSxcclxuICAgICAgYm9keTogYXV0aENvbmZpZy5ib2R5ID8gSlNPTi5zdHJpbmdpZnkoYXV0aENvbmZpZy5ib2R5KSA6IHVuZGVmaW5lZCxcclxuICAgICAgc2lnbmFsOiBjb250cm9sbGVyLnNpZ25hbCxcclxuICAgIH0pO1xyXG5cclxuICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xyXG4gICAgLy8gI3JlZ2lvbiBhZ2VudCBsb2dcclxuICAgIGZldGNoKCdodHRwOi8vMTI3LjAuMC4xOjcyNTEvaW5nZXN0LzFkMjhiODVlLTRlODAtNGNkNi04NGJjLTBhMTRmM2JhNmNlYycse21ldGhvZDonUE9TVCcsaGVhZGVyczp7J0NvbnRlbnQtVHlwZSc6J2FwcGxpY2F0aW9uL2pzb24nfSxib2R5OkpTT04uc3RyaW5naWZ5KHtsb2NhdGlvbjonY2xpZW50LmpzOjU4JyxtZXNzYWdlOidhcGlfY2xpZW50X3Jlc3BvbnNlJyxkYXRhOntzdGF0dXM6cmVzcG9uc2U/LnN0YXR1cyxvazpyZXNwb25zZT8ub2t9LHRpbWVzdGFtcDpEYXRlLm5vdygpLHNlc3Npb25JZDonZGVidWctc2Vzc2lvbicscnVuSWQ6J2xvZ2luLXJlZGlyZWN0JyxoeXBvdGhlc2lzSWQ6J0g5J30pfSkuY2F0Y2goKCk9Pnt9KTtcclxuICAgIC8vICNlbmRyZWdpb24gYWdlbnQgbG9nXHJcblxyXG4gICAgY29uc3QgY29udGVudFR5cGUgPSByZXNwb25zZS5oZWFkZXJzPy5nZXQ/LignY29udGVudC10eXBlJykgfHwgJyc7XHJcbiAgICBjb25zdCBoYXNKc29uID0gY29udGVudFR5cGUuaW5jbHVkZXMoJ2FwcGxpY2F0aW9uL2pzb24nKTtcclxuICAgIFxyXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgICAvLyBQYXJzZSBlcnJvciByZXNwb25zZSBib2R5XHJcbiAgICAgIGxldCBlcnJvckRhdGEgPSBudWxsO1xyXG4gICAgICBpZiAoaGFzSnNvbikge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgLy8gSWYgSlNPTiBwYXJzaW5nIGZhaWxzLCBjb250aW51ZSB3aXRoIG51bGxcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGVycm9yID0ge1xyXG4gICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxyXG4gICAgICAgIHN0YXR1c1RleHQ6IHJlc3BvbnNlLnN0YXR1c1RleHQsXHJcbiAgICAgICAgbWVzc2FnZTogZXJyb3JEYXRhPy5tZXNzYWdlIHx8IGBBUEkgcmVxdWVzdCBmYWlsZWQ6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gLFxyXG4gICAgICAgIGVycm9yczogZXJyb3JEYXRhPy5lcnJvcnMgfHwgW10sXHJcbiAgICAgIH07XHJcbiAgICAgIHRocm93IGF3YWl0IGhhbmRsZUF1dGhFcnJvcihlcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZGF0YSA9IGhhc0pzb24gPyBhd2FpdCByZXNwb25zZS5qc29uKCkgOiBudWxsO1xyXG4gICAgcmV0dXJuIHsgZGF0YSwgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMgfTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XHJcbiAgICAvLyAjcmVnaW9uIGFnZW50IGxvZ1xyXG4gICAgZmV0Y2goJ2h0dHA6Ly8xMjcuMC4wLjE6NzI1MS9pbmdlc3QvMWQyOGI4NWUtNGU4MC00Y2Q2LTg0YmMtMGExNGYzYmE2Y2VjJyx7bWV0aG9kOidQT1NUJyxoZWFkZXJzOnsnQ29udGVudC1UeXBlJzonYXBwbGljYXRpb24vanNvbid9LGJvZHk6SlNPTi5zdHJpbmdpZnkoe2xvY2F0aW9uOidjbGllbnQuanM6ODYnLG1lc3NhZ2U6J2FwaV9jbGllbnRfZXJyb3InLGRhdGE6e25hbWU6ZXJyb3I/Lm5hbWUgfHwgbnVsbCxtZXNzYWdlOnR5cGVvZiBlcnJvcj8ubWVzc2FnZSA9PT0gJ3N0cmluZycgPyBlcnJvci5tZXNzYWdlLnNsaWNlKDAsMTIwKSA6IG51bGx9LHRpbWVzdGFtcDpEYXRlLm5vdygpLHNlc3Npb25JZDonZGVidWctc2Vzc2lvbicscnVuSWQ6J2xvZ2luLXJlZGlyZWN0JyxoeXBvdGhlc2lzSWQ6J0g4J30pfSkuY2F0Y2goKCk9Pnt9KTtcclxuICAgIC8vICNlbmRyZWdpb24gYWdlbnQgbG9nXHJcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0Fib3J0RXJyb3InKSB7XHJcbiAgICAgIHRocm93IGhhbmRsZUVycm9yKG5ldyBFcnJvcignUmVxdWVzdCB0aW1lb3V0JyksIHsgdXJsIH0pO1xyXG4gICAgfVxyXG4gICAgdGhyb3cgYXdhaXQgaGFuZGxlQXV0aEVycm9yKGVycm9yKTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgeyBhcGlDbGllbnQgfTtcclxuXHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBS0EsSUFBQUEsT0FBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsT0FBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsS0FBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsUUFBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksS0FBQSxHQUFBSixPQUFBO0FBQ0EsSUFBQUssYUFBQSxHQUFBTCxPQUFBO0FBRUEsSUFBTU0sb0JBQW9CO0VBQUEsSUFBQUMsSUFBQSxPQUFBQyxrQkFBQSxDQUFBQyxPQUFBLEVBQUcsYUFBWTtJQUN2QyxJQUFJO01BQ0YsSUFBTUMsWUFBWSxTQUFTQyxjQUFZLENBQUNDLE9BQU8sQ0FBQ0Msd0JBQWtCLENBQUM7TUFDbkUsSUFBSSxPQUFPSCxZQUFZLEtBQUssUUFBUSxFQUFFO1FBQ3BDLElBQU1JLEtBQUssR0FBR0osWUFBWSxDQUFDSyxJQUFJLENBQUMsQ0FBQztRQUNqQyxJQUFJRCxLQUFLLEVBQUUsT0FBT0EsS0FBSztNQUN6QjtN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