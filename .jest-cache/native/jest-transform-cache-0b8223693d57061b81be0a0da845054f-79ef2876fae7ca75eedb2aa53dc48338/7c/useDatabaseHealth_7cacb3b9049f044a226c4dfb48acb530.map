{"version":3,"names":["_react","require","_config","_useNetwork2","_interopRequireDefault","HEALTH_POLL_MS","useDatabaseHealth","_useNetwork","useNetwork","isOffline","_useState","useState","_useState2","_slicedToArray2","default","isConnected","setIsConnected","check","useCallback","_asyncToGenerator2","fetch","url","endpoints","HEALTH","_res$headers$get","res","method","signal","AbortSignal","timeout","ok","data","headers","get","includes","json","dbOk","database","_unused","useEffect","id","setInterval","clearInterval","_default","exports"],"sources":["useDatabaseHealth.js"],"sourcesContent":["/**\r\n * useDatabaseHealth Hook\r\n * Monitors backend database connectivity via health endpoint.\r\n * File: useDatabaseHealth.js\r\n */\r\nimport { useCallback, useEffect, useState } from 'react';\r\nimport { endpoints } from '@config';\r\nimport useNetwork from './useNetwork';\r\n\r\nconst HEALTH_POLL_MS = 30000;\r\n\r\nconst useDatabaseHealth = () => {\r\n  const { isOffline } = useNetwork();\r\n  const [isConnected, setIsConnected] = useState(true);\r\n\r\n  const check = useCallback(async () => {\r\n    if (typeof fetch === 'undefined') return;\r\n    const url = endpoints.HEALTH;\r\n    try {\r\n      const res = await fetch(url, { method: 'GET', signal: AbortSignal.timeout(5000) });\r\n      const ok = res.ok;\r\n      const data = res.ok && res.headers.get('content-type')?.includes('json') ? await res.json() : {};\r\n      const dbOk = data?.database === 'ok' || data?.database === true || (ok && typeof data.database === 'undefined');\r\n      setIsConnected(ok && (dbOk || typeof data.database === 'undefined'));\r\n    } catch {\r\n      setIsConnected(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (isOffline) {\r\n      setIsConnected(false);\r\n      return;\r\n    }\r\n    check();\r\n    const id = setInterval(check, HEALTH_POLL_MS);\r\n    return () => clearInterval(id);\r\n  }, [isOffline, check]);\r\n\r\n  return { isConnected };\r\n};\r\n\r\nexport default useDatabaseHealth;\r\n"],"mappings":";;;;;;;AAKA,IAAAA,MAAA,GAAAC,OAAA;AACA,IAAAC,OAAA,GAAAD,OAAA;AACA,IAAAE,YAAA,GAAAC,sBAAA,CAAAH,OAAA;AAEA,IAAMI,cAAc,GAAG,KAAK;AAE5B,IAAMC,iBAAiB,GAAG,SAApBA,iBAAiBA,CAAA,EAAS;EAC9B,IAAAC,WAAA,GAAsB,IAAAC,oBAAU,EAAC,CAAC;IAA1BC,SAAS,GAAAF,WAAA,CAATE,SAAS;EACjB,IAAAC,SAAA,GAAsC,IAAAC,eAAQ,EAAC,IAAI,CAAC;IAAAC,UAAA,OAAAC,eAAA,CAAAC,OAAA,EAAAJ,SAAA;IAA7CK,WAAW,GAAAH,UAAA;IAAEI,cAAc,GAAAJ,UAAA;EAElC,IAAMK,KAAK,GAAG,IAAAC,kBAAW,MAAAC,kBAAA,CAAAL,OAAA,EAAC,aAAY;IACpC,IAAI,OAAOM,KAAK,KAAK,WAAW,EAAE;IAClC,IAAMC,GAAG,GAAGC,iBAAS,CAACC,MAAM;IAC5B,IAAI;MAAA,IAAAC,gBAAA;MACF,IAAMC,GAAG,SAASL,KAAK,CAACC,GAAG,EAAE;QAAEK,MAAM,EAAE,KAAK;QAAEC,MAAM,EAAEC,WAAW,CAACC,OAAO,CAAC,IAAI;MAAE,CAAC,CAAC;MAClF,IAAMC,EAAE,GAAGL,GAAG,CAACK,EAAE;MACjB,IAAMC,IAAI,GAAGN,GAAG,CAACK,EAAE,KAAAN,gBAAA,GAAIC,GAAG,CAACO,OAAO,CAACC,GAAG,CAAC,cAAc,CAAC,aAA/BT,gBAAA,CAAiCU,QAAQ,CAAC,MAAM,CAAC,SAAST,GAAG,CAACU,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;MAChG,IAAMC,IAAI,GAAG,CAAAL,IAAI,oBAAJA,IAAI,CAAEM,QAAQ,MAAK,IAAI,IAAI,CAAAN,IAAI,oBAAJA,IAAI,CAAEM,QAAQ,MAAK,IAAI,IAAKP,EAAE,IAAI,OAAOC,IAAI,CAACM,QAAQ,KAAK,WAAY;MAC/GrB,cAAc,CAACc,EAAE,KAAKM,IAAI,IAAI,OAAOL,IAAI,CAACM,QAAQ,KAAK,WAAW,CAAC,CAAC;IACtE,CAAC,CAAC,OAAAC,OAAA,EAAM;MACNtB,cAAc,CAAC,KAAK,CAAC;IACvB;EACF,CAAC,GAAE,EAAE,CAAC;EAEN,IAAAuB,gBAAS,EAAC,YAAM;IACd,IAAI9B,SAAS,EAAE;MACbO,cAAc,CAAC,KAAK,CAAC;MACrB;IACF;IACAC,KAAK,CAAC,CAAC;IACP,IAAMuB,EAAE,GAAGC,WAAW,CAACxB,KAAK,EAAEZ,cAAc,CAAC;IAC7C,OAAO;MAAA,OAAMqC,aAAa,CAACF,EAAE,CAAC;IAAA;EAChC,CAAC,EAAE,CAAC/B,SAAS,EAAEQ,KAAK,CAAC,CAAC;EAEtB,OAAO;IAAEF,WAAW,EAAXA;EAAY,CAAC;AACxB,CAAC;AAAC,IAAA4B,QAAA,GAAAC,OAAA,CAAA9B,OAAA,GAEaR,iBAAiB","ignoreList":[]}