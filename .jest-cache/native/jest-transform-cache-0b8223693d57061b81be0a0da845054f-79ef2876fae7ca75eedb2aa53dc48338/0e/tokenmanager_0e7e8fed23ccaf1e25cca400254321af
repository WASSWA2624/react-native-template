d528134f192f17f04154cd3a4d22ee36
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.setTokens = exports.isTokenExpired = exports.getRefreshToken = exports.getAccessToken = exports.clearTokens = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _storage = require("../services/storage");
var TOKEN_KEYS = {
  ACCESS_TOKEN: 'access_token',
  REFRESH_TOKEN: 'refresh_token'
};
var getAccessToken = exports.getAccessToken = function () {
  var _ref = (0, _asyncToGenerator2.default)(function* () {
    return yield _storage.secure.getItem(TOKEN_KEYS.ACCESS_TOKEN);
  });
  return function getAccessToken() {
    return _ref.apply(this, arguments);
  };
}();
var getRefreshToken = exports.getRefreshToken = function () {
  var _ref2 = (0, _asyncToGenerator2.default)(function* () {
    return yield _storage.secure.getItem(TOKEN_KEYS.REFRESH_TOKEN);
  });
  return function getRefreshToken() {
    return _ref2.apply(this, arguments);
  };
}();
var setTokens = exports.setTokens = function () {
  var _ref3 = (0, _asyncToGenerator2.default)(function* (accessToken, refreshToken) {
    var results = yield Promise.all([_storage.secure.setItem(TOKEN_KEYS.ACCESS_TOKEN, accessToken), _storage.secure.setItem(TOKEN_KEYS.REFRESH_TOKEN, refreshToken)]);
    return results.every(Boolean);
  });
  return function setTokens(_x, _x2) {
    return _ref3.apply(this, arguments);
  };
}();
var clearTokens = exports.clearTokens = function () {
  var _ref4 = (0, _asyncToGenerator2.default)(function* () {
    yield Promise.all([_storage.secure.removeItem(TOKEN_KEYS.ACCESS_TOKEN), _storage.secure.removeItem(TOKEN_KEYS.REFRESH_TOKEN)]);
  });
  return function clearTokens() {
    return _ref4.apply(this, arguments);
  };
}();
var decodeBase64 = function decodeBase64(value) {
  if (typeof value !== 'string') return null;
  var base64 = value.replace(/-/g, '+').replace(/_/g, '/');
  var padding = base64.length % 4 === 0 ? '' : '='.repeat(4 - base64.length % 4);
  var normalized = `${base64}${padding}`;
  if (typeof (globalThis == null ? void 0 : globalThis.atob) === 'function') {
    try {
      return globalThis.atob(normalized);
    } catch (_unused) {
      return null;
    }
  }
  if (typeof Buffer !== 'undefined') {
    return Buffer.from(normalized, 'base64').toString('utf8');
  }
  return null;
};
var getJwtPayload = function getJwtPayload(token) {
  if (typeof token !== 'string') return null;
  var parts = token.split('.');
  if (parts.length < 2) return null;
  var decoded = decodeBase64(parts[1]);
  if (!decoded) return null;
  try {
    return JSON.parse(decoded);
  } catch (_unused2) {
    return null;
  }
};
var isTokenExpired = exports.isTokenExpired = function isTokenExpired(token) {
  if (!token) return true;
  var payload = getJwtPayload(token);
  var expSeconds = payload == null ? void 0 : payload.exp;
  if (typeof expSeconds !== 'number' || !Number.isFinite(expSeconds)) return true;
  var expMs = expSeconds * 1000;
  return Date.now() >= expMs;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc3RvcmFnZSIsInJlcXVpcmUiLCJUT0tFTl9LRVlTIiwiQUNDRVNTX1RPS0VOIiwiUkVGUkVTSF9UT0tFTiIsImdldEFjY2Vzc1Rva2VuIiwiZXhwb3J0cyIsIl9yZWYiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJkZWZhdWx0Iiwic2VjdXJlIiwiZ2V0SXRlbSIsImFwcGx5IiwiYXJndW1lbnRzIiwiZ2V0UmVmcmVzaFRva2VuIiwiX3JlZjIiLCJzZXRUb2tlbnMiLCJfcmVmMyIsImFjY2Vzc1Rva2VuIiwicmVmcmVzaFRva2VuIiwicmVzdWx0cyIsIlByb21pc2UiLCJhbGwiLCJzZXRJdGVtIiwiZXZlcnkiLCJCb29sZWFuIiwiX3giLCJfeDIiLCJjbGVhclRva2VucyIsIl9yZWY0IiwicmVtb3ZlSXRlbSIsImRlY29kZUJhc2U2NCIsInZhbHVlIiwiYmFzZTY0IiwicmVwbGFjZSIsInBhZGRpbmciLCJsZW5ndGgiLCJyZXBlYXQiLCJub3JtYWxpemVkIiwiZ2xvYmFsVGhpcyIsImF0b2IiLCJfdW51c2VkIiwiQnVmZmVyIiwiZnJvbSIsInRvU3RyaW5nIiwiZ2V0Snd0UGF5bG9hZCIsInRva2VuIiwicGFydHMiLCJzcGxpdCIsImRlY29kZWQiLCJKU09OIiwicGFyc2UiLCJfdW51c2VkMiIsImlzVG9rZW5FeHBpcmVkIiwicGF5bG9hZCIsImV4cFNlY29uZHMiLCJleHAiLCJOdW1iZXIiLCJpc0Zpbml0ZSIsImV4cE1zIiwiRGF0ZSIsIm5vdyJdLCJzb3VyY2VzIjpbInRva2VuLm1hbmFnZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFRva2VuIE1hbmFnZXJcclxuICogSGFuZGxlcyBKV1QgdG9rZW4gbGlmZWN5Y2xlXHJcbiAqIEZpbGU6IHRva2VuLm1hbmFnZXIuanNcclxuICovXHJcbmltcG9ydCB7IHNlY3VyZSB9IGZyb20gJ0BzZXJ2aWNlcy9zdG9yYWdlJztcclxuXHJcbmNvbnN0IFRPS0VOX0tFWVMgPSB7XHJcbiAgQUNDRVNTX1RPS0VOOiAnYWNjZXNzX3Rva2VuJyxcclxuICBSRUZSRVNIX1RPS0VOOiAncmVmcmVzaF90b2tlbicsXHJcbn07XHJcblxyXG5jb25zdCBnZXRBY2Nlc3NUb2tlbiA9IGFzeW5jICgpID0+IHtcclxuICByZXR1cm4gYXdhaXQgc2VjdXJlLmdldEl0ZW0oVE9LRU5fS0VZUy5BQ0NFU1NfVE9LRU4pO1xyXG59O1xyXG5cclxuY29uc3QgZ2V0UmVmcmVzaFRva2VuID0gYXN5bmMgKCkgPT4ge1xyXG4gIHJldHVybiBhd2FpdCBzZWN1cmUuZ2V0SXRlbShUT0tFTl9LRVlTLlJFRlJFU0hfVE9LRU4pO1xyXG59O1xyXG5cclxuY29uc3Qgc2V0VG9rZW5zID0gYXN5bmMgKGFjY2Vzc1Rva2VuLCByZWZyZXNoVG9rZW4pID0+IHtcclxuICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xyXG4gICAgc2VjdXJlLnNldEl0ZW0oVE9LRU5fS0VZUy5BQ0NFU1NfVE9LRU4sIGFjY2Vzc1Rva2VuKSxcclxuICAgIHNlY3VyZS5zZXRJdGVtKFRPS0VOX0tFWVMuUkVGUkVTSF9UT0tFTiwgcmVmcmVzaFRva2VuKSxcclxuICBdKTtcclxuICByZXR1cm4gcmVzdWx0cy5ldmVyeShCb29sZWFuKTtcclxufTtcclxuXHJcbmNvbnN0IGNsZWFyVG9rZW5zID0gYXN5bmMgKCkgPT4ge1xyXG4gIGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgIHNlY3VyZS5yZW1vdmVJdGVtKFRPS0VOX0tFWVMuQUNDRVNTX1RPS0VOKSxcclxuICAgIHNlY3VyZS5yZW1vdmVJdGVtKFRPS0VOX0tFWVMuUkVGUkVTSF9UT0tFTiksXHJcbiAgXSk7XHJcbn07XHJcblxyXG5jb25zdCBkZWNvZGVCYXNlNjQgPSAodmFsdWUpID0+IHtcclxuICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykgcmV0dXJuIG51bGw7XHJcblxyXG4gIC8vIGJhc2U2NHVybCAtPiBiYXNlNjRcclxuICBjb25zdCBiYXNlNjQgPSB2YWx1ZS5yZXBsYWNlKC8tL2csICcrJykucmVwbGFjZSgvXy9nLCAnLycpO1xyXG4gIGNvbnN0IHBhZGRpbmcgPSBiYXNlNjQubGVuZ3RoICUgNCA9PT0gMCA/ICcnIDogJz0nLnJlcGVhdCg0IC0gKGJhc2U2NC5sZW5ndGggJSA0KSk7XHJcbiAgY29uc3Qgbm9ybWFsaXplZCA9IGAke2Jhc2U2NH0ke3BhZGRpbmd9YDtcclxuXHJcbiAgaWYgKHR5cGVvZiBnbG9iYWxUaGlzPy5hdG9iID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICByZXR1cm4gZ2xvYmFsVGhpcy5hdG9iKG5vcm1hbGl6ZWQpO1xyXG4gICAgfSBjYXRjaCB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gSmVzdC9Ob2RlIGZhbGxiYWNrXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVuZGVmXHJcbiAgaWYgKHR5cGVvZiBCdWZmZXIgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW5kZWZcclxuICAgIHJldHVybiBCdWZmZXIuZnJvbShub3JtYWxpemVkLCAnYmFzZTY0JykudG9TdHJpbmcoJ3V0ZjgnKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBudWxsO1xyXG59O1xyXG5cclxuY29uc3QgZ2V0Snd0UGF5bG9hZCA9ICh0b2tlbikgPT4ge1xyXG4gIGlmICh0eXBlb2YgdG9rZW4gIT09ICdzdHJpbmcnKSByZXR1cm4gbnVsbDtcclxuICBjb25zdCBwYXJ0cyA9IHRva2VuLnNwbGl0KCcuJyk7XHJcbiAgaWYgKHBhcnRzLmxlbmd0aCA8IDIpIHJldHVybiBudWxsO1xyXG5cclxuICBjb25zdCBkZWNvZGVkID0gZGVjb2RlQmFzZTY0KHBhcnRzWzFdKTtcclxuICBpZiAoIWRlY29kZWQpIHJldHVybiBudWxsO1xyXG5cclxuICB0cnkge1xyXG4gICAgcmV0dXJuIEpTT04ucGFyc2UoZGVjb2RlZCk7XHJcbiAgfSBjYXRjaCB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBpc1Rva2VuRXhwaXJlZCA9ICh0b2tlbikgPT4ge1xyXG4gIGlmICghdG9rZW4pIHJldHVybiB0cnVlO1xyXG5cclxuICBjb25zdCBwYXlsb2FkID0gZ2V0Snd0UGF5bG9hZCh0b2tlbik7XHJcbiAgY29uc3QgZXhwU2Vjb25kcyA9IHBheWxvYWQ/LmV4cDtcclxuICBpZiAodHlwZW9mIGV4cFNlY29uZHMgIT09ICdudW1iZXInIHx8ICFOdW1iZXIuaXNGaW5pdGUoZXhwU2Vjb25kcykpIHJldHVybiB0cnVlO1xyXG5cclxuICBjb25zdCBleHBNcyA9IGV4cFNlY29uZHMgKiAxMDAwO1xyXG4gIHJldHVybiBEYXRlLm5vdygpID49IGV4cE1zO1xyXG59O1xyXG5cclxuZXhwb3J0IHsgZ2V0QWNjZXNzVG9rZW4sIGdldFJlZnJlc2hUb2tlbiwgc2V0VG9rZW5zLCBjbGVhclRva2VucywgaXNUb2tlbkV4cGlyZWQgfTtcclxuXHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBS0EsSUFBQUEsUUFBQSxHQUFBQyxPQUFBO0FBRUEsSUFBTUMsVUFBVSxHQUFHO0VBQ2pCQyxZQUFZLEVBQUUsY0FBYztFQUM1QkMsYUFBYSxFQUFFO0FBQ2pCLENBQUM7QUFFRCxJQUFNQyxjQUFjLEdBQUFDLE9BQUEsQ0FBQUQsY0FBQTtFQUFBLElBQUFFLElBQUEsT0FBQUMsa0JBQUEsQ0FBQUMsT0FBQSxFQUFHLGFBQVk7SUFDakMsYUFBYUMsZUFBTSxDQUFDQyxPQUFPLENBQUNULFVBQVUsQ0FBQ0MsWUFBWSxDQUFDO0VBQ3RELENBQUM7RUFBQSxnQkFGS0UsY0FBY0EsQ0FBQTtJQUFBLE9BQUFFLElBQUEsQ0FBQUssS0FBQSxPQUFBQyxTQUFBO0VBQUE7QUFBQSxHQUVuQjtBQUVELElBQU1DLGVBQWUsR0FBQVIsT0FBQSxDQUFBUSxlQUFBO0VBQUEsSUFBQUMsS0FBQSxPQUFBUCxrQkFBQSxDQUFBQyxPQUFBLEVB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