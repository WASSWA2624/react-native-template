{"version":3,"names":["NetInfo","logger","isOnline","cov_zn52668v2","s","listeners","Set","netInfoUnsubscribe","normalizeIsOnline","state","f","Boolean","isConnected","notify","forEach","listener","_unused","applyState","nextIsOnline","wasOnline","b","info","checkConnectivity","_ref","_asyncToGenerator","fetch","apply","arguments","subscribe","add","delete","startListening","addEventListener","stopListening","getIsOnline","__unsafeResetForTests"],"sources":["network.listener.js"],"sourcesContent":["/**\r\n * Network Listener\r\n * Monitors network connectivity\r\n * File: network.listener.js\r\n */\r\nimport NetInfo from '@react-native-community/netinfo';\r\nimport { logger } from '@logging';\r\n\r\nlet isOnline = true;\r\nlet listeners = new Set();\r\nlet netInfoUnsubscribe = null;\r\n\r\nconst normalizeIsOnline = (state) => Boolean(state?.isConnected);\r\n\r\nconst notify = () => {\r\n  listeners.forEach((listener) => {\r\n    try {\r\n      listener(isOnline);\r\n    } catch {\r\n      // Listener errors must not break the global connectivity observer.\r\n    }\r\n  });\r\n};\r\n\r\nconst applyState = (state) => {\r\n  const nextIsOnline = normalizeIsOnline(state);\r\n  const wasOnline = isOnline;\r\n  isOnline = nextIsOnline;\r\n\r\n  if (wasOnline !== nextIsOnline) {\r\n    logger.info('Network status changed', { isOnline });\r\n    notify();\r\n  }\r\n\r\n  return isOnline;\r\n};\r\n\r\n/**\r\n * Fetch current connectivity from NetInfo and update internal state.\r\n * Notifies subscribers only when the online status changes.\r\n */\r\nexport const checkConnectivity = async () => {\r\n  const state = await NetInfo.fetch();\r\n  return applyState(state);\r\n};\r\n\r\n/**\r\n * Subscribe to online-status changes.\r\n * Returns an unsubscribe function.\r\n */\r\nexport const subscribe = (listener) => {\r\n  listeners.add(listener);\r\n  return () => {\r\n    listeners.delete(listener);\r\n  };\r\n};\r\n\r\n/**\r\n * Start listening to NetInfo changes.\r\n * Idempotent: subsequent calls return the same unsubscribe function.\r\n */\r\nexport const startListening = () => {\r\n  if (netInfoUnsubscribe) return netInfoUnsubscribe;\r\n\r\n  netInfoUnsubscribe = NetInfo.addEventListener((state) => {\r\n    applyState(state);\r\n  });\r\n\r\n  return netInfoUnsubscribe;\r\n};\r\n\r\nexport const stopListening = () => {\r\n  if (!netInfoUnsubscribe) return;\r\n  try {\r\n    netInfoUnsubscribe();\r\n  } finally {\r\n    netInfoUnsubscribe = null;\r\n  }\r\n};\r\n\r\nexport const getIsOnline = () => isOnline;\r\n\r\n/**\r\n * Testing-only reset helper to avoid state leaking across unit tests.\r\n * @private\r\n */\r\nexport const __unsafeResetForTests = () => {\r\n  stopListening();\r\n  isOnline = true;\r\n  listeners = new Set();\r\n};\r\n\r\nexport default {\r\n  checkConnectivity,\r\n  subscribe,\r\n  startListening,\r\n  stopListening,\r\n  getIsOnline,\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]}