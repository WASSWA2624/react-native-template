ef3e4b052c284ccccb0bd3d4750d464c
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.initOffline = initOffline;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _offline = require("../offline");
var _logging = require("../logging");
var _store = _interopRequireDefault(require("../store"));
var _network = require("../store/slices/network.slice");
var _networkQuality = require("../utils/networkQuality");
function initOffline() {
  return _initOffline.apply(this, arguments);
}
function _initOffline() {
  _initOffline = (0, _asyncToGenerator2.default)(function* () {
    try {
      var _currentStatus$qualit;
      _offline.networkListener.startListening();
      _offline.networkListener.subscribe(function (snapshot) {
        var _snapshot$quality;
        var isOnline = Boolean(snapshot == null ? void 0 : snapshot.isOnline);
        var quality = (_snapshot$quality = snapshot == null ? void 0 : snapshot.quality) != null ? _snapshot$quality : _networkQuality.NETWORK_QUALITY.UNKNOWN;
        _store.default.dispatch(_network.actions.setOnline(isOnline));
        _store.default.dispatch(_network.actions.setQuality(quality));
      });
      var currentStatus = yield _offline.networkListener.checkConnectivity();
      var isOnline = Boolean(currentStatus == null ? void 0 : currentStatus.isOnline);
      var quality = (_currentStatus$qualit = currentStatus == null ? void 0 : currentStatus.quality) != null ? _currentStatus$qualit : _networkQuality.NETWORK_QUALITY.UNKNOWN;
      _store.default.dispatch(_network.actions.setOnline(isOnline));
      _store.default.dispatch(_network.actions.setQuality(quality));
      yield _offline.hydration.hydrate();
      _offline.syncManager.startSync();
      _logging.logger.info('Offline system initialized successfully');
    } catch (error) {
      _logging.logger.error('Offline initialization failed', {
        error: error.message
      });
    }
  });
  return _initOffline.apply(this, arguments);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfb2ZmbGluZSIsInJlcXVpcmUiLCJfbG9nZ2luZyIsIl9zdG9yZSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfbmV0d29yayIsIl9uZXR3b3JrUXVhbGl0eSIsImluaXRPZmZsaW5lIiwiX2luaXRPZmZsaW5lIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJkZWZhdWx0IiwiX2N1cnJlbnRTdGF0dXMkcXVhbGl0IiwibmV0d29ya0xpc3RlbmVyIiwic3RhcnRMaXN0ZW5pbmciLCJzdWJzY3JpYmUiLCJzbmFwc2hvdCIsIl9zbmFwc2hvdCRxdWFsaXR5IiwiaXNPbmxpbmUiLCJCb29sZWFuIiwicXVhbGl0eSIsIk5FVFdPUktfUVVBTElUWSIsIlVOS05PV04iLCJzdG9yZSIsImRpc3BhdGNoIiwiYWN0aW9ucyIsInNldE9ubGluZSIsInNldFF1YWxpdHkiLCJjdXJyZW50U3RhdHVzIiwiY2hlY2tDb25uZWN0aXZpdHkiLCJoeWRyYXRpb24iLCJoeWRyYXRlIiwic3luY01hbmFnZXIiLCJzdGFydFN5bmMiLCJsb2dnZXIiLCJpbmZvIiwiZXJyb3IiLCJtZXNzYWdlIl0sInNvdXJjZXMiOlsiaW5pdC5vZmZsaW5lLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBPZmZsaW5lIEluaXRpYWxpemF0aW9uXHJcbiAqIEZpbGU6IGluaXQub2ZmbGluZS5qc1xyXG4gKi9cclxuaW1wb3J0IHsgbmV0d29ya0xpc3RlbmVyLCBzeW5jTWFuYWdlciwgaHlkcmF0aW9uIH0gZnJvbSAnQG9mZmxpbmUnO1xyXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAbG9nZ2luZyc7XHJcbmltcG9ydCBzdG9yZSBmcm9tICdAc3RvcmUnO1xyXG5pbXBvcnQgeyBhY3Rpb25zIH0gZnJvbSAnQHN0b3JlL3NsaWNlcy9uZXR3b3JrLnNsaWNlJztcclxuaW1wb3J0IHsgTkVUV09SS19RVUFMSVRZIH0gZnJvbSAnQHV0aWxzL25ldHdvcmtRdWFsaXR5JztcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpbml0T2ZmbGluZSgpIHtcclxuICB0cnkge1xyXG4gICAgLy8gUmVnaXN0ZXIgbmV0d29yayBsaXN0ZW5lcnNcclxuICAgIG5ldHdvcmtMaXN0ZW5lci5zdGFydExpc3RlbmluZygpO1xyXG4gICAgXHJcbiAgICAvLyBTdWJzY3JpYmUgdG8gbmV0d29yayBjaGFuZ2VzIGFuZCB1cGRhdGUgUmVkdXggc3RvcmVcclxuICAgIG5ldHdvcmtMaXN0ZW5lci5zdWJzY3JpYmUoKHNuYXBzaG90KSA9PiB7XHJcbiAgICAgIGNvbnN0IGlzT25saW5lID0gQm9vbGVhbihzbmFwc2hvdD8uaXNPbmxpbmUpO1xyXG4gICAgICBjb25zdCBxdWFsaXR5ID0gc25hcHNob3Q/LnF1YWxpdHkgPz8gTkVUV09SS19RVUFMSVRZLlVOS05PV047XHJcbiAgICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnMuc2V0T25saW5lKGlzT25saW5lKSk7XHJcbiAgICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnMuc2V0UXVhbGl0eShxdWFsaXR5KSk7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgLy8gSW5pdGlhbGl6ZSBjdXJyZW50IG5ldHdvcmsgc3RhdHVzIGluIHN0b3JlXHJcbiAgICBjb25zdCBjdXJyZW50U3RhdHVzID0gYXdhaXQgbmV0d29ya0xpc3RlbmVyLmNoZWNrQ29ubmVjdGl2aXR5KCk7XHJcbiAgICBjb25zdCBpc09ubGluZSA9IEJvb2xlYW4oY3VycmVudFN0YXR1cz8uaXNPbmxpbmUpO1xyXG4gICAgY29uc3QgcXVhbGl0eSA9IGN1cnJlbnRTdGF0dXM/LnF1YWxpdHkgPz8gTkVUV09SS19RVUFMSVRZLlVOS05PV047XHJcbiAgICBzdG9yZS5kaXNwYXRjaChhY3Rpb25zLnNldE9ubGluZShpc09ubGluZSkpO1xyXG4gICAgc3RvcmUuZGlzcGF0Y2goYWN0aW9ucy5zZXRRdWFsaXR5KHF1YWxpdHkpKTtcclxuICAgIFxyXG4gICAgLy8gSW5pdGlhbGl6ZSByZXF1ZXN0IHF1ZXVlXHJcbiAgICAvLyBRdWV1ZSBpcyBpbml0aWFsaXplZCBsYXppbHkgd2hlbiBmaXJzdCByZXF1ZXN0IGlzIHF1ZXVlZFxyXG4gICAgXHJcbiAgICAvLyBUcmlnZ2VyIHN0YXRlIGh5ZHJhdGlvblxyXG4gICAgYXdhaXQgaHlkcmF0aW9uLmh5ZHJhdGUoKTtcclxuICAgIFxyXG4gICAgLy8gU3RhcnQgc3luYyBtYW5hZ2VyICh3aWxsIHN5bmMgd2hlbiBvbmxpbmUpXHJcbiAgICBzeW5jTWFuYWdlci5zdGFydFN5bmMoKTtcclxuICAgIFxyXG4gICAgbG9nZ2VyLmluZm8oJ09mZmxpbmUgc3lzdGVtIGluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseScpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBsb2dnZXIuZXJyb3IoJ09mZmxpbmUgaW5pdGlhbGl6YXRpb24gZmFpbGVkJywgeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcclxuICAgIC8vIE9mZmxpbmUgZmFpbHVyZSBpcyBub3QgZmF0YWwgLSBhcHAgY2FuIGNvbnRpbnVlIHdpdGhvdXQgb2ZmbGluZSBzdXBwb3J0XHJcbiAgfVxyXG59XHJcblxyXG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUlBLElBQUFBLFFBQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLFFBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLE1BQUEsR0FBQUMsc0JBQUEsQ0FBQUgsT0FBQTtBQUNBLElBQUFJLFFBQUEsR0FBQUosT0FBQTtBQUNBLElBQUFLLGVBQUEsR0FBQUwsT0FBQTtBQUF3RCxTQUVsQ00sV0FBV0EsQ0FBQTtFQUFBLE9BQUFDLFlBQUEsQ0FBQUMsS0FBQSxPQUFBQyxTQUFBO0FBQUE7QUFBQSxTQUFBRixhQUFBO0VBQUFBLFlBQUEsT0FBQUcsa0JBQUEsQ0FBQUMsT0FBQSxFQUExQixhQUE2QjtJQUNsQyxJQUFJO01BQUEsSUFBQUMscUJBQUE7TUFFRkMsd0JBQWUsQ0FBQ0MsY0FBYyxDQUFDLENBQUM7TUFHaENELHdCQUFlLENBQUNFLFNBQVMsQ0FBQyxVQUFDQyxRQUFRLEVBQUs7UUFBQSxJQUFBQyxpQkFBQTtRQUN0QyxJQUFNQyxRQUFRLEdBQUdDLE9BQU8sQ0FBQ0gsUUFBUSxvQkFBUkEsUUFBUSxDQUFFRSxRQUFRLENBQUM7UUFDNUMsSUFBTUUsT0FBTyxJQUFBSCxpQkFBQSxHQUFHRCxRQUFRLG9CQUFSQSxRQUFRLENBQUVJLE9BQU8sWUFBQUgsaUJBQUEsR0FBSUksK0JBQWUsQ0FBQ0MsT0FBTztRQUM1REMsY0FBSyxDQUFDQyxRQUFRLENBQUNDLGdCQUFPLENBQUNDLFNBQVMsQ0FBQ1IsUUFBUSxDQUFDLENBQUM7UUFDM0NLLGNBQUssQ0FBQ0MsUUFBUSxDQUFDQyxnQkFBTyxDQUFDRSxVQUFVLENBQUNQLE9BQU8sQ0FBQyxDQUFDO01BQzdDLENBQUMsQ0FBQztNQUdGLElBQU1RLGFBQWEsU0FBU2Ysd0JBQWUsQ0FBQ2dCLGlCQUFpQixDQUFDLENBQUM7TUFDL0QsSUFBTVgsUUFBUSxHQUFHQyxPQUFPLENBQUNTLGFBQWEsb0JBQWJBLGFBQWEsQ0FBRVYsUUFBUSxDQUFDO01BQ2pELElBQU1FLE9BQU8sSUFBQVIscUJBQUEsR0FBR2dCLGFBQWEsb0JBQWJBLGFBQWEsQ0FBRVIsT0FBTyxZQUFBUixxQkFBQSxHQUFJUywrQkFBZSxDQUFDQyxPQUFPO01BQ2pFQyxjQUFLLENBQUNDLFFBQVEsQ0FBQ0MsZ0JBQU8sQ0FBQ0MsU0FBUyxDQUFDUixRQUFRLENBQUMsQ0FBQztNQUMzQ0ssY0FBSyxDQUFDQyxRQUFRLENBQUNDLGdCQUFPLENBQUNFLFVBQVUsQ0FBQ1AsT0FBTyxDQUFDLENBQUM7TUFNM0MsTUFBTVUsa0JBQVMsQ0FBQ0MsT0FBTyxDQUFDLENBQUM7TUFHekJDLG9CQUFXLENBQUNDLFNBQVMsQ0FBQyxDQUFDO01BRXZCQyxlQUFNLENBQUNDLElBQUksQ0FBQyx5Q0FBeUMsQ0FBQztJQUN4RCxDQUFDLENBQUMsT0FBT0MsS0FBSyxFQUFFO01BQ2RGLGVBQU0sQ0FBQ0UsS0FBSyxDQUFDLCtCQUErQixFQUFFO1FBQUVBLEtBQUssRUFBRUEsS0FBSyxDQUFDQztNQUFRLENBQUMsQ0FBQztJQUV6RTtFQUNGLENBQUM7RUFBQSxPQUFBOUIsWUFBQSxDQUFBQyxLQUFBLE9BQUFDLFNBQUE7QUFBQSIsImlnbm9yZUxpc3QiOltdfQ==