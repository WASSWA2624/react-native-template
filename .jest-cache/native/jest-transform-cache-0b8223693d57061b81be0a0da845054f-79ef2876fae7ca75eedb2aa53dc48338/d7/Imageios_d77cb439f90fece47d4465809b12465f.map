{"version":3,"names":["_RootTag","require","_flattenStyle","_interopRequireDefault","_StyleSheet","_ImageAnalyticsTagContext","_ImageInjection","_ImageSourceUtils","_ImageUtils","_ImageViewNativeComponent","_NativeImageLoaderIOS","_resolveAssetSource","React","_interopRequireWildcard","_jsxRuntime","_excluded","_excluded2","getSize","uri","success","failure","promise","NativeImageLoaderIOS","then","_ref","_ref2","_slicedToArray2","default","width","height","sizes","catch","console","warn","getSizeWithHeaders","headers","prefetchWithMetadata","url","queryRootName","rootTag","prefetchImageWithMetadata","createRootTag","prefetchImage","prefetch","queryCache","_x","_queryCache","apply","arguments","_asyncToGenerator2","urls","BaseImage","_ref3","_props$tintColor","_props$accessibilityS","_props$accessibilityS2","_props$accessibilityS3","_props$accessibilityS4","_props$accessibilityS5","_props$ariaLabel","forwardedRef","ref","props","_objectWithoutProperties2","source","getImageSourcesFromImageProps","undefined","style","sources","Array","isArray","styles","base","_source$width","_source$height","flattenedStyle","flattenStyle","objectFit","convertObjectFitToResizeMode","resizeMode","tintColor","children","Error","ariaBusy","ariaChecked","ariaDisabled","ariaExpanded","ariaSelected","src","restProps","_accessibilityState","busy","accessibilityState","checked","disabled","expanded","selected","accessibilityLabel","actualRef","useWrapRefWithImageAttachedCallbacks","jsx","Consumer","analyticTag","Object","assign","accessible","alt","internal_analyticTag","imageComponentDecorator","unstable_getImageComponentDecorator","Image","displayName","resolveAssetSource","StyleSheet","create","overflow","_default","exports"],"sources":["Image.ios.js"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict-local\n * @format\n */\n\nimport type {HostInstance} from '../../src/private/types/HostInstance';\nimport type {ImageStyleProp} from '../StyleSheet/StyleSheet';\nimport type {RootTag} from '../Types/RootTagTypes';\nimport type {ImageProps} from './ImageProps';\nimport type {AbstractImageIOS, ImageIOS} from './ImageTypes.flow';\nimport type {ImageSize} from './NativeImageLoaderAndroid';\n\nimport {createRootTag} from '../ReactNative/RootTag';\nimport flattenStyle from '../StyleSheet/flattenStyle';\nimport StyleSheet from '../StyleSheet/StyleSheet';\nimport ImageAnalyticsTagContext from './ImageAnalyticsTagContext';\nimport {\n  unstable_getImageComponentDecorator,\n  useWrapRefWithImageAttachedCallbacks,\n} from './ImageInjection';\nimport {getImageSourcesFromImageProps} from './ImageSourceUtils';\nimport {convertObjectFitToResizeMode} from './ImageUtils';\nimport ImageViewNativeComponent from './ImageViewNativeComponent';\nimport NativeImageLoaderIOS from './NativeImageLoaderIOS';\nimport resolveAssetSource from './resolveAssetSource';\nimport * as React from 'react';\n\nfunction getSize(\n  uri: string,\n  success?: (width: number, height: number) => void,\n  failure?: (error: mixed) => void,\n): void | Promise<ImageSize> {\n  const promise = NativeImageLoaderIOS.getSize(uri).then(([width, height]) => ({\n    width,\n    height,\n  }));\n  if (typeof success !== 'function') {\n    return promise;\n  }\n  promise\n    .then(sizes => success(sizes.width, sizes.height))\n    .catch(\n      failure ||\n        function () {\n          console.warn('Failed to get size for image: ' + uri);\n        },\n    );\n}\n\nfunction getSizeWithHeaders(\n  uri: string,\n  headers: {[string]: string, ...},\n  success?: (width: number, height: number) => void,\n  failure?: (error: mixed) => void,\n): void | Promise<ImageSize> {\n  const promise = NativeImageLoaderIOS.getSizeWithHeaders(uri, headers);\n  if (typeof success !== 'function') {\n    return promise;\n  }\n  promise\n    .then(sizes => success(sizes.width, sizes.height))\n    .catch(\n      failure ||\n        function () {\n          console.warn('Failed to get size for image: ' + uri);\n        },\n    );\n}\n\nfunction prefetchWithMetadata(\n  url: string,\n  queryRootName: string,\n  rootTag?: ?RootTag,\n): Promise<boolean> {\n  if (NativeImageLoaderIOS.prefetchImageWithMetadata) {\n    // number params like rootTag cannot be nullable before TurboModules is available\n    return NativeImageLoaderIOS.prefetchImageWithMetadata(\n      url,\n      queryRootName,\n      // NOTE: RootTag type\n      rootTag != null ? rootTag : createRootTag(0),\n    );\n  } else {\n    return NativeImageLoaderIOS.prefetchImage(url);\n  }\n}\n\nfunction prefetch(url: string): Promise<boolean> {\n  return NativeImageLoaderIOS.prefetchImage(url);\n}\n\nasync function queryCache(\n  urls: Array<string>,\n): Promise<{[string]: 'memory' | 'disk' | 'disk/memory', ...}> {\n  return NativeImageLoaderIOS.queryCache(urls);\n}\n\n/**\n * A React component for displaying different types of images,\n * including network images, static resources, temporary local images, and\n * images from local disk, such as the camera roll.\n *\n * See https://reactnative.dev/docs/image\n */\nlet BaseImage: AbstractImageIOS = ({\n  ref: forwardedRef,\n  ...props\n}: {\n  ref?: React.RefSetter<HostInstance>,\n  ...ImageProps,\n}) => {\n  const source = getImageSourcesFromImageProps(props) || {\n    uri: undefined,\n    width: undefined,\n    height: undefined,\n  };\n\n  let style: ImageStyleProp;\n  let sources;\n  if (Array.isArray(source)) {\n    style = [styles.base, props.style];\n    sources = source;\n  } else {\n    const {uri} = source;\n    if (uri === '') {\n      console.warn('source.uri should not be an empty string');\n    }\n    const width = source.width ?? props.width;\n    const height = source.height ?? props.height;\n    style = [{width, height}, styles.base, props.style];\n    sources = [source];\n  }\n\n  const flattenedStyle = flattenStyle<ImageStyleProp>(style);\n  const objectFit = convertObjectFitToResizeMode(flattenedStyle?.objectFit);\n  const resizeMode =\n    objectFit || props.resizeMode || flattenedStyle?.resizeMode || 'cover';\n  const tintColor = props.tintColor ?? flattenedStyle?.tintColor;\n\n  if (props.children != null) {\n    throw new Error(\n      'The <Image> component cannot contain children. If you want to render content on top of the image, consider using the <ImageBackground> component or absolute positioning.',\n    );\n  }\n  const {\n    'aria-busy': ariaBusy,\n    'aria-checked': ariaChecked,\n    'aria-disabled': ariaDisabled,\n    'aria-expanded': ariaExpanded,\n    'aria-selected': ariaSelected,\n    src,\n    ...restProps\n  } = props;\n\n  const _accessibilityState = {\n    busy: ariaBusy ?? props.accessibilityState?.busy,\n    checked: ariaChecked ?? props.accessibilityState?.checked,\n    disabled: ariaDisabled ?? props.accessibilityState?.disabled,\n    expanded: ariaExpanded ?? props.accessibilityState?.expanded,\n    selected: ariaSelected ?? props.accessibilityState?.selected,\n  };\n  const accessibilityLabel = props['aria-label'] ?? props.accessibilityLabel;\n\n  const actualRef = useWrapRefWithImageAttachedCallbacks(forwardedRef);\n\n  return (\n    <ImageAnalyticsTagContext.Consumer>\n      {analyticTag => {\n        return (\n          <ImageViewNativeComponent\n            accessibilityState={_accessibilityState}\n            {...restProps}\n            accessible={props.alt !== undefined ? true : props.accessible}\n            accessibilityLabel={accessibilityLabel ?? props.alt}\n            ref={actualRef}\n            style={style}\n            resizeMode={resizeMode}\n            tintColor={tintColor}\n            source={sources}\n            internal_analyticTag={analyticTag}\n          />\n        );\n      }}\n    </ImageAnalyticsTagContext.Consumer>\n  );\n};\n\nconst imageComponentDecorator = unstable_getImageComponentDecorator();\nif (imageComponentDecorator != null) {\n  BaseImage = imageComponentDecorator(BaseImage);\n}\n\n// $FlowExpectedError[incompatible-type] Eventually we need to move these functions from statics of the component to exports in the module.\nconst Image: ImageIOS = BaseImage;\n\nImage.displayName = 'Image';\n\n/**\n * Retrieve the width and height (in pixels) of an image prior to displaying it.\n *\n * See https://reactnative.dev/docs/image#getsize\n */\n// $FlowFixMe[incompatible-use] This property isn't writable but we're actually defining it here for the first time.\nImage.getSize = getSize;\n\n/**\n * Retrieve the width and height (in pixels) of an image prior to displaying it\n * with the ability to provide the headers for the request.\n *\n * See https://reactnative.dev/docs/image#getsizewithheaders\n */\n// $FlowFixMe[incompatible-use] This property isn't writable but we're actually defining it here for the first time.\nImage.getSizeWithHeaders = getSizeWithHeaders;\n\n/**\n * Prefetches a remote image for later use by downloading it to the disk\n * cache.\n *\n * See https://reactnative.dev/docs/image#prefetch\n */\n// $FlowFixMe[incompatible-use] This property isn't writable but we're actually defining it here for the first time.\nImage.prefetch = prefetch;\n\n/**\n * Prefetches a remote image for later use by downloading it to the disk\n * cache, and adds metadata for queryRootName and rootTag.\n *\n * See https://reactnative.dev/docs/image#prefetch\n */\n// $FlowFixMe[incompatible-use] This property isn't writable but we're actually defining it here for the first time.\nImage.prefetchWithMetadata = prefetchWithMetadata;\n\n/**\n * Performs cache interrogation.\n *\n *  See https://reactnative.dev/docs/image#querycache\n */\n// $FlowFixMe[incompatible-use] This property isn't writable but we're actually defining it here for the first time.\nImage.queryCache = queryCache;\n\n/**\n * Resolves an asset reference into an object.\n *\n * See https://reactnative.dev/docs/image#resolveassetsource\n */\n// $FlowFixMe[incompatible-use] This property isn't writable but we're actually defining it here for the first time.\nImage.resolveAssetSource = resolveAssetSource;\n\nconst styles = StyleSheet.create({\n  base: {\n    overflow: 'hidden',\n  },\n});\n\nexport default Image;\n"],"mappings":"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","ignoreList":[]}