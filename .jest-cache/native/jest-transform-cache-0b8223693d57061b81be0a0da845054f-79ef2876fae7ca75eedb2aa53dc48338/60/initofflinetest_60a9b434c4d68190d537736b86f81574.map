{"version":3,"names":["_getJestObj","mock","networkListener","startListening","jest","fn","subscribe","checkConnectivity","syncManager","startSync","hydration","hydrate","dispatch","actions","setOnline","isOnline","type","payload","setQuality","quality","logger","info","error","debug","warn","_interopRequireDefault","require","default","_asyncToGenerator2","_init","_offline","_store","_network","_logging","_networkQuality","_require","describe","beforeEach","clearAllMocks","mockResolvedValue","NETWORK_QUALITY","GOOD","queue","it","initOffline","expect","toHaveBeenCalledTimes","networkChangeCallback","mockImplementation","callback","toHaveBeenCalledWith","any","Function","UNKNOWN","store","mockQueue","id","url","Error","resolves","not","toThrow","mockReturnValue","undefined","mockRejectedValue"],"sources":["init.offline.test.js"],"sourcesContent":["/**\r\n * Offline Initialization Tests\r\n * File: init.offline.test.js\r\n */\r\nimport { initOffline } from '@bootstrap/init.offline';\r\nimport { networkListener, syncManager, hydration } from '@offline';\r\nimport store from '@store';\r\nimport { actions } from '@store/slices/network.slice';\r\nimport { logger } from '@logging';\r\nimport { NETWORK_QUALITY } from '@utils/networkQuality';\r\n\r\njest.mock('@offline', () => ({\r\n  networkListener: {\r\n    startListening: jest.fn(),\r\n    subscribe: jest.fn(),\r\n    checkConnectivity: jest.fn(),\r\n  },\r\n  syncManager: {\r\n    startSync: jest.fn(),\r\n  },\r\n  hydration: {\r\n    hydrate: jest.fn(),\r\n  },\r\n}));\r\n\r\njest.mock('@store', () => ({\r\n  dispatch: jest.fn(),\r\n}));\r\n\r\njest.mock('@store/slices/network.slice', () => ({\r\n  actions: {\r\n    setOnline: jest.fn((isOnline) => ({ type: 'network/setOnline', payload: isOnline })),\r\n    setQuality: jest.fn((quality) => ({ type: 'network/setQuality', payload: quality })),\r\n  },\r\n}));\r\n\r\njest.mock('@logging', () => ({\r\n  logger: {\r\n    info: jest.fn(),\r\n    error: jest.fn(),\r\n    debug: jest.fn(),\r\n    warn: jest.fn(),\r\n  },\r\n}));\r\n\r\ndescribe('Offline Initialization', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    networkListener.checkConnectivity.mockResolvedValue({\r\n      isOnline: true,\r\n      quality: NETWORK_QUALITY.GOOD,\r\n    });\r\n    hydration.hydrate.mockResolvedValue({ queue: [] });\r\n  });\r\n\r\n  it('initializes network listener and sync manager', async () => {\r\n    await initOffline();\r\n\r\n    expect(networkListener.startListening).toHaveBeenCalledTimes(1);\r\n    expect(syncManager.startSync).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('subscribes to network changes and updates Redux store', async () => {\r\n    let networkChangeCallback;\r\n    networkListener.subscribe.mockImplementation((callback) => {\r\n      networkChangeCallback = callback;\r\n      return jest.fn(); // unsubscribe function\r\n    });\r\n\r\n    await initOffline();\r\n\r\n    expect(networkListener.subscribe).toHaveBeenCalledTimes(1);\r\n    expect(networkListener.subscribe).toHaveBeenCalledWith(expect.any(Function));\r\n\r\n    // Simulate network status change\r\n    networkChangeCallback({ isOnline: false, quality: NETWORK_QUALITY.UNKNOWN });\r\n    expect(store.dispatch).toHaveBeenCalledWith(actions.setOnline(false));\r\n    expect(store.dispatch).toHaveBeenCalledWith(actions.setQuality(NETWORK_QUALITY.UNKNOWN));\r\n\r\n    networkChangeCallback({ isOnline: true, quality: NETWORK_QUALITY.GOOD });\r\n    expect(store.dispatch).toHaveBeenCalledWith(actions.setOnline(true));\r\n    expect(store.dispatch).toHaveBeenCalledWith(actions.setQuality(NETWORK_QUALITY.GOOD));\r\n  });\r\n\r\n  it('initializes current network status in Redux store', async () => {\r\n    networkListener.checkConnectivity.mockResolvedValue({\r\n      isOnline: true,\r\n      quality: NETWORK_QUALITY.GOOD,\r\n    });\r\n\r\n    await initOffline();\r\n\r\n    expect(networkListener.checkConnectivity).toHaveBeenCalledTimes(1);\r\n    expect(store.dispatch).toHaveBeenCalledWith(actions.setOnline(true));\r\n    expect(store.dispatch).toHaveBeenCalledWith(actions.setQuality(NETWORK_QUALITY.GOOD));\r\n  });\r\n\r\n  it('initializes network status as offline when connectivity check returns false', async () => {\r\n    networkListener.checkConnectivity.mockResolvedValue({\r\n      isOnline: false,\r\n      quality: NETWORK_QUALITY.UNKNOWN,\r\n    });\r\n\r\n    await initOffline();\r\n\r\n    expect(store.dispatch).toHaveBeenCalledWith(actions.setOnline(false));\r\n    expect(store.dispatch).toHaveBeenCalledWith(actions.setQuality(NETWORK_QUALITY.UNKNOWN));\r\n  });\r\n\r\n  it('triggers state hydration', async () => {\r\n    const mockQueue = [{ id: '1', url: '/api/test' }];\r\n    hydration.hydrate.mockResolvedValue({ queue: mockQueue });\r\n\r\n    await initOffline();\r\n\r\n    expect(hydration.hydrate).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('handles errors gracefully without throwing', async () => {\r\n    const error = new Error('Offline initialization error');\r\n    networkListener.startListening.mockImplementation(() => {\r\n      throw error;\r\n    });\r\n\r\n    await expect(initOffline()).resolves.not.toThrow();\r\n\r\n    expect(logger.error).toHaveBeenCalledWith('Offline initialization failed', {\r\n      error: 'Offline initialization error',\r\n    });\r\n  });\r\n\r\n  it('handles network connectivity check errors gracefully', async () => {\r\n    networkListener.startListening.mockReturnValue(undefined);\r\n    networkListener.subscribe.mockReturnValue(jest.fn());\r\n    networkListener.checkConnectivity.mockRejectedValue(new Error('Connectivity check failed'));\r\n\r\n    await expect(initOffline()).resolves.not.toThrow();\r\n\r\n    expect(logger.error).toHaveBeenCalledWith('Offline initialization failed', {\r\n      error: 'Connectivity check failed',\r\n    });\r\n  });\r\n\r\n  it('handles hydration errors gracefully', async () => {\r\n    networkListener.startListening.mockReturnValue(undefined);\r\n    networkListener.subscribe.mockReturnValue(jest.fn());\r\n    networkListener.checkConnectivity.mockResolvedValue(true);\r\n    hydration.hydrate.mockRejectedValue(new Error('Hydration failed'));\r\n\r\n    await expect(initOffline()).resolves.not.toThrow();\r\n\r\n    expect(logger.error).toHaveBeenCalledWith('Offline initialization failed', {\r\n      error: 'Hydration failed',\r\n    });\r\n  });\r\n\r\n  it('logs success when initialization completes', async () => {\r\n    await initOffline();\r\n\r\n    expect(logger.info).toHaveBeenCalledWith('Offline system initialized successfully');\r\n  });\r\n});\r\n\r\n"],"mappings":"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","ignoreList":[]}