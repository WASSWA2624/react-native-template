{"version":3,"names":["React","useEffect","useMemo","useRef","Slot","usePathname","useRouter","useAuth","useI18n","useShellBanners","useUiState","useAuthGuard","AUTH","AuthFrame","GlobalHeader","LoadingOverlay","NoticeSurface","ShellBanners","ACTION_VARIANTS","GlobalFooter","FOOTER_VARIANTS","jsx","_jsx","cov_giatckpvh","s","AuthLayout","f","router","pathname","_ref","t","_ref2","skipRedirect","authenticated","_ref3","isAuthenticated","logout","roles","_ref4","isLoading","banners","canAccessRegister","_AUTH$REGISTER_ROLES","b","REGISTER_ROLES","length","some","role","includes","hasRedirected","isRegisterRoute","current","replace","bannerSlot","testID","overlaySlot","visible","isLoginRoute","authHeaderActions","id","label","accessibilityLabel","onPress","variant","GHOST","push","PRIMARY","fullWidth","header","title","actions","banner","overlay","notices","footer","children"],"sources":["_layout.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useRef } from 'react';\r\nimport { Slot, usePathname, useRouter } from 'expo-router';\r\nimport { useAuth, useI18n, useShellBanners, useUiState } from '@hooks';\r\nimport { useAuthGuard } from '@navigation/guards';\r\nimport { AUTH } from '@config';\r\nimport { AuthFrame } from '@platform/layouts';\r\nimport { GlobalHeader, LoadingOverlay, NoticeSurface, ShellBanners } from '@platform/components';\r\nimport { ACTION_VARIANTS } from '@platform/components/navigation/GlobalHeader/types';\r\nimport GlobalFooter, { FOOTER_VARIANTS } from '@platform/components/navigation/GlobalFooter';\r\n\r\n/**\r\n * Auth Group Layout\r\n * \r\n * Layout wrapper for authentication routes (login, register, etc.).\r\n * \r\n * Per app-router.mdc:\r\n * - Layouts use `_layout.jsx`, default exports, `<Slot />` for child routes\r\n * - Guard placement: guards in layouts, not screens\r\n * \r\n * This layout redirects authenticated users away from auth routes (e.g., login when already logged in).\r\n * Per Step 7.14: Uses useAuthGuard hook with skipRedirect option to get auth state,\r\n * then handles redirect of authenticated users to home route.\r\n */\r\nconst AuthLayout = () => {\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const { t } = useI18n();\r\n  const { authenticated } = useAuthGuard({ skipRedirect: true });\r\n  const { isAuthenticated, logout, roles } = useAuth();\r\n  const { isLoading } = useUiState();\r\n  const banners = useShellBanners();\r\n\r\n  const canAccessRegister = useMemo(() => {\r\n    if (!isAuthenticated) return false;\r\n    if (!AUTH.REGISTER_ROLES?.length) return false;\r\n    return AUTH.REGISTER_ROLES.some((role) => roles.includes(role));\r\n  }, [isAuthenticated, roles]);\r\n  \r\n  // Use ref to track if redirect has been performed to prevent multiple redirects\r\n  const hasRedirected = useRef(false);\r\n  \r\n  useEffect(() => {\r\n    const isRegisterRoute = pathname === '/register';\r\n    // Redirect authenticated users to home route\r\n    if (authenticated && !hasRedirected.current) {\r\n      if (isRegisterRoute && canAccessRegister) {\r\n        hasRedirected.current = false;\r\n        return;\r\n      }\r\n      hasRedirected.current = true;\r\n      router.replace('/home');\r\n    } else if (!authenticated) {\r\n      // Reset redirect flag when unauthenticated\r\n      hasRedirected.current = false;\r\n    }\r\n  }, [authenticated, canAccessRegister, pathname, router]);\r\n  \r\n  const bannerSlot = banners.length ? <ShellBanners banners={banners} testID=\"auth-shell-banners\" /> : null;\r\n  const overlaySlot = isLoading ? <LoadingOverlay visible testID=\"auth-loading-overlay\" /> : null;\r\n  // Enable full-width mode for login route (uses two-column layout)\r\n  const isLoginRoute = pathname === '/login';\r\n  const authHeaderActions = authenticated || isAuthenticated\r\n    ? [\r\n      {\r\n        id: 'logout',\r\n        label: t('navigation.header.logout'),\r\n        accessibilityLabel: t('navigation.header.logout'),\r\n        onPress: logout,\r\n        variant: ACTION_VARIANTS.GHOST,\r\n      },\r\n    ]\r\n    : [\r\n      {\r\n        id: 'login',\r\n        label: t('auth.login.button'),\r\n        accessibilityLabel: t('auth.login.button'),\r\n        onPress: () => router.push('/login'),\r\n        variant: ACTION_VARIANTS.PRIMARY,\r\n      },\r\n    ];\r\n\r\n  return (\r\n    <AuthFrame\r\n      testID=\"auth-route-layout\"\r\n      fullWidth={isLoginRoute}\r\n      header={(\r\n        <GlobalHeader\r\n          title={t('app.name')}\r\n          accessibilityLabel={t('navigation.header.title')}\r\n          testID=\"auth-header\"\r\n          actions={authHeaderActions}\r\n        />\r\n      )}\r\n      banner={bannerSlot}\r\n      overlay={overlaySlot}\r\n      notices={<NoticeSurface testID=\"auth-notice-surface\" />}\r\n      footer={(\r\n        <GlobalFooter\r\n          variant={FOOTER_VARIANTS.AUTH}\r\n          testID=\"auth-footer\"\r\n        />\r\n      )}\r\n    >\r\n      <Slot />\r\n    </AuthFrame>\r\n  );\r\n};\r\n\r\nexport default AuthLayout;\r\n\r\n"],"mappings":"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","ignoreList":[]}