ac67ecfeb5a1c507a525e0605b55f294
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.areCompositeKeysEqual = areCompositeKeysEqual;
exports.createAnimatedPropsMemoHook = createAnimatedPropsMemoHook;
exports.createCompositeKeyForProps = createCompositeKeyForProps;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _AnimatedEvent = require("../../../Libraries/Animated/AnimatedEvent");
var _AnimatedNode = _interopRequireDefault(require("../../../Libraries/Animated/nodes/AnimatedNode"));
var _AnimatedObject = require("../../../Libraries/Animated/nodes/AnimatedObject");
var _flattenStyle = _interopRequireDefault(require("../../../Libraries/StyleSheet/flattenStyle"));
var ReactNativeFeatureFlags = _interopRequireWildcard(require("../featureflags/ReactNativeFeatureFlags"));
var _nullthrows = _interopRequireDefault(require("nullthrows"));
var _react = require("react");
var _Object$hasOwn;
function createAnimatedPropsMemoHook(allowlist) {
  return function useAnimatedPropsMemo(create, props) {
    var useAnimatedPropsImpl = ReactNativeFeatureFlags.avoidStateUpdateInAnimatedPropsMemo() ? useAnimatedPropsMemo_ref : useAnimatedPropsMemo_state;
    return useAnimatedPropsImpl(create, props);
  };
  function useAnimatedPropsMemo_ref(create, props) {
    var compositeKey = (0, _react.useMemo)(function () {
      return createCompositeKeyForProps(props, allowlist);
    }, [props]);
    var prevRef = (0, _react.useRef)();
    var prev = prevRef.current;
    var next = prev != null && areCompositeKeysEqual(prev.compositeKey, compositeKey) ? prev : {
      compositeKey: compositeKey,
      node: create()
    };
    (0, _react.useInsertionEffect)(function () {
      prevRef.current = next;
    }, [next]);
    return next.node;
  }
  function useAnimatedPropsMemo_state(create, props) {
    var compositeKey = (0, _react.useMemo)(function () {
      return createCompositeKeyForProps(props, allowlist);
    }, [props]);
    var _useState = (0, _react.useState)(function () {
        return {
          allowlist: allowlist,
          compositeKey: compositeKey,
          value: create()
        };
      }),
      _useState2 = (0, _slicedToArray2.default)(_useState, 2),
      state = _useState2[0],
      setState = _useState2[1];
    if (state.allowlist !== allowlist || !areCompositeKeysEqual(state.compositeKey, compositeKey)) {
      setState({
        allowlist: allowlist,
        compositeKey: compositeKey,
        value: create()
      });
    }
    return state.value;
  }
}
function createCompositeKeyForProps(props, allowlist) {
  var compositeKey = null;
  var keys = Object.keys(props);
  for (var ii = 0, length = keys.length; ii < length; ii++) {
    var key = keys[ii];
    var value = props[key];
    if (allowlist == null || hasOwn(allowlist, key)) {
      var compositeKeyComponent = void 0;
      if (key === 'style') {
        var flatStyle = (0, _flattenStyle.default)(value);
        if (flatStyle != null) {
          compositeKeyComponent = createCompositeKeyForObject(flatStyle, allowlist == null ? void 0 : allowlist.style);
        }
      } else if (value instanceof _AnimatedNode.default || value instanceof _AnimatedEvent.AnimatedEvent) {
        compositeKeyComponent = value;
      } else if (Array.isArray(value)) {
        compositeKeyComponent = allowlist == null ? value : createCompositeKeyForArray(value);
      } else if ((0, _AnimatedObject.isPlainObject)(value)) {
        compositeKeyComponent = allowlist == null ? value : createCompositeKeyForObject(value);
      }
      if (compositeKeyComponent != null) {
        if (compositeKey == null) {
          compositeKey = {};
        }
        compositeKey[key] = compositeKeyComponent;
      }
    }
  }
  return compositeKey;
}
function createCompositeKeyForArray(array) {
  var compositeKey = null;
  for (var ii = 0, length = array.length; ii < length; ii++) {
    var value = array[ii];
    var compositeKeyComponent = void 0;
    if (value instanceof _AnimatedNode.default) {
      compositeKeyComponent = value;
    } else if (Array.isArray(value)) {
      compositeKeyComponent = createCompositeKeyForArray(value);
    } else if ((0, _AnimatedObject.isPlainObject)(value)) {
      compositeKeyComponent = createCompositeKeyForObject(value);
    }
    if (compositeKeyComponent != null) {
      if (compositeKey == null) {
        compositeKey = new Array(array.length).fill(null);
      }
      compositeKey[ii] = compositeKeyComponent;
    }
  }
  return compositeKey;
}
function createCompositeKeyForObject(object, allowlist) {
  var compositeKey = null;
  var keys = Object.keys(object);
  for (var ii = 0, length = keys.length; ii < length; ii++) {
    var key = keys[ii];
    if (allowlist == null || hasOwn(allowlist, key)) {
      var value = object[key];
      var compositeKeyComponent = void 0;
      if (value instanceof _AnimatedNode.default) {
        compositeKeyComponent = value;
      } else if (Array.isArray(value)) {
        compositeKeyComponent = createCompositeKeyForArray(value);
      } else if ((0, _AnimatedObject.isPlainObject)(value)) {
        compositeKeyComponent = createCompositeKeyForObject(value);
      }
      if (compositeKeyComponent != null) {
        if (compositeKey == null) {
          compositeKey = {};
        }
        compositeKey[key] = compositeKeyComponent;
      }
    }
  }
  return compositeKey;
}
function areCompositeKeysEqual(maybePrev, maybeNext, allowlist) {
  if (maybePrev === maybeNext) {
    return true;
  }
  if (maybePrev === null || maybeNext === null) {
    return false;
  }
  var prev = maybePrev;
  var next = maybeNext;
  var keys = Object.keys(prev);
  var length = keys.length;
  if (length !== Object.keys(next).length) {
    return false;
  }
  for (var ii = 0; ii < length; ii++) {
    var key = keys[ii];
    if (!hasOwn(next, key)) {
      return false;
    }
    var prevComponent = prev[key];
    var nextComponent = next[key];
    if (key === 'style') {
      if (!areCompositeKeyComponentsEqual(prevComponent, nextComponent)) {
        return false;
      }
    } else if (prevComponent instanceof _AnimatedNode.default || prevComponent instanceof _AnimatedEvent.AnimatedEvent) {
      if (prevComponent !== nextComponent) {
        return false;
      }
    } else {
      if (allowlist == null) {
        if (prevComponent !== nextComponent) {
          return false;
        }
      } else {
        if (!areCompositeKeyComponentsEqual(prevComponent, nextComponent)) {
          return false;
        }
      }
    }
  }
  return true;
}
function areCompositeKeyComponentsEqual(prev, next) {
  if (prev === next) {
    return true;
  }
  if (prev instanceof _AnimatedNode.default) {
    return prev === next;
  }
  if (Array.isArray(prev)) {
    if (!Array.isArray(next)) {
      return false;
    }
    var length = prev.length;
    if (length !== next.length) {
      return false;
    }
    for (var ii = 0; ii < length; ii++) {
      if (!areCompositeKeyComponentsEqual(prev[ii], next[ii])) {
        return false;
      }
    }
    return true;
  }
  if ((0, _AnimatedObject.isPlainObject)(prev)) {
    if (!(0, _AnimatedObject.isPlainObject)(next)) {
      return false;
    }
    var keys = Object.keys(prev);
    var _length = keys.length;
    if (_length !== Object.keys(next).length) {
      return false;
    }
    for (var _ii = 0; _ii < _length; _ii++) {
      var key = keys[_ii];
      if (!hasOwn((0, _nullthrows.default)(next), key) || !areCompositeKeyComponentsEqual(prev[key], next[key])) {
        return false;
      }
    }
    return true;
  }
  return false;
}
var _hasOwnProp = Object.prototype.hasOwnProperty;
var hasOwn = (_Object$hasOwn = Object.hasOwn) != null ? _Object$hasOwn : function (obj, prop) {
  return _hasOwnProp.call(obj, prop);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfQW5pbWF0ZWRFdmVudCIsInJlcXVpcmUiLCJfQW5pbWF0ZWROb2RlIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9BbmltYXRlZE9iamVjdCIsIl9mbGF0dGVuU3R5bGUiLCJSZWFjdE5hdGl2ZUZlYXR1cmVGbGFncyIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiX251bGx0aHJvd3MiLCJfcmVhY3QiLCJfT2JqZWN0JGhhc093biIsImNyZWF0ZUFuaW1hdGVkUHJvcHNNZW1vSG9vayIsImFsbG93bGlzdCIsInVzZUFuaW1hdGVkUHJvcHNNZW1vIiwiY3JlYXRlIiwicHJvcHMiLCJ1c2VBbmltYXRlZFByb3BzSW1wbCIsImF2b2lkU3RhdGVVcGRhdGVJbkFuaW1hdGVkUHJvcHNNZW1vIiwidXNlQW5pbWF0ZWRQcm9wc01lbW9fcmVmIiwidXNlQW5pbWF0ZWRQcm9wc01lbW9fc3RhdGUiLCJjb21wb3NpdGVLZXkiLCJ1c2VNZW1vIiwiY3JlYXRlQ29tcG9zaXRlS2V5Rm9yUHJvcHMiLCJwcmV2UmVmIiwidXNlUmVmIiwicHJldiIsImN1cnJlbnQiLCJuZXh0IiwiYXJlQ29tcG9zaXRlS2V5c0VxdWFsIiwibm9kZSIsInVzZUluc2VydGlvbkVmZmVjdCIsIl91c2VTdGF0ZSIsInVzZVN0YXRlIiwidmFsdWUiLCJfdXNlU3RhdGUyIiwiX3NsaWNlZFRvQXJyYXkyIiwiZGVmYXVsdCIsInN0YXRlIiwic2V0U3RhdGUiLCJrZXlzIiwiT2JqZWN0IiwiaWkiLCJsZW5ndGgiLCJrZXkiLCJoYXNPd24iLCJjb21wb3NpdGVLZXlDb21wb25lbnQiLCJmbGF0U3R5bGUiLCJmbGF0dGVuU3R5bGUiLCJjcmVhdGVDb21wb3NpdGVLZXlGb3JPYmplY3QiLCJzdHlsZSIsIkFuaW1hdGVkTm9kZSIsIkFuaW1hdGVkRXZlbnQiLCJBcnJheSIsImlzQXJyYXkiLCJjcmVhdGVDb21wb3NpdGVLZXlGb3JBcnJheSIsImlzUGxhaW5PYmplY3QiLCJhcnJheSIsImZpbGwiLCJvYmplY3QiLCJtYXliZVByZXYiLCJtYXliZU5leHQiLCJwcmV2Q29tcG9uZW50IiwibmV4dENvbXBvbmVudCIsImFyZUNvbXBvc2l0ZUtleUNvbXBvbmVudHNFcXVhbCIsIm51bGx0aHJvd3MiLCJfaGFzT3duUHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5Iiwib2JqIiwicHJvcCIsImNhbGwiXSwic291cmNlcyI6WyJjcmVhdGVBbmltYXRlZFByb3BzTWVtb0hvb2suanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIE1ldGEgUGxhdGZvcm1zLCBJbmMuIGFuZCBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93IHN0cmljdC1sb2NhbFxuICogQGZvcm1hdFxuICovXG5cbmltcG9ydCB0eXBlIEFuaW1hdGVkUHJvcHMgZnJvbSAnLi4vLi4vLi4vTGlicmFyaWVzL0FuaW1hdGVkL25vZGVzL0FuaW1hdGVkUHJvcHMnO1xuaW1wb3J0IHR5cGUge0FuaW1hdGVkUHJvcHNBbGxvd2xpc3R9IGZyb20gJy4uLy4uLy4uL0xpYnJhcmllcy9BbmltYXRlZC9ub2Rlcy9BbmltYXRlZFByb3BzJztcbmltcG9ydCB0eXBlIHtBbmltYXRlZFN0eWxlQWxsb3dsaXN0fSBmcm9tICcuLi8uLi8uLi9MaWJyYXJpZXMvQW5pbWF0ZWQvbm9kZXMvQW5pbWF0ZWRTdHlsZSc7XG5cbmltcG9ydCB7QW5pbWF0ZWRFdmVudH0gZnJvbSAnLi4vLi4vLi4vTGlicmFyaWVzL0FuaW1hdGVkL0FuaW1hdGVkRXZlbnQnO1xuaW1wb3J0IEFuaW1hdGVkTm9kZSBmcm9tICcuLi8uLi8uLi9MaWJyYXJpZXMvQW5pbWF0ZWQvbm9kZXMvQW5pbWF0ZWROb2RlJztcbmltcG9ydCB7aXNQbGFpbk9iamVjdH0gZnJvbSAnLi4vLi4vLi4vTGlicmFyaWVzL0FuaW1hdGVkL25vZGVzL0FuaW1hdGVkT2JqZWN0JztcbmltcG9ydCBmbGF0dGVuU3R5bGUgZnJvbSAnLi4vLi4vLi4vTGlicmFyaWVzL1N0eWxlU2hlZXQvZmxhdHRlblN0eWxlJztcbmltcG9ydCAqIGFzIFJlYWN0TmF0aXZlRmVhdHVyZUZsYWdzIGZyb20gJy4uL2ZlYXR1cmVmbGFncy9SZWFjdE5hdGl2ZUZlYXR1cmVGbGFncyc7XG5pbXBvcnQgbnVsbHRocm93cyBmcm9tICdudWxsdGhyb3dzJztcbmltcG9ydCB7dXNlSW5zZXJ0aW9uRWZmZWN0LCB1c2VNZW1vLCB1c2VSZWYsIHVzZVN0YXRlfSBmcm9tICdyZWFjdCc7XG5cbnR5cGUgQ29tcG9zaXRlS2V5ID0ge1xuICBzdHlsZT86IHtbc3RyaW5nXTogQ29tcG9zaXRlS2V5Q29tcG9uZW50fSxcbiAgW3N0cmluZ106XG4gICAgfCBDb21wb3NpdGVLZXlDb21wb25lbnRcbiAgICB8IEFuaW1hdGVkRXZlbnRcbiAgICB8ICRSZWFkT25seUFycmF5PG1peGVkPlxuICAgIHwgJFJlYWRPbmx5PHtbc3RyaW5nXTogbWl4ZWR9Pixcbn07XG5cbnR5cGUgQ29tcG9zaXRlS2V5Q29tcG9uZW50ID1cbiAgfCBBbmltYXRlZE5vZGVcbiAgfCAkUmVhZE9ubHlBcnJheTxDb21wb3NpdGVLZXlDb21wb25lbnQgfCBudWxsPlxuICB8ICRSZWFkT25seTx7W3N0cmluZ106IENvbXBvc2l0ZUtleUNvbXBvbmVudH0+O1xuXG50eXBlICRSZWFkT25seUNvbXBvc2l0ZUtleSA9ICRSZWFkT25seTx7XG4gIHN0eWxlPzogJFJlYWRPbmx5PHtbc3RyaW5nXTogQ29tcG9zaXRlS2V5Q29tcG9uZW50fT4sXG4gIFtzdHJpbmddOlxuICAgIHwgJFJlYWRPbmx5Q29tcG9zaXRlS2V5Q29tcG9uZW50XG4gICAgfCBBbmltYXRlZEV2ZW50XG4gICAgfCAkUmVhZE9ubHlBcnJheTxtaXhlZD5cbiAgICB8ICRSZWFkT25seTx7W3N0cmluZ106IG1peGVkfT4sXG59PjtcblxudHlwZSAkUmVhZE9ubHlDb21wb3NpdGVLZXlDb21wb25lbnQgPVxuICB8IEFuaW1hdGVkTm9kZVxuICB8ICRSZWFkT25seUFycmF5PCRSZWFkT25seUNvbXBvc2l0ZUtleUNvbXBvbmVudCB8IG51bGw+XG4gIHwgJFJlYWRPbmx5PHtbc3RyaW5nXTogJFJlYWRPbmx5Q29tcG9zaXRlS2V5Q29tcG9uZW50fT47XG5cbnR5cGUgQW5pbWF0ZWRQcm9wc01lbW9Ib29rID0gKFxuICAoKSA9PiBBbmltYXRlZFByb3BzLFxuICBwcm9wczogJFJlYWRPbmx5PHtbc3RyaW5nXTogbWl4ZWR9PixcbikgPT4gQW5pbWF0ZWRQcm9wcztcblxuLyoqXG4gKiBDcmVhdGVzIGEgaG9vayB0aGF0IHJldHVybnMgYW4gYEFuaW1hdGVkUHJvcHNgIG9iamVjdCB0aGF0IGlzIG1lbW9pemVkIGJhc2VkXG4gKiBvbiB0aGUgc3Vic2V0IG9mIGBwcm9wc2AgdGhhdCBhcmUgaW5zdGFuY2VzIG9mIGBBbmltYXRlZE5vZGVgIG9yXG4gKiBgQW5pbWF0ZWRFdmVudGAuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVBbmltYXRlZFByb3BzTWVtb0hvb2soXG4gIGFsbG93bGlzdDogP0FuaW1hdGVkUHJvcHNBbGxvd2xpc3QsXG4pOiBBbmltYXRlZFByb3BzTWVtb0hvb2sge1xuICByZXR1cm4gZnVuY3Rpb24gdXNlQW5pbWF0ZWRQcm9wc01lbW8oXG4gICAgY3JlYXRlOiAoKSA9PiBBbmltYXRlZFByb3BzLFxuICAgIHByb3BzOiAkUmVhZE9ubHk8e1tzdHJpbmddOiBtaXhlZH0+LFxuICApOiBBbmltYXRlZFByb3BzIHtcbiAgICAvLyBOT1RFOiBUaGlzIGZlYXR1cmUgZmxhZyBtdXN0IGJlIGV2YWx1YXRlZCBpbnNpZGUgdGhlIGhvb2sgYmVjYXVzZSB0aGlzXG4gICAgLy8gbW9kdWxlIGZhY3RvcnkgY2FuIGJlIGV2YWx1YXRlZCBtdWNoIHNvb25lciwgYmVmb3JlIG92ZXJyaWRlcyBhcmUgc2V0LlxuICAgIGNvbnN0IHVzZUFuaW1hdGVkUHJvcHNJbXBsID1cbiAgICAgIFJlYWN0TmF0aXZlRmVhdHVyZUZsYWdzLmF2b2lkU3RhdGVVcGRhdGVJbkFuaW1hdGVkUHJvcHNNZW1vKClcbiAgICAgICAgPyB1c2VBbmltYXRlZFByb3BzTWVtb19yZWZcbiAgICAgICAgOiB1c2VBbmltYXRlZFByb3BzTWVtb19zdGF0ZTtcbiAgICByZXR1cm4gdXNlQW5pbWF0ZWRQcm9wc0ltcGwoY3JlYXRlLCBwcm9wcyk7XG4gIH07XG5cbiAgZnVuY3Rpb24gdXNlQW5pbWF0ZWRQcm9wc01lbW9fcmVmKFxuICAgIGNyZWF0ZTogKCkgPT4gQW5pbWF0ZWRQcm9wcyxcbiAgICBwcm9wczogJFJlYWRPbmx5PHtbc3RyaW5nXTogbWl4ZWR9PixcbiAgKTogQW5pbWF0ZWRQcm9wcyB7XG4gICAgY29uc3QgY29tcG9zaXRlS2V5ID0gdXNlTWVtbyhcbiAgICAgICgpID0+IGNyZWF0ZUNvbXBvc2l0ZUtleUZvclByb3BzKHByb3BzLCBhbGxvd2xpc3QpLFxuICAgICAgW3Byb3BzXSxcbiAgICApO1xuXG4gICAgY29uc3QgcHJldlJlZiA9IHVzZVJlZjw/JFJlYWRPbmx5PHtcbiAgICAgIGNvbXBvc2l0ZUtleTogdHlwZW9mIGNvbXBvc2l0ZUtleSxcbiAgICAgIG5vZGU6IEFuaW1hdGVkUHJvcHMsXG4gICAgfT4+KCk7XG4gICAgY29uc3QgcHJldiA9IHByZXZSZWYuY3VycmVudDtcblxuICAgIGNvbnN0IG5leHQgPVxuICAgICAgcHJldiAhPSBudWxsICYmIGFyZUNvbXBvc2l0ZUtleXNFcXVhbChwcmV2LmNvbXBvc2l0ZUtleSwgY29tcG9zaXRlS2V5KVxuICAgICAgICA/IHByZXZcbiAgICAgICAgOiB7XG4gICAgICAgICAgICBjb21wb3NpdGVLZXksXG4gICAgICAgICAgICBub2RlOiBjcmVhdGUoKSxcbiAgICAgICAgICB9O1xuXG4gICAgdXNlSW5zZXJ0aW9uRWZmZWN0KCgpID0+IHtcbiAgICAgIHByZXZSZWYuY3VycmVudCA9IG5leHQ7XG4gICAgfSwgW25leHRdKTtcblxuICAgIHJldHVybiBuZXh0Lm5vZGU7XG4gIH1cblxuICBmdW5jdGlvbiB1c2VBbmltYXRlZFByb3BzTWVtb19zdGF0ZShcbiAgICBjcmVhdGU6ICgpID0+IEFuaW1hdGVkUHJvcHMsXG4gICAgcHJvcHM6ICRSZWFkT25seTx7W3N0cmluZ106IG1peGVkfT4sXG4gICk6IEFuaW1hdGVkUHJvcHMge1xuICAgIGNvbnN0IGNvbXBvc2l0ZUtleSA9IHVzZU1lbW8oXG4gICAgICAoKSA9PiBjcmVhdGVDb21wb3NpdGVLZXlGb3JQcm9wcyhwcm9wcywgYWxsb3dsaXN0KSxcbiAgICAgIFtwcm9wc10sXG4gICAgKTtcblxuICAgIGNvbnN0IFtzdGF0ZSwgc2V0U3RhdGVdID0gdXNlU3RhdGU8e1xuICAgICAgYWxsb3dsaXN0OiA/QW5pbWF0ZWRQcm9wc0FsbG93bGlzdCxcbiAgICAgIGNvbXBvc2l0ZUtleTogJFJlYWRPbmx5Q29tcG9zaXRlS2V5IHwgbnVsbCxcbiAgICAgIHZhbHVlOiBBbmltYXRlZFByb3BzLFxuICAgIH0+KCgpID0+ICh7XG4gICAgICBhbGxvd2xpc3QsXG4gICAgICBjb21wb3NpdGVLZXksXG4gICAgICB2YWx1ZTogY3JlYXRlKCksXG4gICAgfSkpO1xuXG4gICAgaWYgKFxuICAgICAgc3RhdGUuYWxsb3dsaXN0ICE9PSBhbGxvd2xpc3QgfHxcbiAgICAgICFhcmVDb21wb3NpdGVLZXlzRXF1YWwoc3RhdGUuY29tcG9zaXRlS2V5LCBjb21wb3NpdGVLZXkpXG4gICAgKSB7XG4gICAgICBzZXRTdGF0ZSh7XG4gICAgICAgIGFsbG93bGlzdCxcbiAgICAgICAgY29tcG9zaXRlS2V5LFxuICAgICAgICB2YWx1ZTogY3JlYXRlKCksXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHN0YXRlLnZhbHVlO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBjb21wb3NpdGUga2V5IGZvciBhIGBwcm9wc2Agb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgdG8gZGV0ZWN0XG4gKiB3aGV0aGVyIGEgbmV3IGBBbmltYXRlZFByb3BzYCBpbnN0YW5jZSBtdXN0IGJlIGNyZWF0ZWQuXG4gKlxuICogLSBXaXRoIGFuIGFsbG93bGlzdCwgdGhvc2UgcHJvcHMgYXJlIHNlYXJjaGVkIGZvciBgQW5pbWF0ZWROb2RlYCBpbnN0YW5jZXMuXG4gKiAtIFdpdGhvdXQgYW4gYWxsb3dsaXN0LCBgc3R5bGVgIGlzIHNlYXJjaGVkIGZvciBgQW5pbWF0ZWROb2RlYCBpbnN0YW5jZXMsXG4gKiAgIGJ1dCBhbGwgb3RoZXIgb2JqZWN0cyBhbmQgYXJyYXlzIGFyZSBpbmNsdWRlZCAobm90IHNlYXJjaGVkKS4gV2UgZG8gbm90XG4gKiAgIHNlYXJjaCBvYmplY3RzIGFuZCBhcnJheXMgd2l0aG91dCBhbiBhbGxvd2xpc3QgaW4gY2FzZSB0aGV5IGFyZSB2ZXJ5IGxhcmdlXG4gKiAgIGRhdGEgc3RydWN0dXJlcy4gV2Ugc2FmZWx5IHRyYXZlcnNlIGBzdHlsZWAgYmVjdWFzZSBpdCBpcyBib3VuZGVkLlxuICpcbiAqIEFueSBgQW5pbWF0ZWRFdmVudGAgaW5zdGFuY2VzIGF0IHRoZSBmaXJzdCBkZXB0aCBhcmUgYWx3YXlzIGluY2x1ZGVkLlxuICpcbiAqIElmIGBwcm9wc2AgY29udGFpbnMgbm8gYEFuaW1hdGVkTm9kZWAgb3IgYEFuaW1hdGVkRXZlbnRgIGluc3RhbmNlcywgdGhpc1xuICogcmV0dXJucyBudWxsLlxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ29tcG9zaXRlS2V5Rm9yUHJvcHMoXG4gIHByb3BzOiAkUmVhZE9ubHk8e1tzdHJpbmddOiBtaXhlZH0+LFxuICBhbGxvd2xpc3Q6ID9BbmltYXRlZFByb3BzQWxsb3dsaXN0LFxuKTogJFJlYWRPbmx5Q29tcG9zaXRlS2V5IHwgbnVsbCB7XG4gIGxldCBjb21wb3NpdGVLZXk6IENvbXBvc2l0ZUtleSB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhwcm9wcyk7XG4gIGZvciAobGV0IGlpID0gMCwgbGVuZ3RoID0ga2V5cy5sZW5ndGg7IGlpIDwgbGVuZ3RoOyBpaSsrKSB7XG4gICAgY29uc3Qga2V5ID0ga2V5c1tpaV07XG4gICAgY29uc3QgdmFsdWUgPSBwcm9wc1trZXldO1xuXG4gICAgaWYgKGFsbG93bGlzdCA9PSBudWxsIHx8IGhhc093bihhbGxvd2xpc3QsIGtleSkpIHtcbiAgICAgIGxldCBjb21wb3NpdGVLZXlDb21wb25lbnQ7XG4gICAgICBpZiAoa2V5ID09PSAnc3R5bGUnKSB7XG4gICAgICAgIC8vICRGbG93Rml4TWVbaW5jb21wYXRpYmxlLWNhbGxdIC0gYHN0eWxlYCBpcyBhIHZhbGlkIGFyZ3VtZW50LlxuICAgICAgICAvLyAkRmxvd0ZpeE1lW2luY29tcGF0aWJsZS10eXBlXSAtIGBmbGF0dGVuU3R5bGVgIHJldHVybnMgYW4gb2JqZWN0LlxuICAgICAgICBjb25zdCBmbGF0U3R5bGU6ID97W3N0cmluZ106IG1peGVkfSA9IGZsYXR0ZW5TdHlsZSh2YWx1ZSk7XG4gICAgICAgIGlmIChmbGF0U3R5bGUgIT0gbnVsbCkge1xuICAgICAgICAgIGNvbXBvc2l0ZUtleUNvbXBvbmVudCA9IGNyZWF0ZUNvbXBvc2l0ZUtleUZvck9iamVjdChcbiAgICAgICAgICAgIGZsYXRTdHlsZSxcbiAgICAgICAgICAgIGFsbG93bGlzdD8uc3R5bGUsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBBbmltYXRlZE5vZGUgfHxcbiAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBBbmltYXRlZEV2ZW50XG4gICAgICApIHtcbiAgICAgICAgY29tcG9zaXRlS2V5Q29tcG9uZW50ID0gdmFsdWU7XG4gICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIGNvbXBvc2l0ZUtleUNvbXBvbmVudCA9XG4gICAgICAgICAgYWxsb3dsaXN0ID09IG51bGwgPyB2YWx1ZSA6IGNyZWF0ZUNvbXBvc2l0ZUtleUZvckFycmF5KHZhbHVlKTtcbiAgICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdCh2YWx1ZSkpIHtcbiAgICAgICAgY29tcG9zaXRlS2V5Q29tcG9uZW50ID1cbiAgICAgICAgICBhbGxvd2xpc3QgPT0gbnVsbCA/IHZhbHVlIDogY3JlYXRlQ29tcG9zaXRlS2V5Rm9yT2JqZWN0KHZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGlmIChjb21wb3NpdGVLZXlDb21wb25lbnQgIT0gbnVsbCkge1xuICAgICAgICBpZiAoY29tcG9zaXRlS2V5ID09IG51bGwpIHtcbiAgICAgICAgICBjb21wb3NpdGVLZXkgPSB7fSBhcyBDb21wb3NpdGVLZXk7XG4gICAgICAgIH1cbiAgICAgICAgY29tcG9zaXRlS2V5W2tleV0gPSBjb21wb3NpdGVLZXlDb21wb25lbnQ7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGNvbXBvc2l0ZUtleTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGNvbXBvc2l0ZSBrZXkgZm9yIGFuIGFycmF5IHRoYXQgcmV0YWlucyBhbGwgdmFsdWVzIHRoYXQgYXJlIG9yXG4gKiBjb250YWluIGBBbmltYXRlZE5vZGVgIGluc3RhbmNlcywgYW5kIGBudWxsYCBmb3IgdGhlIHJlc3QuXG4gKlxuICogSWYgYGFycmF5YCBjb250YWlucyBubyBgQW5pbWF0ZWROb2RlYCBpbnN0YW5jZXMsIHRoaXMgcmV0dXJucyBudWxsLlxuICovXG5mdW5jdGlvbiBjcmVhdGVDb21wb3NpdGVLZXlGb3JBcnJheShcbiAgYXJyYXk6ICRSZWFkT25seUFycmF5PG1peGVkPixcbik6ICRSZWFkT25seUFycmF5PCRSZWFkT25seUNvbXBvc2l0ZUtleUNvbXBvbmVudCB8IG51bGw+IHwgbnVsbCB7XG4gIGxldCBjb21wb3NpdGVLZXk6IEFycmF5PCRSZWFkT25seUNvbXBvc2l0ZUtleUNvbXBvbmVudCB8IG51bGw+IHwgbnVsbCA9IG51bGw7XG5cbiAgZm9yIChsZXQgaWkgPSAwLCBsZW5ndGggPSBhcnJheS5sZW5ndGg7IGlpIDwgbGVuZ3RoOyBpaSsrKSB7XG4gICAgY29uc3QgdmFsdWUgPSBhcnJheVtpaV07XG5cbiAgICBsZXQgY29tcG9zaXRlS2V5Q29tcG9uZW50O1xuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFuaW1hdGVkTm9kZSkge1xuICAgICAgY29tcG9zaXRlS2V5Q29tcG9uZW50ID0gdmFsdWU7XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgY29tcG9zaXRlS2V5Q29tcG9uZW50ID0gY3JlYXRlQ29tcG9zaXRlS2V5Rm9yQXJyYXkodmFsdWUpO1xuICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdCh2YWx1ZSkpIHtcbiAgICAgIGNvbXBvc2l0ZUtleUNvbXBvbmVudCA9IGNyZWF0ZUNvbXBvc2l0ZUtleUZvck9iamVjdCh2YWx1ZSk7XG4gICAgfVxuICAgIGlmIChjb21wb3NpdGVLZXlDb21wb25lbnQgIT0gbnVsbCkge1xuICAgICAgaWYgKGNvbXBvc2l0ZUtleSA9PSBudWxsKSB7XG4gICAgICAgIGNvbXBvc2l0ZUtleSA9IG5ldyBBcnJheTwkUmVhZE9ubHlDb21wb3NpdGVLZXlDb21wb25lbnQgfCBudWxsPihcbiAgICAgICAgICBhcnJheS5sZW5ndGgsXG4gICAgICAgICkuZmlsbChudWxsKTtcbiAgICAgIH1cbiAgICAgIGNvbXBvc2l0ZUtleVtpaV0gPSBjb21wb3NpdGVLZXlDb21wb25lbnQ7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGNvbXBvc2l0ZUtleTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGNvbXBvc2l0ZSBrZXkgZm9yIGFuIG9iamVjdCB0aGF0IHJldGFpbnMgb25seSBwcm9wZXJ0aWVzIHRoYXRcbiAqIGFyZSBvciBjb250YWluIGBBbmltYXRlZE5vZGVgIGluc3RhbmNlcy5cbiAqXG4gKiBXaGVuIHVzZWQgdG8gY3JlYXRlIGNvbXBvc2l0ZSBrZXlzIGZvciBgc3R5bGVgIHByb3BzOlxuICpcbiAqIC0gV2l0aCBhbiBhbGxvd2xpc3QsIHRob3NlIHByb3BlcnRpZXMgYXJlIHNlYXJjaGVkLlxuICogLSBXaXRob3V0IGFuIGFsbG93bGlzdCwgZXZlcnkgcHJvcGVydHkgaXMgc2VhcmNoZWQuXG4gKlxuICogSWYgYG9iamVjdGAgY29udGFpbnMgbm8gYEFuaW1hdGVkTm9kZWAgaW5zdGFuY2VzLCB0aGlzIHJldHVybnMgbnVsbC5cbiAqL1xuZnVuY3Rpb24gY3JlYXRlQ29tcG9zaXRlS2V5Rm9yT2JqZWN0KFxuICBvYmplY3Q6ICRSZWFkT25seTx7W3N0cmluZ106IG1peGVkfT4sXG4gIGFsbG93bGlzdD86ID9BbmltYXRlZFN0eWxlQWxsb3dsaXN0LFxuKTogJFJlYWRPbmx5PHtbc3RyaW5nXTogJFJlYWRPbmx5Q29tcG9zaXRlS2V5Q29tcG9uZW50fT4gfCBudWxsIHtcbiAgbGV0IGNvbXBvc2l0ZUtleToge1tzdHJpbmddOiAkUmVhZE9ubHlDb21wb3NpdGVLZXlDb21wb25lbnR9IHwgbnVsbCA9IG51bGw7XG5cbiAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7XG4gIGZvciAobGV0IGlpID0gMCwgbGVuZ3RoID0ga2V5cy5sZW5ndGg7IGlpIDwgbGVuZ3RoOyBpaSsrKSB7XG4gICAgY29uc3Qga2V5ID0ga2V5c1tpaV07XG5cbiAgICBpZiAoYWxsb3dsaXN0ID09IG51bGwgfHwgaGFzT3duKGFsbG93bGlzdCwga2V5KSkge1xuICAgICAgY29uc3QgdmFsdWUgPSBvYmplY3Rba2V5XTtcblxuICAgICAgbGV0IGNvbXBvc2l0ZUtleUNvbXBvbmVudDtcbiAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFuaW1hdGVkTm9kZSkge1xuICAgICAgICBjb21wb3NpdGVLZXlDb21wb25lbnQgPSB2YWx1ZTtcbiAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgY29tcG9zaXRlS2V5Q29tcG9uZW50ID0gY3JlYXRlQ29tcG9zaXRlS2V5Rm9yQXJyYXkodmFsdWUpO1xuICAgICAgfSBlbHNlIGlmIChpc1BsYWluT2JqZWN0KHZhbHVlKSkge1xuICAgICAgICBjb21wb3NpdGVLZXlDb21wb25lbnQgPSBjcmVhdGVDb21wb3NpdGVLZXlGb3JPYmplY3QodmFsdWUpO1xuICAgICAgfVxuICAgICAgaWYgKGNvbXBvc2l0ZUtleUNvbXBvbmVudCAhPSBudWxsKSB7XG4gICAgICAgIGlmIChjb21wb3NpdGVLZXkgPT0gbnVsbCkge1xuICAgICAgICAgIGNvbXBvc2l0ZUtleSA9IHt9IGFzIHtbc3RyaW5nXTogJFJlYWRPbmx5Q29tcG9zaXRlS2V5Q29tcG9uZW50fTtcbiAgICAgICAgfVxuICAgICAgICBjb21wb3NpdGVLZXlba2V5XSA9IGNvbXBvc2l0ZUtleUNvbXBvbmVudDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gY29tcG9zaXRlS2V5O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXJlQ29tcG9zaXRlS2V5c0VxdWFsKFxuICBtYXliZVByZXY6ICRSZWFkT25seUNvbXBvc2l0ZUtleSB8IG51bGwsXG4gIG1heWJlTmV4dDogJFJlYWRPbmx5Q29tcG9zaXRlS2V5IHwgbnVsbCxcbiAgYWxsb3dsaXN0OiA/QW5pbWF0ZWRQcm9wc0FsbG93bGlzdCxcbik6IGJvb2xlYW4ge1xuICBpZiAobWF5YmVQcmV2ID09PSBtYXliZU5leHQpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAobWF5YmVQcmV2ID09PSBudWxsIHx8IG1heWJlTmV4dCA9PT0gbnVsbCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICAvLyBIZWxwIEZsb3cgcmV0YWluIHRoZSB0eXBlIHJlZmluZW1lbnRzIG9mIHRoZXNlLlxuICBjb25zdCBwcmV2ID0gbWF5YmVQcmV2O1xuICBjb25zdCBuZXh0ID0gbWF5YmVOZXh0O1xuXG4gIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhwcmV2KTtcbiAgY29uc3QgbGVuZ3RoID0ga2V5cy5sZW5ndGg7XG4gIGlmIChsZW5ndGggIT09IE9iamVjdC5rZXlzKG5leHQpLmxlbmd0aCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBmb3IgKGxldCBpaSA9IDA7IGlpIDwgbGVuZ3RoOyBpaSsrKSB7XG4gICAgY29uc3Qga2V5ID0ga2V5c1tpaV07XG4gICAgaWYgKCFoYXNPd24obmV4dCwga2V5KSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBwcmV2Q29tcG9uZW50ID0gcHJldltrZXldO1xuICAgIGNvbnN0IG5leHRDb21wb25lbnQgPSBuZXh0W2tleV07XG5cbiAgICBpZiAoa2V5ID09PSAnc3R5bGUnKSB7XG4gICAgICAvLyBXZSBrbm93IHN0eWxlIGNvbXBvbmVudHMgYXJlIG9iamVjdHMgd2l0aCBub24tbWl4ZWQgdmFsdWVzLlxuICAgICAgaWYgKFxuICAgICAgICAhYXJlQ29tcG9zaXRlS2V5Q29tcG9uZW50c0VxdWFsKFxuICAgICAgICAgIC8vICRGbG93SWdub3JlW2luY29tcGF0aWJsZS1jYXN0XVxuICAgICAgICAgIHByZXZDb21wb25lbnQgYXMgJFJlYWRPbmx5Q29tcG9zaXRlS2V5Q29tcG9uZW50LFxuICAgICAgICAgIC8vICRGbG93SWdub3JlW2luY29tcGF0aWJsZS1jYXN0XVxuICAgICAgICAgIG5leHRDb21wb25lbnQgYXMgJFJlYWRPbmx5Q29tcG9zaXRlS2V5Q29tcG9uZW50LFxuICAgICAgICApXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoXG4gICAgICBwcmV2Q29tcG9uZW50IGluc3RhbmNlb2YgQW5pbWF0ZWROb2RlIHx8XG4gICAgICBwcmV2Q29tcG9uZW50IGluc3RhbmNlb2YgQW5pbWF0ZWRFdmVudFxuICAgICkge1xuICAgICAgaWYgKHByZXZDb21wb25lbnQgIT09IG5leHRDb21wb25lbnQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBXaGVuIGBhbGxvd2xpc3RgIGlzIG51bGwsIHRoZSBjb21wb25lbnRzIG11c3QgYmUgdGhlIHNhbWUuIE90aGVyd2lzZSxcbiAgICAgIC8vIHdlIGNyZWF0ZWQgdGhlIGNvbXBvbmVudHMgdXNpbmcgZGVlcCB0cmF2ZXJzYWwsIHNvIGRlZXAgY29tcGFyZSB0aGVtLlxuICAgICAgaWYgKGFsbG93bGlzdCA9PSBudWxsKSB7XG4gICAgICAgIGlmIChwcmV2Q29tcG9uZW50ICE9PSBuZXh0Q29tcG9uZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgIWFyZUNvbXBvc2l0ZUtleUNvbXBvbmVudHNFcXVhbChcbiAgICAgICAgICAgIC8vICRGbG93SWdub3JlW2luY29tcGF0aWJsZS1jYXN0XVxuICAgICAgICAgICAgcHJldkNvbXBvbmVudCBhcyAkUmVhZE9ubHlDb21wb3NpdGVLZXlDb21wb25lbnQsXG4gICAgICAgICAgICAvLyAkRmxvd0lnbm9yZVtpbmNvbXBhdGlibGUtY2FzdF1cbiAgICAgICAgICAgIG5leHRDb21wb25lbnQgYXMgJFJlYWRPbmx5Q29tcG9zaXRlS2V5Q29tcG9uZW50LFxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiBhcmVDb21wb3NpdGVLZXlDb21wb25lbnRzRXF1YWwoXG4gIHByZXY6ICRSZWFkT25seUNvbXBvc2l0ZUtleUNvbXBvbmVudCB8IG51bGwsXG4gIG5leHQ6ICRSZWFkT25seUNvbXBvc2l0ZUtleUNvbXBvbmVudCB8IG51bGwsXG4pOiBib29sZWFuIHtcbiAgaWYgKHByZXYgPT09IG5leHQpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAocHJldiBpbnN0YW5jZW9mIEFuaW1hdGVkTm9kZSkge1xuICAgIHJldHVybiBwcmV2ID09PSBuZXh0O1xuICB9XG4gIGlmIChBcnJheS5pc0FycmF5KHByZXYpKSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KG5leHQpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGxlbmd0aCA9IHByZXYubGVuZ3RoO1xuICAgIGlmIChsZW5ndGggIT09IG5leHQubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCBsZW5ndGg7IGlpKyspIHtcbiAgICAgIGlmICghYXJlQ29tcG9zaXRlS2V5Q29tcG9uZW50c0VxdWFsKHByZXZbaWldLCBuZXh0W2lpXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoaXNQbGFpbk9iamVjdChwcmV2KSkge1xuICAgIGlmICghaXNQbGFpbk9iamVjdChuZXh0KSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMocHJldik7XG4gICAgY29uc3QgbGVuZ3RoID0ga2V5cy5sZW5ndGg7XG4gICAgaWYgKGxlbmd0aCAhPT0gT2JqZWN0LmtleXMobmV4dCkubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCBsZW5ndGg7IGlpKyspIHtcbiAgICAgIGNvbnN0IGtleSA9IGtleXNbaWldO1xuICAgICAgaWYgKFxuICAgICAgICAhaGFzT3duKG51bGx0aHJvd3MobmV4dCksIGtleSkgfHxcbiAgICAgICAgIWFyZUNvbXBvc2l0ZUtleUNvbXBvbmVudHNFcXVhbChwcmV2W2tleV0sIG5leHRba2V5XSlcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuLy8gU3VwcG9ydGVkIHZlcnNpb25zIG9mIEpTQyBkbyBub3QgaW1wbGVtZW50IHRoZSBuZXdlciBPYmplY3QuaGFzT3duLiBSZW1vdmVcbi8vIHRoaXMgc2hpbSB3aGVuIHRoZXkgZG8uXG4vLyAkRmxvd0lnbm9yZVttZXRob2QtdW5iaW5kaW5nXVxuY29uc3QgX2hhc093blByb3AgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O1xuY29uc3QgaGFzT3duOiAob2JqOiAkUmVhZE9ubHk8ey4uLn0+LCBwcm9wOiBzdHJpbmcpID0+IGJvb2xlYW4gPVxuICAvLyAkRmxvd0lnbm9yZVttZXRob2QtdW5iaW5kaW5nXVxuICBPYmplY3QuaGFzT3duID8/ICgob2JqLCBwcm9wKSA9PiBfaGFzT3duUHJvcC5jYWxsKG9iaiwgcHJvcCkpO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFjQSxJQUFBQSxjQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxhQUFBLEdBQUFDLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBRyxlQUFBLEdBQUFILE9BQUE7QUFDQSxJQUFBSSxhQUFBLEdBQUFGLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBSyx1QkFBQSxHQUFBQyx1QkFBQSxDQUFBTixPQUFBO0FBQ0EsSUFBQU8sV0FBQSxHQUFBTCxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQVEsTUFBQSxHQUFBUixPQUFBO0FBQW9FLElBQUFTLGNBQUE7QUF3QzdELFNBQVNDLDJCQUEyQkEsQ0FDekNDLFNBQWtDLEVBQ1g7RUFDdkIsT0FBTyxTQUFTQyxvQkFBb0JBLENBQ2xDQyxNQUEyQixFQUMzQkMsS0FBbUMsRUFDcEI7SUFHZixJQUFNQyxvQkFBb0IsR0FDeEJWLHVCQUF1QixDQUFDVyxtQ0FBbUMsQ0FBQyxDQUFDLEdBQ3pEQyx3QkFBd0IsR0FDeEJDLDBCQUEwQjtJQUNoQyxP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