a6f9ec75782322e4f6d9f3edd98b307b
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _react = require("react");
var _i18n = require("../../../../i18n");
var _validator = require("../../../../utils/validator");
var _types = require("./types");
var formatPhoneNumber = function formatPhoneNumber(value) {
  if (!value) return '';
  var digits = value.replace(/\D/g, '');
  if (digits.length <= 3) return digits;
  if (digits.length <= 6) return `(${digits.slice(0, 3)}) ${digits.slice(3)}`;
  return `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6, 10)}`;
};
var useTextField = function useTextField(_ref) {
  var _ref$value = _ref.value,
    value = _ref$value === void 0 ? '' : _ref$value,
    onChangeText = _ref.onChangeText,
    onChange = _ref.onChange,
    _ref$type = _ref.type,
    type = _ref$type === void 0 ? 'text' : _ref$type,
    validate = _ref.validate,
    _ref$required = _ref.required,
    required = _ref$required === void 0 ? false : _ref$required,
    maxLength = _ref.maxLength,
    _ref$debounceMs = _ref.debounceMs,
    debounceMs = _ref$debounceMs === void 0 ? 300 : _ref$debounceMs,
    _ref$autoFormat = _ref.autoFormat,
    autoFormat = _ref$autoFormat === void 0 ? false : _ref$autoFormat;
  var normalizedValue = value == null ? '' : value;
  var _useState = (0, _react.useState)(normalizedValue),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    internalValue = _useState2[0],
    setInternalValue = _useState2[1];
  var _useState3 = (0, _react.useState)(_types.VALIDATION_STATES.DEFAULT),
    _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
    validationState = _useState4[0],
    setValidationState = _useState4[1];
  var _useState5 = (0, _react.useState)(''),
    _useState6 = (0, _slicedToArray2.default)(_useState5, 2),
    errorMessage = _useState6[0],
    setErrorMessage = _useState6[1];
  var _useState7 = (0, _react.useState)(false),
    _useState8 = (0, _slicedToArray2.default)(_useState7, 2),
    isFocused = _useState8[0],
    setIsFocused = _useState8[1];
  var debounceTimerRef = (0, _react.useRef)(null);
  (0, _react.useEffect)(function () {
    setInternalValue(value == null ? '' : value);
  }, [value]);
  var validateValue = (0, _react.useCallback)(function (val) {
    if (!val && !required) {
      setValidationState(_types.VALIDATION_STATES.DEFAULT);
      setErrorMessage('');
      return true;
    }
    if (required && !val) {
      setValidationState(_types.VALIDATION_STATES.ERROR);
      setErrorMessage((0, _i18n.tSync)('forms.validation.required'));
      return false;
    }
    if (maxLength && val.length > maxLength) {
      setValidationState(_types.VALIDATION_STATES.ERROR);
      setErrorMessage((0, _i18n.tSync)('forms.validation.maxLength', {
        max: maxLength
      }));
      return false;
    }
    if (type === 'email' && val && !(0, _validator.isValidEmail)(val)) {
      setValidationState(_types.VALIDATION_STATES.ERROR);
      setErrorMessage((0, _i18n.tSync)('forms.validation.invalidEmail'));
      return false;
    }
    if (type === 'url' && val && !(0, _validator.isValidUrl)(val)) {
      setValidationState(_types.VALIDATION_STATES.ERROR);
      setErrorMessage((0, _i18n.tSync)('forms.validation.invalidUrl'));
      return false;
    }
    if (validate) {
      var result = validate(val);
      if (typeof result === 'boolean') {
        if (!result) {
          setValidationState(_types.VALIDATION_STATES.ERROR);
          setErrorMessage((0, _i18n.tSync)('forms.validation.invalidValue'));
          return false;
        }
      } else if (result && !result.valid) {
        setValidationState(_types.VALIDATION_STATES.ERROR);
        setErrorMessage(result.error || (0, _i18n.tSync)('forms.validation.invalidValue'));
        return false;
      }
    }
    if (val) {
      setValidationState(_types.VALIDATION_STATES.SUCCESS);
    } else {
      setValidationState(_types.VALIDATION_STATES.DEFAULT);
    }
    setErrorMessage('');
    return true;
  }, [type, required, maxLength, validate]);
  var handleChange = (0, _react.useCallback)(function (newValue) {
    var formattedValue = newValue;
    if (autoFormat && type === 'tel') {
      formattedValue = formatPhoneNumber(newValue);
    }
    setInternalValue(formattedValue);
    if (debounceTimerRef.current) {
      clearTimeout(debounceTimerRef.current);
    }
    if (required && !formattedValue) {
      setValidationState(_types.VALIDATION_STATES.ERROR);
      setErrorMessage((0, _i18n.tSync)('forms.validation.required'));
    } else {
      setValidationState(_types.VALIDATION_STATES.DEFAULT);
      setErrorMessage('');
    }
    debounceTimerRef.current = setTimeout(function () {
      validateValue(formattedValue);
      if (onChangeText) {
        onChangeText(formattedValue);
      }
      if (onChange) {
        onChange({
          target: {
            value: formattedValue
          }
        });
      }
    }, debounceMs);
  }, [onChangeText, onChange, type, required, debounceMs, autoFormat, validateValue]);
  var handleFocus = (0, _react.useCallback)(function () {
    setIsFocused(true);
  }, []);
  var handleBlur = (0, _react.useCallback)(function () {
    setIsFocused(false);
    validateValue(internalValue);
  }, [internalValue, validateValue]);
  (0, _react.useEffect)(function () {
    return function () {
      if (debounceTimerRef.current) {
        clearTimeout(debounceTimerRef.current);
      }
    };
  }, []);
  return {
    value: internalValue,
    validationState: validationState,
    errorMessage: errorMessage,
    isFocused: isFocused,
    handleChange: handleChange,
    handleFocus: handleFocus,
    handleBlur: handleBlur,
    characterCount: internalValue ? internalValue.length : 0
  };
};
var _default = exports.default = useTextField;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiX2kxOG4iLCJfdmFsaWRhdG9yIiwiX3R5cGVzIiwiZm9ybWF0UGhvbmVOdW1iZXIiLCJ2YWx1ZSIsImRpZ2l0cyIsInJlcGxhY2UiLCJsZW5ndGgiLCJzbGljZSIsInVzZVRleHRGaWVsZCIsIl9yZWYiLCJfcmVmJHZhbHVlIiwib25DaGFuZ2VUZXh0Iiwib25DaGFuZ2UiLCJfcmVmJHR5cGUiLCJ0eXBlIiwidmFsaWRhdGUiLCJfcmVmJHJlcXVpcmVkIiwicmVxdWlyZWQiLCJtYXhMZW5ndGgiLCJfcmVmJGRlYm91bmNlTXMiLCJkZWJvdW5jZU1zIiwiX3JlZiRhdXRvRm9ybWF0IiwiYXV0b0Zvcm1hdCIsIm5vcm1hbGl6ZWRWYWx1ZSIsIl91c2VTdGF0ZSIsInVzZVN0YXRlIiwiX3VzZVN0YXRlMiIsIl9zbGljZWRUb0FycmF5MiIsImRlZmF1bHQiLCJpbnRlcm5hbFZhbHVlIiwic2V0SW50ZXJuYWxWYWx1ZSIsIl91c2VTdGF0ZTMiLCJWQUxJREFUSU9OX1NUQVRFUyIsIkRFRkFVTFQiLCJfdXNlU3RhdGU0IiwidmFsaWRhdGlvblN0YXRlIiwic2V0VmFsaWRhdGlvblN0YXRlIiwiX3VzZVN0YXRlNSIsIl91c2VTdGF0ZTYiLCJlcnJvck1lc3NhZ2UiLCJzZXRFcnJvck1lc3NhZ2UiLCJfdXNlU3RhdGU3IiwiX3VzZVN0YXRlOCIsImlzRm9jdXNlZCIsInNldElzRm9jdXNlZCIsImRlYm91bmNlVGltZXJSZWYiLCJ1c2VSZWYiLCJ1c2VFZmZlY3QiLCJ2YWxpZGF0ZVZhbHVlIiwidXNlQ2FsbGJhY2siLCJ2YWwiLCJFUlJPUiIsInRTeW5jIiwibWF4IiwiaXNWYWxpZEVtYWlsIiwiaXNWYWxpZFVybCIsInJlc3VsdCIsInZhbGlkIiwiZXJyb3IiLCJTVUNDRVNTIiwiaGFuZGxlQ2hhbmdlIiwibmV3VmFsdWUiLCJmb3JtYXR0ZWRWYWx1ZSIsImN1cnJlbnQiLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0IiwidGFyZ2V0IiwiaGFuZGxlRm9jdXMiLCJoYW5kbGVCbHVyIiwiY2hhcmFjdGVyQ291bnQiLCJfZGVmYXVsdCIsImV4cG9ydHMiXSwic291cmNlcyI6WyJ1c2VUZXh0RmllbGQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFRleHRGaWVsZCBIb29rXHJcbiAqIFNoYXJlZCBsb2dpYyBmb3IgVGV4dEZpZWxkIGNvbXBvbmVudCAodmFsaWRhdGlvbiwgZm9ybWF0dGluZywgZGVib3VuY2UpXHJcbiAqIEZpbGU6IHVzZVRleHRGaWVsZC5qc1xyXG4gKi9cclxuaW1wb3J0IHsgdXNlQ2FsbGJhY2ssIHVzZUVmZmVjdCwgdXNlUmVmLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHsgdFN5bmMgfSBmcm9tICdAaTE4bic7XHJcbmltcG9ydCB7IGlzVmFsaWRFbWFpbCwgaXNWYWxpZFVybCB9IGZyb20gJ0B1dGlscy92YWxpZGF0b3InO1xyXG5pbXBvcnQgeyBWQUxJREFUSU9OX1NUQVRFUyB9IGZyb20gJy4vdHlwZXMnO1xyXG5cclxuLyoqXHJcbiAqIEZvcm1hdCBwaG9uZSBudW1iZXIgKGJhc2ljIGZvcm1hdHRpbmcpXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSAtIFBob25lIG51bWJlciBzdHJpbmdcclxuICogQHJldHVybnMge3N0cmluZ30gRm9ybWF0dGVkIHBob25lIG51bWJlclxyXG4gKi9cclxuY29uc3QgZm9ybWF0UGhvbmVOdW1iZXIgPSAodmFsdWUpID0+IHtcclxuICBpZiAoIXZhbHVlKSByZXR1cm4gJyc7XHJcbiAgLy8gUmVtb3ZlIGFsbCBub24tZGlnaXQgY2hhcmFjdGVyc1xyXG4gIGNvbnN0IGRpZ2l0cyA9IHZhbHVlLnJlcGxhY2UoL1xcRC9nLCAnJyk7XHJcbiAgLy8gRm9ybWF0IGFzIChYWFgpIFhYWC1YWFhYIGZvciBVUyBudW1iZXJzXHJcbiAgaWYgKGRpZ2l0cy5sZW5ndGggPD0gMykgcmV0dXJuIGRpZ2l0cztcclxuICBpZiAoZGlnaXRzLmxlbmd0aCA8PSA2KSByZXR1cm4gYCgke2RpZ2l0cy5zbGljZSgwLCAzKX0pICR7ZGlnaXRzLnNsaWNlKDMpfWA7XHJcbiAgcmV0dXJuIGAoJHtkaWdpdHMuc2xpY2UoMCwgMyl9KSAke2RpZ2l0cy5zbGljZSgzLCA2KX0tJHtkaWdpdHMuc2xpY2UoNiwgMTApfWA7XHJcbn07XHJcblxyXG4vKipcclxuICogQ3VzdG9tIGhvb2sgZm9yIFRleHRGaWVsZCBjb21wb25lbnQgbG9naWNcclxuICogQHBhcmFtIHtPYmplY3R9IHByb3BzIC0gVGV4dEZpZWxkIHByb3BzXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wcy52YWx1ZSAtIElucHV0IHZhbHVlXHJcbiAqIEBwYXJhbSB7RnVuY3Rpb259IHByb3BzLm9uQ2hhbmdlVGV4dCAtIENoYW5nZSBoYW5kbGVyXHJcbiAqIEBwYXJhbSB7RnVuY3Rpb259IHByb3BzLm9uQ2hhbmdlIC0gQ2hhbmdlIGhhbmRsZXIgKHdlYilcclxuICogQHBhcmFtIHtzdHJpbmd9IHByb3BzLnR5cGUgLSBJbnB1dCB0eXBlXHJcbiAqIEBwYXJhbSB7RnVuY3Rpb259IHByb3BzLnZhbGlkYXRlIC0gQ3VzdG9tIHZhbGlkYXRpb24gZnVuY3Rpb25cclxuICogQHBhcmFtIHtib29sZWFufSBwcm9wcy5yZXF1aXJlZCAtIFJlcXVpcmVkIGZpZWxkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBwcm9wcy5tYXhMZW5ndGggLSBNYXhpbXVtIGxlbmd0aFxyXG4gKiBAcGFyYW0ge251bWJlcn0gcHJvcHMuZGVib3VuY2VNcyAtIERlYm91bmNlIGRlbGF5IGluIG1pbGxpc2Vjb25kc1xyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHByb3BzLmF1dG9Gb3JtYXQgLSBFbmFibGUgYXV0by1mb3JtYXR0aW5nXHJcbiAqIEByZXR1cm5zIHtPYmplY3R9IFRleHRGaWVsZCBzdGF0ZSBhbmQgaGFuZGxlcnNcclxuICovXHJcbmNvbnN0IHVzZVRleHRGaWVsZCA9ICh7XHJcbiAgdmFsdWUgPSAnJyxcclxuICBvbkNoYW5nZVRleHQsXHJcbiAgb25DaGFuZ2UsXHJcbiAgdHlwZSA9ICd0ZXh0JyxcclxuICB2YWxpZGF0ZSxcclxuICByZXF1aXJlZCA9IGZhbHNlLFxyXG4gIG1heExlbmd0aCxcclxuICBkZWJvdW5jZU1zID0gMzAwLFxyXG4gIGF1dG9Gb3JtYXQgPSBmYWxzZSxcclxufSkgPT4ge1xyXG4gIGNvbnN0IG5vcm1hbGl6ZWRWYWx1ZSA9IHZhbHVlID09IG51bGwgPyAnJyA6IHZhbHVlO1xyXG4gIGNvbnN0IFtpbnRlcm5hbFZhbHVlLCBzZXRJbnRlcm5hbFZhbHVlXSA9IHVzZVN0YXRlKG5vcm1hbGl6ZWRWYWx1ZSk7XHJcbiAgY29uc3QgW3ZhbGlkYXRpb25TdGF0ZSwgc2V0VmFsaWRhdGlvblN0YXRlXSA9IHVzZVN0YXRlKFZBTElEQVRJT05fU1RBVEVTLkRFRkFVTFQpO1xyXG4gIGNvbnN0IFtlcnJvck1lc3NhZ2UsIHNldEVycm9yTWVzc2FnZV0gPSB1c2VTdGF0ZSgnJyk7XHJcbiAgY29uc3QgW2lzRm9jdXNlZCwgc2V0SXNGb2N1c2VkXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICBjb25zdCBkZWJvdW5jZVRpbWVyUmVmID0gdXNlUmVmKG51bGwpO1xyXG5cclxuICAvLyBTeW5jIGludGVybmFsIHZhbHVlIHdpdGggZXh0ZXJuYWwgdmFsdWVcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgc2V0SW50ZXJuYWxWYWx1ZSh2YWx1ZSA9PSBudWxsID8gJycgOiB2YWx1ZSk7XHJcbiAgfSwgW3ZhbHVlXSk7XHJcblxyXG4gIC8vIFZhbGlkYXRlIHZhbHVlXHJcbiAgY29uc3QgdmFsaWRhdGVWYWx1ZSA9IHVzZUNhbGxiYWNrKFxyXG4gICAgKHZhbCkgPT4ge1xyXG4gICAgICBpZiAoIXZhbCAmJiAhcmVxdWlyZWQpIHtcclxuICAgICAgICBzZXRWYWxpZGF0aW9uU3RhdGUoVkFMSURBVElPTl9TVEFURVMuREVGQVVMVCk7XHJcbiAgICAgICAgc2V0RXJyb3JNZXNzYWdlKCcnKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHJlcXVpcmVkICYmICF2YWwpIHtcclxuICAgICAgICBzZXRWYWxpZGF0aW9uU3RhdGUoVkFMSURBVElPTl9TVEFURVMuRVJST1IpO1xyXG4gICAgICAgIHNldEVycm9yTWVzc2FnZSh0U3luYygnZm9ybXMudmFsaWRhdGlvbi5yZXF1aXJlZCcpKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChtYXhMZW5ndGggJiYgdmFsLmxlbmd0aCA+IG1heExlbmd0aCkge1xyXG4gICAgICAgIHNldFZhbGlkYXRpb25TdGF0ZShWQUxJREFUSU9OX1NUQVRFUy5FUlJPUik7XHJcbiAgICAgICAgc2V0RXJyb3JNZXNzYWdlKHRTeW5jKCdmb3Jtcy52YWxpZGF0aW9uLm1heExlbmd0aCcsIHsgbWF4OiBtYXhMZW5ndGggfSkpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVHlwZS1zcGVjaWZpYyB2YWxpZGF0aW9uXHJcbiAgICAgIGlmICh0eXBlID09PSAnZW1haWwnICYmIHZhbCAmJiAhaXNWYWxpZEVtYWlsKHZhbCkpIHtcclxuICAgICAgICBzZXRWYWxpZGF0aW9uU3RhdGUoVkFMSURBVElPTl9TVEFURVMuRVJST1IpO1xyXG4gICAgICAgIHNldEVycm9yTWVzc2FnZSh0U3luYygnZm9ybXMudmFsaWRhdGlvbi5pbnZhbGlkRW1haWwnKSk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodHlwZSA9PT0gJ3VybCcgJiYgdmFsICYmICFpc1ZhbGlkVXJsKHZhbCkpIHtcclxuICAgICAgICBzZXRWYWxpZGF0aW9uU3RhdGUoVkFMSURBVElPTl9TVEFURVMuRVJST1IpO1xyXG4gICAgICAgIHNldEVycm9yTWVzc2FnZSh0U3luYygnZm9ybXMudmFsaWRhdGlvbi5pbnZhbGlkVXJsJykpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ3VzdG9tIHZhbGlkYXRpb25cclxuICAgICAgaWYgKHZhbGlkYXRlKSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGUodmFsKTtcclxuICAgICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgICAgICBpZiAoIXJlc3VsdCkge1xyXG4gICAgICAgICAgICBzZXRWYWxpZGF0aW9uU3RhdGUoVkFMSURBVElPTl9TVEFURVMuRVJST1IpO1xyXG4gICAgICAgICAgICBzZXRFcnJvck1lc3NhZ2UodFN5bmMoJ2Zvcm1zLnZhbGlkYXRpb24uaW52YWxpZFZhbHVlJykpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQgJiYgIXJlc3VsdC52YWxpZCkge1xyXG4gICAgICAgICAgc2V0VmFsaWRhdGlvblN0YXRlKFZBTElEQVRJT05fU1RBVEVTLkVSUk9SKTtcclxuICAgICAgICAgIHNldEVycm9yTWVzc2FnZShyZXN1bHQuZXJyb3IgfHwgdFN5bmMoJ2Zvcm1zLnZhbGlkYXRpb24uaW52YWxpZFZhbHVlJykpO1xyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gU3VjY2VzcyBzdGF0ZSBpZiB2YWx1ZSBpcyB2YWxpZCBhbmQgbm90IGVtcHR5XHJcbiAgICAgIGlmICh2YWwpIHtcclxuICAgICAgICBzZXRWYWxpZGF0aW9uU3RhdGUoVkFMSURBVElPTl9TVEFURVMuU1VDQ0VTUyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgc2V0VmFsaWRhdGlvblN0YXRlKFZBTElEQVRJT05fU1RBVEVTLkRFRkFVTFQpO1xyXG4gICAgICB9XHJcbiAgICAgIHNldEVycm9yTWVzc2FnZSgnJyk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSxcclxuICAgIFt0eXBlLCByZXF1aXJlZCwgbWF4TGVuZ3RoLCB2YWxpZGF0ZV1cclxuICApO1xyXG5cclxuICAvLyBIYW5kbGUgdmFsdWUgY2hhbmdlIHdpdGggZGVib3VuY2VcclxuICBjb25zdCBoYW5kbGVDaGFuZ2UgPSB1c2VDYWxsYmFjayhcclxuICAgIChuZXdWYWx1ZSkgPT4ge1xyXG4gICAgICAvLyBBdXRvLWZvcm1hdCBpZiBlbmFibGVkXHJcbiAgICAgIGxldCBmb3JtYXR0ZWRWYWx1ZSA9IG5ld1ZhbHVlO1xyXG4gICAgICBpZiAoYXV0b0Zvcm1hdCAmJiB0eXBlID09PSAndGVsJykge1xyXG4gICAgICAgIGZvcm1hdHRlZFZhbHVlID0gZm9ybWF0UGhvbmVOdW1iZXIobmV3VmFsdWUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBzZXRJbnRlcm5hbFZhbHVlKGZvcm1hdHRlZFZhbHVlKTtcclxuXHJcbiAgICAgIC8vIENsZWFyIGV4aXN0aW5nIGRlYm91bmNlIHRpbWVyXHJcbiAgICAgIGlmIChkZWJvdW5jZVRpbWVyUmVmLmN1cnJlbnQpIHtcclxuICAgICAgICBjbGVhclRpbWVvdXQoZGVib3VuY2VUaW1lclJlZi5jdXJyZW50KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gSW1tZWRpYXRlIHZhbGlkYXRpb24gZm9yIHJlcXVpcmVkIGZpZWxkc1xyXG4gICAgICBpZiAocmVxdWlyZWQgJiYgIWZvcm1hdHRlZFZhbHVlKSB7XHJcbiAgICAgICAgc2V0VmFsaWRhdGlvblN0YXRlKFZBTElEQVRJT05fU1RBVEVTLkVSUk9SKTtcclxuICAgICAgICBzZXRFcnJvck1lc3NhZ2UodFN5bmMoJ2Zvcm1zLnZhbGlkYXRpb24ucmVxdWlyZWQnKSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgc2V0VmFsaWRhdGlvblN0YXRlKFZBTElEQVRJT05fU1RBVEVTLkRFRkFVTFQpO1xyXG4gICAgICAgIHNldEVycm9yTWVzc2FnZSgnJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIERlYm91bmNlZCB2YWxpZGF0aW9uIGFuZCBvbkNoYW5nZVxyXG4gICAgICBkZWJvdW5jZVRpbWVyUmVmLmN1cnJlbnQgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB2YWxpZGF0ZVZhbHVlKGZvcm1hdHRlZFZhbHVlKTtcclxuICAgICAgICBpZiAob25DaGFuZ2VUZXh0KSB7XHJcbiAgICAgICAgICBvbkNoYW5nZVRleHQoZm9ybWF0dGVkVmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob25DaGFuZ2UpIHtcclxuICAgICAgICAgIG9uQ2hhbmdlKHsgdGFyZ2V0OiB7IHZhbHVlOiBmb3JtYXR0ZWRWYWx1ZSB9IH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSwgZGVib3VuY2VNcyk7XHJcbiAgICB9LFxyXG4gICAgW29uQ2hhbmdlVGV4dCwgb25DaGFuZ2UsIHR5cGUsIHJlcXVpcmVkLCBkZWJvdW5jZU1zLCBhdXRvRm9ybWF0LCB2YWxpZGF0ZVZhbHVlXVxyXG4gICk7XHJcblxyXG4gIC8vIEhhbmRsZSBmb2N1c1xyXG4gIGNvbnN0IGhhbmRsZUZvY3VzID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xyXG4gICAgc2V0SXNGb2N1c2VkKHRydWUpO1xyXG4gIH0sIFtdKTtcclxuXHJcbiAgLy8gSGFuZGxlIGJsdXJcclxuICBjb25zdCBoYW5kbGVCbHVyID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xyXG4gICAgc2V0SXNGb2N1c2VkKGZhbHNlKTtcclxuICAgIHZhbGlkYXRlVmFsdWUoaW50ZXJuYWxWYWx1ZSk7XHJcbiAgfSwgW2ludGVybmFsVmFsdWUsIHZhbGlkYXRlVmFsdWVdKTtcclxuXHJcbiAgLy8gQ2xlYW51cCBkZWJvdW5jZSB0aW1lciBvbiB1bm1vdW50XHJcbiAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIGlmIChkZWJvdW5jZVRpbWVyUmVmLmN1cnJlbnQpIHtcclxuICAgICAgICBjbGVhclRpbWVvdXQoZGVib3VuY2VUaW1lclJlZi5jdXJyZW50KTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9LCBbXSk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICB2YWx1ZTogaW50ZXJuYWxWYWx1ZSxcclxuICAgIHZhbGlkYXRpb25TdGF0ZSxcclxuICAgIGVycm9yTWVzc2FnZSxcclxuICAgIGlzRm9jdXNlZCxcclxuICAgIGhhbmRsZUNoYW5nZSxcclxuICAgIGhhbmRsZUZvY3VzLFxyXG4gICAgaGFuZGxlQmx1cixcclxuICAgIGNoYXJhY3RlckNvdW50OiBpbnRlcm5hbFZhbHVlID8gaW50ZXJuYWxWYWx1ZS5sZW5ndGggOiAwLFxyXG4gIH07XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCB1c2VUZXh0RmllbGQ7XHJcblxyXG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUtBLElBQUFBLE1BQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLEtBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLFVBQUEsR0FBQUYsT0FBQTtBQUNBLElBQUFHLE1BQUEsR0FBQUgsT0FBQTtBQU9BLElBQU1JLGlCQUFpQixHQUFHLFNBQXBCQSxpQkFBaUJBLENBQUlDLEtBQUssRUFBSztFQUNuQyxJQUFJLENBQUNBLEtBQUssRUFBRSxPQUFPLEVBQUU7RUFFckIsSUFBTUMsTUFBTSxHQUFHRCxLQUFLLENBQUNFLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDO0VBRXZDLElBQUlELE1BQU0sQ0FBQ0UsTUFBTSxJQUFJLENBQUMsRUFBRSxPQUFPRixNQUFNO0VBQ3JDLElBQUlBLE1BQU0sQ0FBQ0UsTUFBTSxJQUFJLENBQUMsRUFBRSxPQUFPLElBQUlGLE1BQU0sQ0FBQ0csS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBS0gsTUFBTSxDQUFDRyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUU7RUFDM0UsT0FBTyxJQUFJSCxNQUFNLENBQUNHLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUtI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TyxDQUFDO01BQzdDTyxlQUFlLENBQUMsRUFBRSxDQUFDO0lBQ3JCO0lBR0FLLGdCQUFnQixDQUFDa0IsT0FBTyxHQUFHRSxVQUFVLENBQUMsWUFBTTtNQUMxQ2pCLGFBQWEsQ0FBQ2MsY0FBYyxDQUFDO01BQzdCLElBQUluRCxZQUFZLEVBQUU7UUFDaEJBLFlBQVksQ0FBQ21ELGNBQWMsQ0FBQztNQUM5QjtNQUNBLElBQUlsRCxRQUFRLEVBQUU7UUFDWkEsUUFBUSxDQUFDO1VBQUVzRCxNQUFNLEVBQUU7WUFBRS9ELEtBQUssRUFBRTJEO1VBQWU7UUFBRSxDQUFDLENBQUM7TUFDakQ7SUFDRixDQUFDLEVBQUUxQyxVQUFVLENBQUM7RUFDaEIsQ0FBQyxFQUNELENBQUNULFlBQVksRUFBRUMsUUFBUSxFQUFFRSxJQUFJLEVBQUVHLFFBQVEsRUFBRUcsVUFBVSxFQUFFRSxVQUFVLEVBQUUwQixhQUFhLENBQ2hGLENBQUM7RUFHRCxJQUFNbUIsV0FBVyxHQUFHLElBQUFsQixrQkFBVyxFQUFDLFlBQU07SUFDcENMLFlBQVksQ0FBQyxJQUFJLENBQUM7RUFDcEIsQ0FBQyxFQUFFLEVBQUUsQ0FBQztFQUdOLElBQU13QixVQUFVLEdBQUcsSUFBQW5CLGtCQUFXLEVBQUMsWUFBTTtJQUNuQ0wsWUFBWSxDQUFDLEtBQUssQ0FBQztJQUNuQkksYUFBYSxDQUFDbkIsYUFBYSxDQUFDO0VBQzlCLENBQUMsRUFBRSxDQUFDQSxhQUFhLEVBQUVtQixhQUFhLENBQUMsQ0FBQztFQUdsQyxJQUFBRCxnQkFBUyxFQUFDLFlBQU07SUFDZCxPQUFPLFlBQU07TUFDWCxJQUFJRixnQkFBZ0IsQ0FBQ2tCLE9BQU8sRUFBRTtRQUM1QkMsWUFBWSxDQUFDbkIsZ0JBQWdCLENBQUNrQixPQUFPLENBQUM7TUFDeEM7SUFDRixDQUFDO0VBQ0gsQ0FBQyxFQUFFLEVBQUUsQ0FBQztFQUVOLE9BQU87SUFDTDVELEtBQUssRUFBRTBCLGFBQWE7SUFDcEJNLGVBQWUsRUFBZkEsZUFBZTtJQUNmSSxZQUFZLEVBQVpBLFlBQVk7SUFDWkksU0FBUyxFQUFUQSxTQUFTO0lBQ1RpQixZQUFZLEVBQVpBLFlBQVk7SUFDWk8sV0FBVyxFQUFYQSxXQUFXO0lBQ1hDLFVBQVUsRUFBVkEsVUFBVTtJQUNWQyxjQUFjLEVBQUV4QyxhQUFhLEdBQUdBLGFBQWEsQ0FBQ3ZCLE1BQU0sR0FBRztFQUN6RCxDQUFDO0FBQ0gsQ0FBQztBQUFDLElBQUFnRSxRQUFBLEdBQUFDLE9BQUEsQ0FBQTNDLE9BQUEsR0FFYXBCLFlBQVkiLCJpZ25vcmVMaXN0IjpbXX0=