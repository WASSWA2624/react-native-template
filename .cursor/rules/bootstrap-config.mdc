---
alwaysApply: true
---

# Bootstrap & Configuration Standards
## Purpose
This document defines **how the application is initialized, configured, and composed at startup**.
Goals:
- Centralized and predictable app initialization
- Clear separation between setup and runtime logic
- Deterministic startup order
- Secure, testable, and scalable bootstrapping
The bootstrap layer is the **only place** where global systems are wired together.
---

## Bootstrap Layer Responsibility
The Bootstrap Layer:
- Initializes global providers
- Wires theme, store, offline, and security systems
- Controls startup order and readiness
- Exposes a single `initApp()` entry
It does **not**:
- Contain UI components
- Implement business rules
- Handle navigation logic
- Perform feature-specific logic
---

## Folder Structure
```txt
src/bootstrap/
    ├── index.js              # Single bootstrap entry
    ├── init.theme.js         # Theme initialization
    ├── init.store.js         # Redux store initialization
    ├── init.offline.js       # Offline & network initialization
    └── init.security.js      # Security initialization
```
---

## Bootstrap Entry Rules
### `index.js`
* Exports a single `bootstrapApp()` (or `initApp()`) function
* Calls all init modules in the correct order
* Handles fatal startup errors
Example:
```javascript
import { initSecurity } from './init.security';
import { initStore } from './init.store';
import { initTheme } from './init.theme';
import { initOffline } from './init.offline';

const bootstrapApp = async () => {
  await initSecurity();
  await initStore();
  await initTheme();
  await initOffline();
};

export { bootstrapApp };
```
Rules:
* Must be idempotent
* Must be deterministic
* Must not depend on UI
---

## Initialization Order (Mandatory)
Startup order **must always be**:
1. Security
2. Store
3. Theme
4. Offline
5. App Router render
Rationale:
* Security protects everything
* Store is required by most layers
* Theme is required by UI
* Offline depends on store and services
---

## Provider Placement (Single Source of Truth)
All providers are mounted **only** in:
```txt
src/app/_layout.jsx
```
Allowed providers (all must be mounted in `src/app/_layout.jsx`):
* Redux Provider (see `state-management.mdc`)
* Theme Provider (see `theme-design.mdc`)
* Error Boundary (see `errors-logging.mdc`)
* Feature Flag Provider
* Localization Provider (see `i18n.mdc`)

**Note**: This is the complete list. No other global providers should be mounted elsewhere.
Forbidden:
❌ Providers inside screens
❌ Providers inside components
❌ Nested global providers
❌ Multiple provider mounts for the same provider type
---

## Theme Initialization
### Responsibilities
* Resolve light/dark mode
* Load persisted user preference
* Register styled-components theme
Rules:
* No theme logic inside components
* Theme resolution happens once at startup
* Theme changes must be dispatched via store
---

## Store Initialization
### Responsibilities
* Create Redux store
* Register middleware
* Setup persistence
* Hydrate state
Rules:
* No direct store access outside bootstrap/hooks
* Store creation must be synchronous
* Persistence must fail gracefully
---

## Offline Initialization
### Responsibilities
* Register network listeners
* Initialize request queue
* Trigger hydration
Rules:
* Offline setup must not block UI
* Network failures must not crash app
* Queue must survive restarts
---

## Security Initialization
### Responsibilities
* Load secure tokens
* Initialize encryption keys
* Prepare biometric availability
* Validate session integrity
Rules:
* Security must initialize before store hydration
* Tokens must never touch UI directly
* Failures must trigger logout, not crash
---

## Configuration Layer Integration
Bootstrap may read from:
```txt
src/config/
```
Rules:
* Config files must be deterministic and side-effect free (reading environment values for non-sensitive config is allowed)
* No dynamic logic in config
* Environment access only through config layer
* Never treat environment variables as secrets in client apps; secrets must not be shipped (see `security.mdc`)
---

## Error Handling
### Startup Errors
* Fatal errors must block rendering
* Non-fatal errors must be logged
Rules:
* Never silently fail during bootstrap
* Always log bootstrap failures
---

## Forbidden Patterns
❌ UI imports in bootstrap
❌ Feature logic in bootstrap
❌ Navigation logic in bootstrap
❌ Side effects scattered across app
---

---
**Bootstrap wires the system. Runtime executes it.**
