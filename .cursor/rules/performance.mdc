---
alwaysApply: true
---

# Performance & Efficiency Standards

## Purpose
Keep the app **fast**, **battery/network efficient**, and scalable as features grow.
Goals:
- Fast initial load and time to interactive
- Smooth 60fps animations and interactions
- Minimal battery drain
- Efficient network usage
- Optimal bundle size
- Responsive performance across all device sizes

## Core Performance Principles

### 1. Rendering Performance
**Rules (Mandatory)**:
- Avoid unnecessary re-renders:
  - Memoize expensive computations in hooks (`useMemo`, `useCallback`)
  - Use memoized selectors (e.g. RTK `createSelector`)
  - Use `React.memo` for expensive components
  - Avoid creating new objects/functions in render
- **Styled-Components Creation**: See `component-structure.mdc` - must be created in `.styles.jsx` files only
- Use list virtualization for large collections (`FlatList` / `SectionList`)
- Avoid large in-memory objects in Redux; store normalized data and IDs
- Prefer pagination and incremental loading over "fetch all"
- Lazy load routes and heavy components

### 2. Bundle Size & Code Splitting
**Rules (Mandatory)**:
- Target bundle size: **< 2MB initial load** (web), **< 5MB** (mobile)
- Use route-based code splitting (Expo App Router handles this)
- Lazy load heavy features and third-party libraries
- Remove unused dependencies regularly
- Use tree-shaking friendly imports (barrel exports enable this)
- Monitor bundle size in CI/CD

### 3. Network Optimization
**Rules (Mandatory)**:
- Implement request caching where appropriate
- Use compression for API responses
- Batch related requests when possible
- Prefer incremental data loading (pagination, infinite scroll)
- Implement request deduplication
- Use offline queue for mutations (see `offline-sync.mdc`)

### 4. Image & Asset Optimization
**Rules (Mandatory)**:
- Avoid shipping large assets; prefer optimized formats and sizes
- Use WebP/AVIF formats when supported
- Implement responsive images (different sizes for different screens)
- Lazy load images below the fold
- Use appropriate image dimensions (don't load 4K images on mobile)
- Compress assets before bundling

### 5. Memory Management
**Rules (Mandatory)**:
- Clean up subscriptions and timers in `useEffect` cleanup
- Avoid memory leaks from closures
- Release large objects when no longer needed
- Use weak references where appropriate
- Monitor memory usage in development

### 6. Animation & Motion
**Rules (Mandatory)**:
- Avoid heavy animation by default; respect reduced motion
- Use native animations (Animated API, Reanimated) over JavaScript animations
- Keep animations at 60fps
- Prefer CSS transforms over layout-triggering properties
- Use `will-change` sparingly and only when needed

### 7. Responsive Performance
**Rules (Mandatory)**:
- Optimize for mobile-first (smallest screens get priority)
- Use responsive breakpoints efficiently (see `theme-design.mdc`)
- Avoid rendering hidden content on mobile
- Implement progressive enhancement for larger screens
- Test performance on low-end devices

### 8. Battery Efficiency
**Rules (Mandatory)**:
- Minimize background processing
- Use efficient data structures and algorithms
- Avoid unnecessary network polling
- Optimize location services usage
- Reduce screen brightness impact where possible

## Performance Budgets (Mandatory)
- **Initial Load Time**: < 3 seconds on 3G
- **Time to Interactive**: < 5 seconds
- **First Contentful Paint**: < 1.5 seconds
- **Bundle Size**: < 2MB initial (web), < 5MB (mobile)
- **API Response Time**: < 500ms for critical endpoints
- **Animation Frame Rate**: 60fps minimum

## Profiling & Monitoring
**Rules (Mandatory)**:
- Performance regressions must be measured (before/after) for high-impact screens
- Use React DevTools Profiler for component performance
- Monitor bundle size in CI/CD
- Track Core Web Vitals (web platform)
- Profile on real devices, not just simulators
- Set up performance monitoring in production

## Related `.mdc` files
* `project-structure.mdc` - Structure enables code splitting and lazy loading
* `theme-design.mdc` - Responsive design and breakpoints
* `offline-sync.mdc` - Offline queue and sync performance rules

## Forbidden Patterns
❌ Creating new objects/functions in render
❌ Creating styled-components outside `.styles.jsx` files (STRICTLY FORBIDDEN - see `component-structure.mdc`)
❌ Unnecessary re-renders
❌ Large bundle sizes without justification
❌ Loading all data upfront
❌ Unoptimized images
❌ Heavy animations on low-end devices
❌ Memory leaks from unclosed subscriptions

## Enforcement
- Performance regressions block PR approval
- Bundle size increases require justification
- All high-impact screens must be profiled
- Performance budgets must be maintained
